import{m as Kl,n as Ze,_ as Zt,p as it,B as Gl,t as Xt,ai as fa,a7 as ba,i as I,C as Jl,D as ft,q as f,v as g,K as t,G as A,a9 as Jt,aj as wa,A as Xl,H as n,x as Yt,y as m,z as y,ak as ya,a2 as Qt,al as xa,L as de,M as me,I as a,am as Wl,a8 as Yl,U as b,af as Zl,E as Ce,k as fe,w as Se,an as Ql,a4 as yl,J as c,$ as Tt,r as C,a1 as es,c as Fl,h as Te,N as bl,a6 as Et,a5 as ha,aa as ka,ab as Ca,ad as Va,ae as Ua,W as Ea,V as nt,X as $e,Y as ke,Z as ql,ag as Ta,a0 as La}from"./CJm-ZIDs.js";import{b as ts,_ as xl,a as Aa}from"./CxG5bs8s.js";import{b as hl,_ as Sa,a as Ba,N as $a}from"./DsAFfEjU.js";import{_ as Ra}from"./B_-ynJ35.js";import{_ as ls}from"./oTRuvlsj.js";import{_ as ja}from"./RAAbhsVp.js";const Pa={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},wl=Kl(Ze.ui.strategy,Ze.ui.radio,Pa),Ia=it({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>wl.default.color,validator(v){return Ze.ui.colors.includes(v)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(v,{emit:J}){const{ui:N,attrs:U}=Gl("radio",Xt(v,"ui"),wl,Xt(v,"class")),u=v.id??fa(),S=ba("radio-group",null),{emitFormChange:X,color:O,name:j}=S??ts(v,wl),E=I({get(){return v.modelValue},set(W){J("update:modelValue",W),S||X()}});function P(W){J("change",W.target.value)}const le=I(()=>Jl(ft(N.value.base,N.value.form,N.value.background,N.value.border,O.value&&N.value.ring.replaceAll("{color}",O.value),O.value&&N.value.color.replaceAll("{color}",O.value)),v.inputClass));return{inputId:u,ui:N,attrs:U,pick:E,name:j,inputClass:le,onChange:P}}}),Da=["data-n-ids"],_a=["id","name","required","value","disabled"],Ha=["for"];function Ma(v,J,N,U,u,S){return g(),f("div",{class:n(v.ui.wrapper),"data-n-ids":v.attrs["data-n-ids"]},[t("div",{class:n(v.ui.container)},[Jt(t("input",Xl({id:v.inputId,"onUpdate:modelValue":J[0]||(J[0]=X=>v.pick=X),name:v.name,required:v.required,value:v.value,disabled:v.disabled,type:"radio",class:v.inputClass},v.attrs,{onChange:J[1]||(J[1]=(...X)=>v.onChange&&v.onChange(...X))}),null,16,_a),[[wa,v.pick]])],2),v.label||v.$slots.label?(g(),f("div",{key:0,class:n(v.ui.inner)},[t("label",{for:v.inputId,class:n(v.ui.label)},[Yt(v.$slots,"label",{label:v.label},()=>[m(y(v.label),1)]),v.required?(g(),f("span",{key:0,class:n(v.ui.required)},"*",2)):A("",!0)],10,Ha),v.help||v.$slots.help?(g(),f("p",{key:0,class:n(v.ui.help)},[Yt(v.$slots,"help",{help:v.help},()=>[m(y(v.help),1)])],2)):A("",!0)],2)):A("",!0)],10,Da)}const za=Zt(Ia,[["render",Ma]]),Re=Kl(Ze.ui.strategy,Ze.ui.select,ya),Na=it({components:{UIcon:Qt},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>Re.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>Re.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(v){return Object.keys(Re.size).includes(v)}},color:{type:String,default:()=>Re.default.color,validator(v){return[...Ze.ui.colors,...Object.keys(Re.color)].includes(v)}},variant:{type:String,default:()=>Re.default.variant,validator(v){return[...Object.keys(Re.variant),...Object.values(Re.color).flatMap(J=>Object.keys(J))].includes(v)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(v,{emit:J,slots:N}){const{ui:U,attrs:u}=Gl("select",Xt(v,"ui"),Re,Xt(v,"class")),{size:S,rounded:X}=xa({ui:U,props:v}),{emitFormChange:O,inputId:j,color:E,size:P,name:le}=ts(v,Re),W=I(()=>S.value??P.value),ue=$=>{J("update:modelValue",$.target.value)},te=$=>{J("change",$.target.value),O()},o=$=>Wl($,v.valueAttribute,""),p=$=>Wl($,v.optionAttribute,""),M=$=>["string","number","boolean"].includes(typeof $)?{[v.valueAttribute]:$,[v.optionAttribute]:$}:{...$,[v.valueAttribute]:o($),[v.optionAttribute]:p($)},z=I(()=>v.options.map($=>M($))),G=I(()=>v.placeholder?[{[v.valueAttribute]:"",[v.optionAttribute]:v.placeholder,disabled:!0},...z.value]:z.value),ae=I(()=>{const $=M(v.modelValue),_=G.value.find(D=>D[v.valueAttribute]===$[v.valueAttribute]);return _?_[v.valueAttribute]:""}),ce=I(()=>{var _,D;const $=((D=(_=U.value.color)==null?void 0:_[E.value])==null?void 0:D[v.variant])||U.value.variant[v.variant];return Jl(ft(U.value.base,U.value.form,X.value,U.value.size[W.value],v.padded?U.value.padding[W.value]:"p-0",$==null?void 0:$.replaceAll("{color}",E.value),(V.value||N.leading)&&U.value.leading.padding[W.value],(be.value||N.trailing)&&U.value.trailing.padding[W.value]),v.placeholder&&!v.modelValue&&U.value.placeholder,v.selectClass)}),V=I(()=>v.icon&&v.leading||v.icon&&!v.trailing||v.loading&&!v.trailing||v.leadingIcon),be=I(()=>v.icon&&v.trailing||v.loading&&v.trailing||v.trailingIcon),we=I(()=>v.loading?v.loadingIcon:v.leadingIcon||v.icon),Ve=I(()=>v.loading&&!V.value?v.loadingIcon:v.trailingIcon||v.icon),B=I(()=>ft(U.value.icon.leading.wrapper,U.value.icon.leading.pointer,U.value.icon.leading.padding[W.value])),Ne=I(()=>ft(U.value.icon.base,E.value&&Ze.ui.colors.includes(E.value)&&U.value.icon.color.replaceAll("{color}",E.value),U.value.icon.size[W.value],v.loading&&U.value.icon.loading)),Oe=I(()=>ft(U.value.icon.trailing.wrapper,U.value.icon.trailing.pointer,U.value.icon.trailing.padding[W.value])),Pe=I(()=>ft(U.value.icon.base,E.value&&Ze.ui.colors.includes(E.value)&&U.value.icon.color.replaceAll("{color}",E.value),U.value.icon.size[W.value],v.loading&&!V.value&&U.value.icon.loading));return{ui:U,attrs:u,name:le,inputId:j,normalizedOptionsWithPlaceholder:G,normalizedValue:ae,isLeading:V,isTrailing:be,selectClass:ce,leadingIconName:we,leadingIconClass:Ne,leadingWrapperIconClass:B,trailingIconName:Ve,trailingIconClass:Pe,trailingWrapperIconClass:Oe,onInput:ue,onChange:te}}}),Oa=["id","name","value","required","disabled"],Wa=["value","label"],Fa=["value","selected","disabled","textContent"],qa=["value","selected","disabled","textContent"];function Ka(v,J,N,U,u,S){const X=Qt;return g(),f("div",{class:n(v.ui.wrapper)},[t("select",Xl({id:v.inputId,name:v.name,value:v.modelValue,required:v.required,disabled:v.disabled,class:v.selectClass},v.attrs,{onInput:J[0]||(J[0]=(...O)=>v.onInput&&v.onInput(...O)),onChange:J[1]||(J[1]=(...O)=>v.onChange&&v.onChange(...O))}),[(g(!0),f(de,null,me(v.normalizedOptionsWithPlaceholder,(O,j)=>(g(),f(de,null,[O.children?(g(),f("optgroup",{key:`${O[v.valueAttribute]}-optgroup-${j}`,value:O[v.valueAttribute],label:O[v.optionAttribute]},[(g(!0),f(de,null,me(O.children,(E,P)=>(g(),f("option",{key:`${E[v.valueAttribute]}-${j}-${P}`,value:E[v.valueAttribute],selected:E[v.valueAttribute]===v.normalizedValue,disabled:E.disabled,textContent:y(E[v.optionAttribute])},null,8,Fa))),128))],8,Wa)):(g(),f("option",{key:`${O[v.valueAttribute]}-${j}`,value:O[v.valueAttribute],selected:O[v.valueAttribute]===v.normalizedValue,disabled:O.disabled,textContent:y(O[v.optionAttribute])},null,8,qa))],64))),256))],16,Oa),v.isLeading&&v.leadingIconName||v.$slots.leading?(g(),f("span",{key:0,class:n(v.leadingWrapperIconClass)},[Yt(v.$slots,"leading",{disabled:v.disabled,loading:v.loading},()=>[a(X,{name:v.leadingIconName,class:n(v.leadingIconClass)},null,8,["name","class"])],!0)],2)):A("",!0),v.isTrailing&&v.trailingIconName||v.$slots.trailing?(g(),f("span",{key:1,class:n(v.trailingWrapperIconClass)},[Yt(v.$slots,"trailing",{disabled:v.disabled,loading:v.loading},()=>[a(X,{name:v.trailingIconName,class:n(v.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):A("",!0)],2)}const ss=Zt(Na,[["render",Ka],["__scopeId","data-v-db8f1118"]]),Ga=()=>{const v=Yl(),J=b(),N=Zl(),U=async()=>{const j=await v.getStatus();return j&&v.setUserStatus(j),j},u=async j=>{await v.register(j)&&J.add({title:"注册成功",description:"欢迎使用！请登录",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3})},S=async j=>{await v.login(j)&&(await U(),J.add({title:"登录成功",description:"欢迎回来！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}))},X=async()=>{await v.logout(),v.clearUserStatus(),J.add({title:"注销成功",description:"欢迎再次使用！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),N.push("/")},O=async()=>await U();return Ce(async()=>{await U()}),{register:u,login:S,logout:X,getStatus:O}},Ja={class:"rounded-lg p-4 mb-6"},Xa={class:"flex justify-between items-center mb-4"},Ya={class:"flex justify-between items-center mb-2"},Za={class:"flex items-center gap-2"},Qa={key:0,class:"space-y-2"},eo={class:"flex justify-end gap-2"},to={class:"flex justify-between items-center mb-2"},lo={class:"flex items-center gap-2"},so={key:0,class:"space-y-2"},ao={class:"flex justify-end gap-2"},oo={class:"flex justify-between items-center mb-2"},no={class:"flex items-center gap-2"},io={key:0,class:"space-y-2"},ro={class:"flex justify-end gap-2"},uo={class:"flex justify-between items-center mb-2"},co={class:"flex items-center gap-2"},mo={key:0,class:"space-y-2"},po={class:"flex justify-end gap-2"},vo={class:"flex justify-between items-center mb-2"},go={class:"flex items-center gap-2"},fo={key:0,class:"space-y-2"},bo={class:"flex justify-end gap-2"},wo={class:"flex justify-between items-center mb-2"},yo={class:"flex items-center gap-2"},xo={key:0,class:"space-y-2"},ho={class:"flex justify-end gap-2"},ko=it({__name:"NotifyPanel",props:{config:{},immediate:{type:Boolean},subtleBg:{},text:{},mutedText:{},disabled:{type:Boolean}},emits:["save"],setup(v,{emit:J}){const N=J,U=v,u=fe({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:"",twitterEnabled:!1,twitterApiKey:"",twitterApiSecret:"",twitterAccessToken:"",twitterAccessTokenSecret:"",customHttpEnabled:!1,customHttpUrl:"",customHttpMethod:"POST",customHttpHeaders:"",customHttpBody:'{"content":"{{content}}"}'}),S=fe({webhook:!1,telegram:!1,wework:!1,feishu:!1,twitter:!1,customHttp:!1}),X=["webhook","telegram","wework","feishu","twitter","customHttp"],O=o=>({webhook:"Webhook",telegram:"Telegram",wework:"企业微信",feishu:"飞书",twitter:"Twitter",customHttp:"自定义HTTP"})[o]||o,j=o=>{const p=o.toLowerCase();Object.keys(u).forEach(M=>{M.toLowerCase().startsWith(p)&&(u[M]=U.config[M])}),S[o]=!1},E=o=>{var M,z,G,ae,ce,V,be,we,Ve,B;const p=u;switch(o){case"webhook":return p.webhookEnabled&&!!((M=p.webhookURL)!=null&&M.trim());case"telegram":return p.telegramEnabled&&!!((z=p.telegramToken)!=null&&z.trim())&&!!((G=p.telegramChatID)!=null&&G.trim());case"wework":return p.weworkEnabled&&!!((ae=p.weworkKey)!=null&&ae.trim());case"feishu":return p.feishuEnabled&&!!((ce=p.feishuWebhook)!=null&&ce.trim());case"twitter":return p.twitterEnabled&&!!((V=p.twitterApiKey)!=null&&V.trim())&&!!((be=p.twitterApiSecret)!=null&&be.trim())&&!!((we=p.twitterAccessToken)!=null&&we.trim())&&!!((Ve=p.twitterAccessTokenSecret)!=null&&Ve.trim());case"customHttp":return p.customHttpEnabled&&!!((B=p.customHttpUrl)!=null&&B.trim());default:return!1}},P=async o=>{try{switch(o){case"webhook":if(u.webhookEnabled&&!u.webhookURL)throw new Error("Webhook URL不能为空");break;case"telegram":if(u.telegramEnabled&&(!u.telegramToken||!u.telegramChatID))throw new Error("Telegram配置不完整");break;case"wework":if(u.weworkEnabled&&!u.weworkKey)throw new Error("企业微信Key不能为空");break;case"feishu":if(u.feishuEnabled&&!u.feishuWebhook)throw new Error("飞书Webhook不能为空");break;case"twitter":if(u.twitterEnabled&&(!u.twitterApiKey||!u.twitterApiSecret||!u.twitterAccessToken||!u.twitterAccessTokenSecret))throw new Error("Twitter配置不完整");break;case"customHttp":if(u.customHttpEnabled&&!u.customHttpUrl)throw new Error("自定义HTTP URL不能为空");break}const p={webhookEnabled:u.webhookEnabled,webhookURL:u.webhookURL,telegramEnabled:u.telegramEnabled,telegramToken:u.telegramToken,telegramChatID:u.telegramChatID,weworkEnabled:u.weworkEnabled,weworkKey:u.weworkKey,feishuEnabled:u.feishuEnabled,feishuWebhook:u.feishuWebhook,feishuSecret:u.feishuSecret,twitterEnabled:u.twitterEnabled,twitterApiKey:u.twitterApiKey,twitterApiSecret:u.twitterApiSecret,twitterAccessToken:u.twitterAccessToken,twitterAccessTokenSecret:u.twitterAccessTokenSecret,customHttpEnabled:u.customHttpEnabled,customHttpUrl:u.customHttpUrl,customHttpMethod:u.customHttpMethod,customHttpHeaders:u.customHttpHeaders,customHttpBody:u.customHttpBody},M=Tt().public.baseApi||"/api",G=await(await fetch(`${M}/notify/config`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(p)})).json();if(G.code===1)S[o]=!1,G.data&&Object.keys(G.data).forEach(ae=>{ae.endsWith("Enabled")?u[ae]=!!G.data[ae]&&G.data[ae]!=="false":u[ae]=G.data[ae]||""}),N("save",{...u}),b().add({title:"成功",description:`${O(o)}配置已保存`,color:"green"});else throw new Error(G.msg||"保存失败")}catch(p){console.error("保存配置失败:",p),b().add({title:"错误",description:p.message||"保存失败",color:"red"})}},le=async o=>{try{if(!E(o))throw new Error(`请先完成并启用${O(o)}配置`);const M=await(await fetch("/api/notify/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:o})})).json();if(M.code===1)b().add({title:"成功",description:`${O(o)}测试消息已发送`,color:"green"});else throw new Error(M.msg||"测试失败")}catch(p){console.error("测试失败:",p),b().add({title:"错误",description:p.message||"测试失败",color:"red"})}};Se(()=>U.config,o=>{o&&Object.keys(u).forEach(p=>{o[p]!==void 0&&(p.endsWith("Enabled")?u[p]=!!o[p]&&o[p]!=="false":u[p]=o[p])})},{deep:!0,immediate:!0}),Ce(async()=>{try{const p=await(await fetch("/api/notify/config",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();if(p.code===1&&p.data){const M=p.data;Object.keys(M).forEach(z=>{z.endsWith("Enabled")?u[z]=!!M[z]&&M[z]!=="false":u[z]=M[z]||""}),console.log("加载的配置:",u)}}catch(o){console.error("获取配置失败:",o),b().add({title:"错误",description:"获取推送配置失败",color:"red"})}});const W=I(()=>U.subtleBg||"bg-gray-800"),ue=I(()=>U.text||"text-white"),te=I(()=>U.mutedText||"text-gray-300");return(o,p)=>{const M=Ql("USwitch"),z=yl,G=xl,ae=ss,ce=hl;return g(),f("div",Ja,[t("div",Xa,[t("h2",{class:n(["text-xl font-semibold",ue.value])},"推送渠道配置",2)]),t("div",{class:n(["space-y-4",U.disabled?"opacity-60 pointer-events-none":""])},[t("div",{class:n(["rounded p-3",W.value])},[t("div",Ya,[t("span",{class:n(te.value)},"Webhook推送",2),t("div",Za,[a(M,{modelValue:u.webhookEnabled,"onUpdate:modelValue":p[0]||(p[0]=V=>u.webhookEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[1]||(p[1]=V=>S.webhook=!S.webhook),color:S.webhook?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.webhook?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.webhook?(g(),f("div",Qa,[a(G,{modelValue:u.webhookURL,"onUpdate:modelValue":p[2]||(p[2]=V=>u.webhookURL=V),placeholder:"Webhook URL"},null,8,["modelValue"]),t("div",eo,[a(z,{onClick:p[3]||(p[3]=V=>j("webhook")),variant:"ghost",color:"gray"},{default:c(()=>p[38]||(p[38]=[m(" 重置 ")])),_:1}),a(z,{onClick:p[4]||(p[4]=V=>P("webhook")),color:"primary"},{default:c(()=>p[39]||(p[39]=[m(" 保存 ")])),_:1})])])):A("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",to,[t("span",{class:n(te.value)},"Telegram推送",2),t("div",lo,[a(M,{modelValue:u.telegramEnabled,"onUpdate:modelValue":p[5]||(p[5]=V=>u.telegramEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[6]||(p[6]=V=>S.telegram=!S.telegram),color:S.telegram?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.telegram?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.telegram?(g(),f("div",so,[a(G,{modelValue:u.telegramToken,"onUpdate:modelValue":p[7]||(p[7]=V=>u.telegramToken=V),placeholder:"Bot Token"},null,8,["modelValue"]),a(G,{modelValue:u.telegramChatID,"onUpdate:modelValue":p[8]||(p[8]=V=>u.telegramChatID=V),placeholder:"Chat ID"},null,8,["modelValue"]),t("div",ao,[a(z,{onClick:p[9]||(p[9]=V=>j("telegram")),variant:"ghost",color:"gray"},{default:c(()=>p[40]||(p[40]=[m(" 重置 ")])),_:1}),a(z,{onClick:p[10]||(p[10]=V=>P("telegram")),color:"primary"},{default:c(()=>p[41]||(p[41]=[m(" 保存 ")])),_:1})])])):A("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",oo,[t("span",{class:n(te.value)},"企业微信推送",2),t("div",no,[a(M,{modelValue:u.weworkEnabled,"onUpdate:modelValue":p[11]||(p[11]=V=>u.weworkEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[12]||(p[12]=V=>S.wework=!S.wework),color:S.wework?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.wework?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.wework?(g(),f("div",io,[a(G,{modelValue:u.weworkKey,"onUpdate:modelValue":p[13]||(p[13]=V=>u.weworkKey=V),placeholder:"WebHook Key"},null,8,["modelValue"]),t("div",ro,[a(z,{onClick:p[14]||(p[14]=V=>j("wework")),variant:"ghost",color:"gray"},{default:c(()=>p[42]||(p[42]=[m(" 重置 ")])),_:1}),a(z,{onClick:p[15]||(p[15]=V=>P("wework")),color:"primary"},{default:c(()=>p[43]||(p[43]=[m(" 保存 ")])),_:1})])])):A("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",uo,[t("span",{class:n(te.value)},"飞书推送",2),t("div",co,[a(M,{modelValue:u.feishuEnabled,"onUpdate:modelValue":p[16]||(p[16]=V=>u.feishuEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[17]||(p[17]=V=>S.feishu=!S.feishu),color:S.feishu?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.feishu?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.feishu?(g(),f("div",mo,[a(G,{modelValue:u.feishuWebhook,"onUpdate:modelValue":p[18]||(p[18]=V=>u.feishuWebhook=V),placeholder:"WebHook URL"},null,8,["modelValue"]),a(G,{modelValue:u.feishuSecret,"onUpdate:modelValue":p[19]||(p[19]=V=>u.feishuSecret=V),placeholder:"签名密钥",type:"password"},null,8,["modelValue"]),t("div",po,[a(z,{onClick:p[20]||(p[20]=V=>j("feishu")),variant:"ghost",color:"gray"},{default:c(()=>p[44]||(p[44]=[m(" 重置 ")])),_:1}),a(z,{onClick:p[21]||(p[21]=V=>P("feishu")),color:"primary"},{default:c(()=>p[45]||(p[45]=[m(" 保存 ")])),_:1})])])):A("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",vo,[t("span",{class:n(te.value)},"Twitter推送",2),t("div",go,[a(M,{modelValue:u.twitterEnabled,"onUpdate:modelValue":p[22]||(p[22]=V=>u.twitterEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[23]||(p[23]=V=>S.twitter=!S.twitter),color:S.twitter?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.twitter?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.twitter?(g(),f("div",fo,[a(G,{modelValue:u.twitterApiKey,"onUpdate:modelValue":p[24]||(p[24]=V=>u.twitterApiKey=V),placeholder:"API Key"},null,8,["modelValue"]),a(G,{modelValue:u.twitterApiSecret,"onUpdate:modelValue":p[25]||(p[25]=V=>u.twitterApiSecret=V),placeholder:"API Secret"},null,8,["modelValue"]),a(G,{modelValue:u.twitterAccessToken,"onUpdate:modelValue":p[26]||(p[26]=V=>u.twitterAccessToken=V),placeholder:"Access Token"},null,8,["modelValue"]),a(G,{modelValue:u.twitterAccessTokenSecret,"onUpdate:modelValue":p[27]||(p[27]=V=>u.twitterAccessTokenSecret=V),placeholder:"Access Token Secret"},null,8,["modelValue"]),t("div",bo,[a(z,{onClick:p[28]||(p[28]=V=>j("twitter")),variant:"ghost",color:"gray"},{default:c(()=>p[46]||(p[46]=[m("重置")])),_:1}),a(z,{onClick:p[29]||(p[29]=V=>P("twitter")),color:"primary"},{default:c(()=>p[47]||(p[47]=[m("保存")])),_:1})])])):A("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",wo,[t("span",{class:n(te.value)},"自定义HTTP推送",2),t("div",yo,[a(M,{modelValue:u.customHttpEnabled,"onUpdate:modelValue":p[30]||(p[30]=V=>u.customHttpEnabled=V)},null,8,["modelValue"]),a(z,{size:"sm",onClick:p[31]||(p[31]=V=>S.customHttp=!S.customHttp),color:S.customHttp?"gray":"primary",variant:"soft"},{default:c(()=>[m(y(S.customHttp?"取消":"编辑"),1)]),_:1},8,["color"])])]),S.customHttp?(g(),f("div",xo,[a(G,{modelValue:u.customHttpUrl,"onUpdate:modelValue":p[32]||(p[32]=V=>u.customHttpUrl=V),placeholder:"请求URL"},null,8,["modelValue"]),a(ae,{modelValue:u.customHttpMethod,"onUpdate:modelValue":p[33]||(p[33]=V=>u.customHttpMethod=V),options:["POST","PUT","PATCH"]},null,8,["modelValue"]),a(ce,{modelValue:u.customHttpHeaders,"onUpdate:modelValue":p[34]||(p[34]=V=>u.customHttpHeaders=V),placeholder:"请求Headers（JSON格式）"},null,8,["modelValue"]),a(ce,{modelValue:u.customHttpBody,"onUpdate:modelValue":p[35]||(p[35]=V=>u.customHttpBody=V),placeholder:'请求Body模板（如：{"content":"{{content}}"})'},null,8,["modelValue"]),t("div",ho,[a(z,{onClick:p[36]||(p[36]=V=>j("customHttp")),variant:"ghost",color:"gray"},{default:c(()=>p[48]||(p[48]=[m("重置")])),_:1}),a(z,{onClick:p[37]||(p[37]=V=>P("customHttp")),color:"primary"},{default:c(()=>p[49]||(p[49]=[m("保存")])),_:1})])])):A("",!0)],2)],2),t("div",{class:n(["mt-4 flex flex-wrap gap-2",U.disabled?"opacity-60 pointer-events-none":""])},[(g(),f(de,null,me(X,V=>a(z,{key:V,onClick:be=>le(V),class:"flex-grow sm:flex-grow-0",variant:"solid",disabled:U.disabled},{default:c(()=>[m(" 测试"+y(O(V)),1)]),_:2},1032,["onClick","disabled"])),64))],2)])}}}),Co={class:"flex flex-col gap-3 w-full"},Vo={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Uo=["innerHTML"],Eo=["innerHTML"],To=it({__name:"CommentsSettings",props:{config:{},theme:{}},emits:["update:config","comment-system-changed"],setup(v,{emit:J}){const N=v,U=J,u=fe({commentEnabled:!1,commentSystem:"builtin",commentEmailEnabled:!1,commentEmailReplyName:"",commentEmailAdminPrefix:"",commentEmailReplyPrefix:"",commentEmailReplyTemplate:"",commentEmailAdminTemplate:"",commentEmailReplyTemplateHTML:"",commentEmailAdminTemplateHTML:""});Se(()=>N.config,E=>{E&&(u.commentEnabled=!!E.commentEnabled,u.commentSystem="builtin",u.commentEmailEnabled=!!E.commentEmailEnabled,u.commentEmailReplyName=String(E.commentEmailReplyName||""),u.commentEmailAdminPrefix=String(E.commentEmailAdminPrefix||""),u.commentEmailReplyPrefix=String(E.commentEmailReplyPrefix||""),u.commentEmailReplyTemplate=String(E.commentEmailReplyTemplate||""),u.commentEmailAdminTemplate=String(E.commentEmailAdminTemplate||""),u.commentEmailSiteURL=String(E.commentEmailSiteURL||""),u.commentEmailReplyTemplateHTML=String(E.commentEmailReplyTemplateHTML||""),u.commentEmailAdminTemplateHTML=String(E.commentEmailAdminTemplateHTML||""))},{immediate:!0,deep:!0}),Se(()=>u.commentSystem,E=>{const P=String(E||"").toLowerCase();P==="builtin"&&(u.walineServerURL=""),U("comment-system-changed",P)});const S=I(()=>"bg-gray-800");I(()=>"text-slate-400");const X=I(()=>"text-white"),O=I(()=>{var o;const E=String(((o=N.config)==null?void 0:o.siteTitle)||"站点"),P="Mike",le="这里是示例内容",W=String(u.commentEmailSiteURL||""),ue=(W?W.replace(/\/$/,""):"")+"/m/123";return(u.commentEmailReplyTemplateHTML||`
<div>
  <p>您在<strong>{site}</strong>主页上的内容有了新的评论</p>
  <p><strong>{nick}</strong> 回复说：</p>
  <p>{content}</p>
  <p>您可以点击查看回复的完整内容：<a href="{url}" target="_blank">{url}</a></p>
</div>`).replaceAll("{site}",E).replaceAll("{nick}",P).replaceAll("{content}",le).replaceAll("{url}",ue)}),j=I(()=>{var M;const E=String(((M=N.config)==null?void 0:M.siteTitle)||"站点"),P="Mike",le="mike@example.com",W="https://example.com",ue="这里是示例内容",te=String(u.commentEmailSiteURL||""),o=(te?te.replace(/\/$/,""):"")+"/m/123";return(u.commentEmailAdminTemplateHTML||`
<div>
  <p>站点：<strong>{site}</strong></p>
  <p>用户：{nick}（{mail}）</p>
  <p>网址：<a href="{link}" target="_blank">{link}</a></p>
  <p>内容：</p>
  <div>{content}</div>
  <p>查看：<a href="{url}" target="_blank">{url}</a></p>
</div>`).replaceAll("{site}",E).replaceAll("{nick}",P).replaceAll("{mail}",le).replaceAll("{link}",W).replaceAll("{content}",ue).replaceAll("{url}",o)});return(E,P)=>{var ue,te,o,p,M,z,G,ae,ce,V,be,we,Ve,B,Ne,Oe,Pe;const le=xl,W=hl;return g(),f("div",{id:"site-comments-section",class:n(["flex flex-wrap items-center rounded-lg p-3 justify-between gap-3",((ue=E.theme)==null?void 0:ue.subtleBg)||S.value])},[t("div",Co,[u.commentSystem==="builtin"&&!((te=N.config)!=null&&te.commentEmailEnabled)?(g(),f("div",{key:0,class:n(["rounded border p-3",(o=E.theme)==null?void 0:o.border])},[t("div",{class:n(((p=E.theme)==null?void 0:p.text)||X.value)},"开启“邮件通知”后，可配置站点链接地址、主题前缀、发件显示名、文本/HTML 模板，并实时预览。",2)],2)):A("",!0),u.commentSystem==="builtin"&&((M=N.config)!=null&&M.commentEmailEnabled)?(g(),f("div",Vo,[a(le,{modelValue:u.commentEmailSiteURL,"onUpdate:modelValue":P[0]||(P[0]=$=>u.commentEmailSiteURL=$),ui:{base:(z=E.theme)==null?void 0:z.text},placeholder:"站点链接地址（用于邮件中的 {url} 基础） 如 https://note.noisework.cn"},null,8,["modelValue","ui"]),a(le,{modelValue:u.commentEmailReplyName,"onUpdate:modelValue":P[1]||(P[1]=$=>u.commentEmailReplyName=$),ui:{base:(G=E.theme)==null?void 0:G.text},placeholder:"邮件发件显示名（回复通知）"},null,8,["modelValue","ui"]),a(le,{modelValue:u.commentEmailAdminPrefix,"onUpdate:modelValue":P[2]||(P[2]=$=>u.commentEmailAdminPrefix=$),ui:{base:(ae=E.theme)==null?void 0:ae.text},placeholder:"管理员通知主题前缀（可选）"},null,8,["modelValue","ui"]),a(le,{modelValue:u.commentEmailReplyPrefix,"onUpdate:modelValue":P[3]||(P[3]=$=>u.commentEmailReplyPrefix=$),ui:{base:(ce=E.theme)==null?void 0:ce.text},placeholder:"回复通知主题前缀（可选）"},null,8,["modelValue","ui"]),a(W,{modelValue:u.commentEmailReplyTemplate,"onUpdate:modelValue":P[4]||(P[4]=$=>u.commentEmailReplyTemplate=$),ui:{base:(V=E.theme)==null?void 0:V.text},placeholder:"回复通知正文模板（默认示例）支持 {site} {nick} {content} {url}"},null,8,["modelValue","ui"]),a(W,{modelValue:u.commentEmailAdminTemplate,"onUpdate:modelValue":P[5]||(P[5]=$=>u.commentEmailAdminTemplate=$),ui:{base:(be=E.theme)==null?void 0:be.text},placeholder:"管理员通知正文模板（可选）支持 {site} {nick} {mail} {link} {content} {url}"},null,8,["modelValue","ui"]),a(W,{modelValue:u.commentEmailReplyTemplateHTML,"onUpdate:modelValue":P[6]||(P[6]=$=>u.commentEmailReplyTemplateHTML=$),ui:{base:(we=E.theme)==null?void 0:we.text},placeholder:"回复通知 HTML 模板（可选）支持 {site} {nick} {content} {url}"},null,8,["modelValue","ui"]),a(W,{modelValue:u.commentEmailAdminTemplateHTML,"onUpdate:modelValue":P[7]||(P[7]=$=>u.commentEmailAdminTemplateHTML=$),ui:{base:(Ve=E.theme)==null?void 0:Ve.text},placeholder:"管理员通知 HTML 模板（可选）支持 {site} {nick} {mail} {link} {content} {url}"},null,8,["modelValue","ui"]),t("div",{class:n(["md:col-span-3 rounded border p-3",(B=E.theme)==null?void 0:B.border])},[t("div",{class:n((Ne=E.theme)==null?void 0:Ne.text)},"回复通知富文本预览",2),t("div",{class:"mt-2 rounded p-2 email-preview",innerHTML:O.value},null,8,Uo)],2),t("div",{class:n(["md:col-span-3 rounded border p-3",(Oe=E.theme)==null?void 0:Oe.border])},[t("div",{class:n((Pe=E.theme)==null?void 0:Pe.text)},"管理员通知富文本预览",2),t("div",{class:"mt-2 rounded p-2 email-preview",innerHTML:j.value},null,8,Eo)],2)])):A("",!0)])],2)}}}),Lo=Zt(To,[["__scopeId","data-v-f6b93343"]]),Ao={class:"px-4 py-3 flex items-center justify-between"},So={class:"flex items-center gap-2"},Bo={class:"px-4"},$o={class:"flex gap-2 mb-3"},Ro={key:0},jo={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Po={class:"flex items-center justify-between"},Io={class:"flex items-center gap-2"},Do=["src"],_o={class:"mt-2"},Ho={key:1,class:"space-y-2"},Mo={class:"flex items-center gap-2"},zo={key:0,class:"md:col-span-2 flex justify-center mt-2"},No={key:1,class:"md:col-span-2 flex justify-center mt-2"},Oo={key:1},Wo={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fo={class:"flex items-center justify-between"},qo={class:"flex items-center gap-2"},Ko=["src"],Go={class:"mt-2"},Jo={key:1,class:"space-y-2"},Xo={class:"flex items-center gap-2"},Yo={key:0,class:"md:col-span-2 flex justify-center mt-2"},Zo={key:1,class:"md:col-span-2 flex justify-center mt-2"},Qo={class:"flex justify-end gap-2 mt-3"},en=it({__name:"AttachmentManager",props:{theme:{}},setup(v){const J=v,N=C("images"),U=C([]),u=C([]),S=C(!1),X=C({}),O=C(!1),j=C(!1),E=C("image"),P=C(null),le=C(4),W=C(4),ue=Tt().public.baseApi||"/api",te=D=>{const w=typeof window<"u"?window.location.origin:"";return D.startsWith("http")?D:(D.startsWith("/api"),w+D)},o=D=>D<1024?`${D} B`:D<1024*1024?`${(D/1024).toFixed(1)} KB`:D<1024*1024*1024?`${(D/1024/1024).toFixed(1)} MB`:`${(D/1024/1024/1024).toFixed(1)} GB`,p=D=>new Date(D).toLocaleString(),M=D=>!!X.value[D.name],z=D=>{X.value[D.name]=!X.value[D.name]},G=async()=>{const w=await(await fetch(`${ue}/attachments/images`,{credentials:"include"})).json().catch(()=>null),ye=w&&w.code===1&&Array.isArray(w.data)?w.data:[];U.value=ye.filter(se=>/\.(png|jpe?g|gif|webp)$/i.test(String(se.name||""))),le.value=4},ae=async()=>{const w=await(await fetch(`${ue}/attachments/video`,{credentials:"include"})).json().catch(()=>null),ye=w&&w.code===1&&Array.isArray(w.data)?w.data:[];u.value=ye.filter(se=>/\.(mp4|webm|mov|avi)$/i.test(String(se.name||""))),W.value=4},ce=async()=>{try{S.value=!0,await Promise.all([G(),ae()])}finally{S.value=!1}};Ce(ce);const V=(D,w)=>{E.value=D,P.value=w,O.value=!0},be=async()=>{if(P.value)try{j.value=!0;const D=`${ue}/attachments/${E.value==="image"?"images":"video"}/${encodeURIComponent(P.value.name)}`,w=await fetch(D,{method:"DELETE",credentials:"include"}),ye=await w.json().catch(()=>null);if(!w.ok||!ye||ye.code!==1)throw new Error((ye==null?void 0:ye.msg)||"删除失败");b().add({title:"已删除",color:"green"}),O.value=!1,P.value=null,await ce()}catch(D){b().add({title:"删除失败",description:D==null?void 0:D.message,color:"red"})}finally{j.value=!1}},we=I(()=>U.value.slice(0,le.value)),Ve=I(()=>u.value.slice(0,W.value)),B=()=>{le.value+=4},Ne=()=>{W.value+=4},Oe=()=>{le.value=4},Pe=()=>{W.value=4},$=D=>{const w=document.createElement("a");w.href=te(D.url),w.download=D.name||"",document.body.appendChild(w),w.click(),document.body.removeChild(w)},_=I(()=>J.theme||{});return(D,w)=>{var Lt,dt,Qe,pe;const ye=Qt,se=yl,bt=es,el=ls;return g(),f("div",{class:n(["rounded-xl",(Lt=_.value)==null?void 0:Lt.cardBg])},[t("div",Ao,[t("div",{class:n(["font-semibold flex items-center gap-2",(dt=_.value)==null?void 0:dt.text])},[a(ye,{name:"i-heroicons-paper-clip",class:"w-5 h-5 text-indigo-300"}),w[4]||(w[4]=t("span",null,"附件管理",-1))],2),t("div",So,[a(se,{loading:S.value,color:"gray",variant:"soft",class:"shadow",onClick:ce},{default:c(()=>w[5]||(w[5]=[m("刷新")])),_:1},8,["loading"])])]),t("div",Bo,[t("div",$o,[a(se,{color:N.value==="images"?"primary":"gray",variant:"soft",onClick:w[0]||(w[0]=F=>N.value="images")},{default:c(()=>w[6]||(w[6]=[m("图片")])),_:1},8,["color"]),a(se,{color:N.value==="videos"?"primary":"gray",variant:"soft",onClick:w[1]||(w[1]=F=>N.value="videos")},{default:c(()=>w[7]||(w[7]=[m("视频")])),_:1},8,["color"])]),N.value==="images"?(g(),f("div",Ro,[U.value.length===0?(g(),f("div",{key:0,class:n(["text-sm",(Qe=_.value)==null?void 0:Qe.mutedText])},"暂无图片附件",2)):(g(),f("div",jo,[(g(!0),f(de,null,me(we.value,F=>{var Be,We,Fe,qe,et,Ie;return g(),f("div",{key:F.name,class:n(["rounded-lg border p-3",(Be=_.value)==null?void 0:Be.border])},[t("div",Po,[t("div",null,[t("div",{class:n(["text-sm",(We=_.value)==null?void 0:We.text])},y(F.name),3),t("div",{class:n(["text-xs",(Fe=_.value)==null?void 0:Fe.mutedText])},y(o(F.size))+" · "+y(p(F.modified_at)),3)]),t("div",Io,[a(se,{size:"xs",icon:"i-heroicons-arrow-down-tray",color:"gray",variant:"soft",onClick:ne=>$(F)},{default:c(()=>w[8]||(w[8]=[m("下载")])),_:2},1032,["onClick"]),a(se,{size:"xs",icon:"i-heroicons-trash",color:"red",variant:"soft",onClick:ne=>V("image",F)},{default:c(()=>w[9]||(w[9]=[m("删除")])),_:2},1032,["onClick"])])]),t("img",{src:te(F.url),class:"mt-2 rounded w-full max-h-40 object-contain bg-black/20",loading:"lazy"},null,8,Do),t("div",_o,[a(se,{size:"xs",color:"gray",variant:"ghost",onClick:ne=>z(F)},{default:c(()=>[m(y(M(F)?"收起关联内容":"查看关联内容"),1)]),_:2},1032,["onClick"]),M(F)?(g(),f("div",{key:0,class:n(["mt-2 rounded p-2",(qe=_.value)==null?void 0:qe.subtleBg])},[(et=F.belongs)!=null&&et.length?(g(),f("div",Ho,[(g(!0),f(de,null,me(F.belongs,ne=>{var tt,Ke,Le,De;return g(),f("div",{key:ne.id,class:n(["text-xs",(tt=_.value)==null?void 0:tt.text])},[t("div",Mo,[t("span",{class:n(["px-2 py-1 rounded text-[10px]",(Ke=_.value)==null?void 0:Ke.subtleBg])},"#"+y(ne.id),3),t("span",{class:n((Le=_.value)==null?void 0:Le.mutedText)},y(p(ne.created_at)),3)]),t("div",{class:n(["mt-1 line-clamp-2",(De=_.value)==null?void 0:De.mutedText])},y(ne.snippet),3)],2)}),128))])):(g(),f("div",{key:0,class:n(["text-xs",(Ie=_.value)==null?void 0:Ie.mutedText])},"无关联内容",2))],2)):A("",!0)])],2)}),128)),U.value.length>we.value.length?(g(),f("div",zo,[a(se,{color:"gray",variant:"soft",onClick:B},{default:c(()=>w[10]||(w[10]=[m("加载更多")])),_:1})])):U.value.length>4?(g(),f("div",No,[a(se,{color:"gray",variant:"soft",onClick:Oe},{default:c(()=>w[11]||(w[11]=[m("收起")])),_:1})])):A("",!0)]))])):(g(),f("div",Oo,[u.value.length===0?(g(),f("div",{key:0,class:n(["text-sm",(pe=_.value)==null?void 0:pe.mutedText])},"暂无视频附件",2)):(g(),f("div",Wo,[(g(!0),f(de,null,me(Ve.value,F=>{var Be,We,Fe,qe,et,Ie;return g(),f("div",{key:F.name,class:n(["rounded-lg border p-3",(Be=_.value)==null?void 0:Be.border])},[t("div",Fo,[t("div",null,[t("div",{class:n(["text-sm",(We=_.value)==null?void 0:We.text])},y(F.name),3),t("div",{class:n(["text-xs",(Fe=_.value)==null?void 0:Fe.mutedText])},y(o(F.size))+" · "+y(p(F.modified_at)),3)]),t("div",qo,[a(se,{size:"xs",icon:"i-heroicons-arrow-down-tray",color:"gray",variant:"soft",onClick:ne=>$(F)},{default:c(()=>w[12]||(w[12]=[m("下载")])),_:2},1032,["onClick"]),a(se,{size:"xs",icon:"i-heroicons-trash",color:"red",variant:"soft",onClick:ne=>V("video",F)},{default:c(()=>w[13]||(w[13]=[m("删除")])),_:2},1032,["onClick"])])]),t("video",{src:te(F.url),class:"mt-2 rounded w-full max-h-64 bg-black/20",controls:"",preload:"metadata"},null,8,Ko),t("div",Go,[a(se,{size:"xs",color:"gray",variant:"ghost",onClick:ne=>z(F)},{default:c(()=>[m(y(M(F)?"收起关联内容":"查看关联内容"),1)]),_:2},1032,["onClick"]),M(F)?(g(),f("div",{key:0,class:n(["mt-2 rounded p-2",(qe=_.value)==null?void 0:qe.subtleBg])},[(et=F.belongs)!=null&&et.length?(g(),f("div",Jo,[(g(!0),f(de,null,me(F.belongs,ne=>{var tt,Ke,Le,De;return g(),f("div",{key:ne.id,class:n(["text-xs",(tt=_.value)==null?void 0:tt.text])},[t("div",Xo,[t("span",{class:n(["px-2 py-1 rounded text-[10px]",(Ke=_.value)==null?void 0:Ke.subtleBg])},"#"+y(ne.id),3),t("span",{class:n((Le=_.value)==null?void 0:Le.mutedText)},y(p(ne.created_at)),3)]),t("div",{class:n(["mt-1 line-clamp-2",(De=_.value)==null?void 0:De.mutedText])},y(ne.snippet),3)],2)}),128))])):(g(),f("div",{key:0,class:n(["text-xs",(Ie=_.value)==null?void 0:Ie.mutedText])},"无关联内容",2))],2)):A("",!0)])],2)}),128)),u.value.length>Ve.value.length?(g(),f("div",Yo,[a(se,{color:"gray",variant:"soft",onClick:Ne},{default:c(()=>w[14]||(w[14]=[m("加载更多")])),_:1})])):u.value.length>4?(g(),f("div",Zo,[a(se,{color:"gray",variant:"soft",onClick:Pe},{default:c(()=>w[15]||(w[15]=[m("收起")])),_:1})])):A("",!0)]))]))]),a(el,{modelValue:O.value,"onUpdate:modelValue":w[3]||(w[3]=F=>O.value=F)},{default:c(()=>{var F;return[a(bt,{class:n((F=_.value)==null?void 0:F.cardBg)},{default:c(()=>{var Be;return[t("div",{class:n(["text-sm",(Be=_.value)==null?void 0:Be.text])},"确定删除该"+y(E.value==="image"?"图片":"视频")+"附件吗？此操作不可恢复。",3),t("div",Qo,[a(se,{color:"gray",variant:"soft",onClick:w[2]||(w[2]=We=>O.value=!1)},{default:c(()=>w[16]||(w[16]=[m("取消")])),_:1}),a(se,{color:"red",loading:j.value,onClick:be},{default:c(()=>w[17]||(w[17]=[m("确认删除")])),_:1},8,["loading"])])]}),_:1},8,["class"])]}),_:1},8,["modelValue"])],2)}}}),tn={class:"min-h-screen w-full"},ln={class:"px-4 py-4 border-b border-slate-700/40 flex flex-col items-center gap-2"},sn=["src"],an={class:"w-full text-center"},on={class:"font-semibold truncate"},nn={class:"flex-1 overflow-y-auto px-2 py-3 space-y-2"},dn={key:0,class:"space-y-2"},rn={class:"px-4 py-3 border-t border-slate-700/40"},un={class:"text-xs text-slate-400"},cn={class:"mt-2 flex items-center gap-2"},mn={key:0,class:"mt-2 text-orange-400 flex items-center gap-2"},pn={class:"flex items-center gap-2"},vn={class:"flex items-center gap-2"},gn={class:"flex-1 px-4 pb-24 flex flex-col w-full space-y-4"},fn={class:"col-span-12"},bn={class:"col-span-12"},wn={class:"px-4 py-3 flex items-center justify-between"},yn={class:"flex items-center gap-4"},xn={class:"flex items-center gap-3"},hn={class:"flex items-center"},kn={class:"flex items-center"},Cn={class:"flex items-center"},Vn={class:"flex items-center"},Un={class:"flex items-center gap-2"},En={id:"system-section",class:"col-span-12"},Tn={class:"px-4 py-3 flex flex-wrap items-center gap-6"},Ln={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},An={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},Sn={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},Bn={key:2,id:"user-section",class:"col-span-12"},$n={class:"px-4 pb-4 grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-x-4"},Rn={class:"flex justify-between items-center mb-2"},jn={key:0},Pn={class:"flex justify-end gap-2"},In={key:1},Dn={class:"mt-3"},_n={class:"flex justify-between items-center mb-2"},Hn={class:"flex items-center gap-2"},Mn={class:"flex items-center gap-3"},zn=["src"],Nn={class:"flex items-center gap-2 w-full mt-2"},On={class:"p-4"},Wn={class:"mx-auto",style:{width:"240px",height:"240px","border-radius":"9999px",overflow:"hidden",position:"relative",background:"#111"}},Fn=["src"],qn={class:"mt-3 flex items-center gap-3"},Kn={class:"mt-3"},Gn={class:"flex justify-between items-center mb-2"},Jn={key:0},Xn={class:"flex justify-end gap-2"},Yn={key:1},Zn={class:"flex justify-between items-center mb-2"},Qn={class:"flex items-center gap-2"},ei={key:0,class:"mb-2"},ti={class:"flex items-center gap-2 w-full flex-nowrap"},li={key:1},si={class:"mt-3 flex items-center justify-between"},ai={key:1,class:"inline-flex items-center px-2 py-0.5 rounded-md text-amber-400 border border-amber-400/40"},oi={class:"flex justify-between items-center mb-2"},ni={key:0},ii={class:"w-full mb-2 flex items-center gap-2"},di={class:"w-full mb-2 flex items-center gap-2"},ri={class:"w-full mb-2 flex items-center gap-2"},ui={class:"flex justify-end gap-2"},ci={class:"flex justify-between items-center mb-2"},mi={key:0},pi={class:"w-full mb-2 flex items-center gap-2"},vi={class:"w-full mb-2 flex items-center gap-2"},gi={class:"flex justify-between items-center mb-2"},fi={key:0},bi={class:"w-full mb-2 flex items-center gap-2"},wi={class:"w-full mb-2 flex items-center gap-2"},yi={key:0,class:"w-full mb-2 flex items-center gap-2"},xi={id:"site-section",class:"col-span-12"},hi={class:"flex items-center justify-between px-4 py-3"},ki={class:"px-4 pb-4 space-y-4"},Ci={class:"flex justify-between items-center mb-3"},Vi={class:"flex items-center gap-2"},Ui={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ei={class:"md:col-span-2"},Ti={class:"flex items-center gap-4"},Li={class:"flex items-center"},Ai={class:"flex items-center"},Si={class:"flex justify-between items-center mb-3"},Bi={class:"flex items-center gap-4"},$i={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ri={class:"md:col-span-2"},ji={class:"flex items-center gap-4"},Pi={class:"flex items-center"},Ii={class:"flex items-center"},Di={class:"flex items-center gap-4"},_i={class:"flex justify-end"},Hi={id:"site-music-section",class:"col-span-12 mt-4"},Mi={class:"flex items-center justify-between px-4 py-3"},zi={class:"flex items-center gap-3"},Ni={class:"px-4 pb-4"},Oi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wi={key:0},Fi={key:1},qi={class:"flex items-center gap-2 md:col-span-2"},Ki={class:"flex justify-end gap-2"},Gi={class:"flex items-center gap-4"},Ji={class:"flex items-center"},Xi={class:"flex items-center"},Yi={id:"site-configs-section",class:"space-y-4"},Zi={class:"flex justify-between items-center mb-2"},Qi={key:0},ed={key:0,class:"space-y-3"},td=["src","onClick"],ld={class:"flex items-center gap-2"},sd={class:"flex items-center justify-center gap-3"},ad={key:0,class:"mt-3"},od={key:1,class:"space-y-2"},nd={class:"flex items-center gap-3"},id=["src"],dd={class:"flex justify-end gap-2"},rd={key:1},ud={key:0,class:"grid grid-cols-3 gap-2"},cd=["src","onClick"],md={key:1,class:"flex items-center gap-3"},pd=["src"],vd={key:0,class:"flex justify-end gap-2"},gd={id:"site-ads-section",class:"col-span-12"},fd={class:"flex items-center justify-between px-4 py-3"},bd={class:"flex items-center gap-3"},wd={class:"px-4 pb-4"},yd={class:"mt-2"},xd={class:"space-y-2"},hd={class:"flex items-center justify-between mb-2"},kd={class:"flex items-center gap-2"},Cd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Vd={class:"flex items-center justify-between"},Ud={class:"flex items-center gap-2"},Ed={class:"flex items-center gap-2"},Td={class:"flex justify-end mt-3"},Ld={id:"hitokoto-section",class:"col-span-12"},Ad={class:"flex items-center justify-between px-4 py-3"},Sd={class:"flex items-center gap-3"},Bd={class:"px-4 pb-4"},$d={id:"site-social-links-section",class:"col-span-12"},Rd={class:"flex items-center justify-between px-4 py-3"},jd={class:"flex items-center gap-3"},Pd={class:"px-4 pb-4"},Id={key:0,class:"space-y-2"},Dd={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},_d={class:"flex justify-end mt-2"},Hd={class:"flex items-center justify-between"},Md={id:"friend-links-section",class:"col-span-12 mt-4"},zd={class:"flex items-center justify-between px-4 py-3"},Nd={class:"flex items-center gap-3"},Od={class:"px-4 pb-4"},Wd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fd={class:"flex items-center gap-2"},qd={class:"flex justify-end gap-2 mt-2"},Kd={class:"flex items-center justify-between"},Gd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Jd={key:3,id:"friend-links-audit",class:"col-span-12 mt-4"},Xd={class:"flex items-center justify-between px-4 py-3"},Yd={class:"flex items-center gap-2"},Zd={class:"px-4 pb-4"},Qd={key:1,class:"space-y-2"},er={class:"flex items-center justify-between gap-2"},tr={class:"flex items-center gap-2"},lr={id:"comments-section",class:"col-span-12"},sr={class:"flex items-center justify-between px-4 py-3"},ar={class:"flex flex-wrap items-center gap-x-4 gap-y-2 justify-end"},or={class:"flex items-center gap-2 w-full sm:w-auto"},nr={class:"flex items-center gap-2 w-full sm:w-auto"},ir={class:"flex items-center gap-2 w-full sm:w-auto"},dr={class:"px-4 pb-4"},rr={class:"flex items-center gap-2 mb-2"},ur={key:0,class:"space-y-2"},cr={class:"flex items-center justify-between gap-2"},mr={key:0,class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},pr={class:"md:col-span-3"},vr=["href"],gr={class:"md:col-span-3 flex gap-2"},fr={key:0,class:"flex justify-center"},br={class:"flex justify-between items-center"},wr={class:"space-y-3"},yr={class:"text-sm"},xr={class:"text-sm"},hr={class:"text-sm"},kr={class:"text-sm break-words"},Cr={class:"flex items-center gap-2 text-sm"},Vr={class:"flex justify-end gap-2"},Ur={key:4,id:"email-section",class:"col-span-12"},Er={class:"flex items-center justify-between px-4 py-3"},Tr={class:"flex items-center gap-3"},Lr={class:"px-4 pb-4"},Ar={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Sr={class:"text-xs"},Br={class:"flex justify-end gap-2 mt-3"},$r={key:5,id:"admin-users-section",class:"col-span-12"},Rr={class:"flex items-center justify-between px-4 py-3"},jr={class:"px-4 pb-4"},Pr={class:"flex items-center gap-2"},Ir={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"},Dr={class:"flex items-center justify-between gap-2 min-w-0"},_r={class:"mt-2 flex items-center gap-2"},Hr={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},Mr={class:"mt-3"},zr={class:"flex items-center gap-2"},Nr={class:"space-y-3"},Or={class:"flex items-center gap-2"},Wr={class:"flex items-center gap-2"},Fr={class:"flex justify-end gap-2"},qr={key:6,id:"notify-section",class:"col-span-12"},Kr={class:"flex items-center justify-between px-4 py-3"},Gr={class:"flex items-center gap-3"},Jr={class:"flex items-center gap-2"},Xr={class:"px-4 pb-4"},Yr={key:7,id:"site-github-login-section",class:"col-span-12"},Zr={class:"flex items-center justify-between px-4 py-3"},Qr={class:"flex items-center gap-3"},eu={class:"flex items-center gap-2"},tu={class:"px-4 pb-4 space-y-3"},lu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},su={class:"md:col-span-2"},au={class:"flex justify-end gap-2"},ou={key:8,id:"attachments-section",class:"col-span-12"},nu={key:9,id:"db-section",class:"col-span-12"},iu={class:"flex items-center justify-between px-4 py-3"},du={class:"flex gap-2 flex-wrap justify-end items-center"},ru={class:"px-4 pb-4 space-y-4"},uu={class:"flex items-center gap-3"},cu={class:"flex items-center gap-2"},mu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},pu={key:0,class:"flex items-center gap-2"},vu={class:"md:col-span-2"},gu={class:"flex justify-end gap-2 mt-2"},fu={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3"},bu={class:"md:col-span-2 flex flex-wrap items-center gap-4"},wu={class:"flex items-center gap-2"},yu={class:"flex items-center gap-2"},xu={key:0,class:"flex items-center gap-2"},hu={class:"flex items-center gap-3 ml-auto"},ku={class:"flex gap-2"},Cu={class:"flex gap-2"},Vu={class:"flex justify-end gap-2 mt-2"},Uu={key:0},Eu={key:1,class:"flex gap-2"},Tu={class:"flex justify-between items-center"},Lu={class:"p-2"},Au=["src"],je="rounded-2xl border shadow-2xl",Su=it({__name:"StatusPanel",emits:["restore-success"],setup(v,{emit:J}){const N=C(!0),U=C(!1),u=C(typeof window<"u"&&localStorage.getItem("adminTheme")||"dark"),S=Tt().public.baseApi||"/api",X=C(""),O=I(()=>{var h,x,k,Y;if(X.value)return X.value;const l=String(((h=B.user)==null?void 0:h.avatar_url)||((x=B.user)==null?void 0:x.AvatarURL)||"").trim(),e=((k=B.user)==null?void 0:k.username)||((Y=B.user)==null?void 0:Y.Username)||"",d=ee=>ee?/^https?:\/\//i.test(ee)?ee:`${S}${ee}`:"",i=(ee,ge=100)=>ee?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(ee)}&backgroundType=gradient&radius=50&scale=100&size=${ge}`:"";return d(l)||(e?i(String(e)):"")||"/favicon-32x32.png"}),j=async(l,e)=>{await Ea();const d=document.getElementById(`${l}-section`);d&&(d.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.innerWidth<768&&(U.value=!1))};Ce(()=>{fl(),U.value=window.innerWidth>=768;try{const l=document.documentElement,e=u.value!=="light",d=l.classList.contains("dark");e&&!d?l.classList.add("dark"):!e&&d&&l.classList.remove("dark")}catch{}}),Se(()=>u.value,l=>{try{const e=document.documentElement,d=l!=="light",i=e.classList.contains("dark");d&&!i?e.classList.add("dark"):!d&&i&&e.classList.remove("dark")}catch{}});const E=C(typeof window<"u"?window.innerWidth>=768:!0),P=()=>{typeof window>"u"||(E.value=window.innerWidth>=768)};Ce(()=>{P(),typeof window<"u"&&window.addEventListener("resize",P)}),Fl(()=>{typeof window<"u"&&window.removeEventListener("resize",P)});const le=C(!1),W=C(null),ue=I(()=>u.value==="light"?"bg-gray-100 hover:bg-gray-200 text-slate-900":"bg-slate-800/70 hover:bg-slate-700/70 text-white");let te=null;Ce(()=>{const l=W.value;l&&(te=()=>{le.value=l.scrollTop>8},l.addEventListener("scroll",te))}),Fl(()=>{const l=W.value;l&&te&&l.removeEventListener("scroll",te)});const o=I(()=>u.value==="light"?{sidebarBg:"bg-white/90",headerBg:"bg-white",bottomBg:"bg-white",cardBg:"bg-white",subtleBg:"bg-white",border:"border-gray-300",text:"text-slate-900",sidebarText:"text-slate-900",mutedText:"text-slate-700",pageBg:"bg-gray-50",navBtnBg:"bg-gray-100",navBtnHoverBg:"hover:bg-gray-200"}:u.value==="dark"?{sidebarBg:"bg-gray-950/80",headerBg:"bg-gray-950/70",bottomBg:"bg-gray-950/70",cardBg:"bg-gray-900/70",subtleBg:"bg-gray-900/50",border:"border-gray-800/60",text:"text-white",sidebarText:"text-white",mutedText:"text-gray-300",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:u.value==="midnight"?{sidebarBg:"bg-indigo-950/60",headerBg:"bg-indigo-950/50",bottomBg:"bg-indigo-950/50",cardBg:"bg-indigo-900/40",subtleBg:"bg-indigo-950/30",border:"border-indigo-800/40",text:"text-white",sidebarText:"text-white",mutedText:"text-indigo-200",pageBg:"bg-gradient-to-br from-indigo-950 via-indigo-900 to-slate-900",navBtnBg:"bg-indigo-950/40",navBtnHoverBg:"hover:bg-indigo-900/40"}:u.value==="slate"?{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}),p=C([]),M=C(""),z=l=>{const e=String(l||"").toLowerCase();return e==="approved"?"bg-green-500/20 text-green-400":e==="rejected"?"bg-red-500/20 text-red-400":"bg-gray-500/20 text-gray-300"},G=async()=>{try{const l=(M.value||"").trim(),e=await nt("friend-links/apply",l?{q:l}:void 0,{credentials:"include"});if(e&&e.code===1)p.value=Array.isArray(e.data)?e.data:[],b().add({title:"已刷新",description:`共 ${p.value.length} 条申请`,color:"green"});else throw new Error((e==null?void 0:e.msg)||"加载失败")}catch(l){b().add({title:"加载失败",description:l.message||"请稍后重试",color:"red"})}},ae=async l=>{const e=prompt("可填写通过说明（选填）：","");await V(l,!0,e||"")},ce=async l=>{const e=prompt("请填写拒绝原因（选填）：","");await V(l,!1,e||"")},V=async(l,e,d)=>{try{const i=await $e(`friend-links/${l.id}/audit`,{approve:e,feedback:d},{credentials:"include"});if(i&&i.code===1)b().add({title:"成功",description:e?"已通过并入库展示":"已拒绝并通知",color:e?"green":"orange"}),await He(),await G(),window.dispatchEvent(new Event("frontend-config-updated"));else throw new Error((i==null?void 0:i.msg)||"操作失败")}catch(i){b().add({title:"操作失败",description:i.message||"请稍后重试",color:"red"})}},be=async()=>{localStorage.setItem("adminTheme",u.value);try{const l=document.documentElement,e=u.value!=="light",d=l.classList.contains("dark");e&&!d?l.classList.add("dark"):!e&&d&&l.classList.remove("dark")}catch{}try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let d={};e.code===1?d={...e.data,adminTheme:u.value}:d={adminTheme:u.value};const i=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});(await i.json()).code===1&&b().add({title:(i==null?void 0:i.msg)||"已保存",color:"green"})}catch{}},we=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();e.code===1&&typeof e.data.allowRegistration=="boolean"&&(N.value=e.data.allowRegistration)}catch{b().add({title:"获取注册配置失败",color:"red"})}};Ce(we);const Ve=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let d={};e.code===1?d={...e.data,allowRegistration:N.value}:d={allowRegistration:N.value};const h=await(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).json();if(h.code===1)b().add({title:"保存成功",color:"green"});else throw new Error(h.msg||"保存失败")}catch{b().add({title:"保存失败",color:"red"})}},B=Yl(),{login:Ne,register:Oe}=Ga(),Pe=Zl(),$=C(""),_=fe({checking:!1,hasUpdate:!1,latestVersion:"",currentVersion:""});let D=fe({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:""});const w=fe({enabled:!1,driver:"smtp",host:"",port:"",user:"",pass:"",from:"",tls:!1,encryption:"tls"}),ye=C(!1),se=async()=>{try{const l=await nt("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};w.enabled=!!e.smtpEnabled,w.driver=e.smtpDriver||"smtp",w.host=e.smtpHost||"",w.port=(e.smtpPort??"").toString(),w.user=e.smtpUser||"",w.pass=e.smtpPass||"",w.from=e.smtpFrom||"",w.tls=!!e.smtpTLS,w.encryption=e.smtpEncryption||(w.tls?"tls":"ssl")}}catch{}};Ce(se);const bt=async()=>{try{const l=await nt("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.smtpEnabled=w.enabled,e.smtpDriver=w.driver,e.smtpHost=w.host,e.smtpPort=parseInt(w.port||"0")||0,e.smtpUser=w.user,e.smtpPass=w.pass,e.smtpFrom=w.from,e.smtpEncryption=w.encryption,e.smtpTLS=w.encryption==="tls";const d=await $e("settings",e,{credentials:"include"});if(d&&d.code===1)b().add({title:(d==null?void 0:d.msg)||"已保存",color:"green"});else throw new Error((d==null?void 0:d.msg)||"保存失败")}catch(l){b().add({title:"保存失败",description:l.message,color:"red"})}},el=C([]);C("");const Lt=C(""),dt=C(!1),Qe=C(!1),pe=fe({newPass:"",confirmPass:""}),F=I(()=>{const l=pe.newPass||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),Be=I(()=>F.value<=1?"弱":F.value===2?"中":"强"),We=I(()=>F.value<=1?"red":F.value===2?"orange":"green"),Fe=I(()=>!pe.newPass||!pe.confirmPass||pe.newPass!==pe.confirmPass?!1:F.value>=2),qe=async()=>{try{const l=await nt("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};el.value=Array.isArray(e.adminUsers)?e.adminUsers:[],Lt.value=e.adminPasswordMasked||""}}catch{}};Ce(qe);const et=async()=>{try{if(!Fe.value)throw new Error("请填写符合强度的新密码并确认一致");const l=await nt("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.adminPasswordReset=pe.newPass;const d=await $e("settings",e,{credentials:"include"});if(d&&d.code===1)b().add({title:(d==null?void 0:d.msg)||"管理员密码已重置",color:"green"}),await qe(),dt.value=!1,Qe.value=!1,pe.newPass="",pe.confirmPass="";else throw new Error((d==null?void 0:d.msg)||"重置失败")}catch(l){b().add({title:"重置失败",description:l.message,color:"red"})}},Ie=C(""),ne=I(()=>{const l=B.status||{},e=l.users||l.Users||[];return Array.isArray(e)?e:[]}),tt=I(()=>{const l=(Ie.value||"").trim().toLowerCase();return l?ne.value.filter(e=>{const d=String(e.id??e.ID??e.user_id??""),i=String(e.username??e.Username??"").toLowerCase();return d.includes(l)||i.includes(l)}):ne.value}),Ke=async()=>{await B.getStatus()},Le=C(!1),De=C({}),tl=l=>!!De.value[String(l.id??l.ID)],as=l=>{const e=String(l.id??l.ID);De.value[e]=!De.value[e]},wt=fe({password:{}}),At=C(!1),os=l=>(wt.password[String(l.id??l.ID)]||"").trim().length>=6,ns=async l=>{try{const e=l.id??l.ID??l.user_id,d=(wt.password[String(e)]||"").trim();if(d.length<6)throw new Error("密码至少6位");const i=await ke("user/reset_password",{id:e,password:d},{credentials:"include"});if(i&&i.code===1)b().add({title:(i==null?void 0:i.msg)||"已重置密码",color:"green"}),wt.password[String(e)]="";else throw new Error((i==null?void 0:i.msg)||"重置失败")}catch(e){b().add({title:"重置失败",description:e.message,color:"red"})}},is=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要切换用户“${e}”的管理员权限吗？`)||!window.confirm("该操作存在风险，是否继续？"))return;const d=l.id??l.ID??l.user_id,i=await $e(`user/admin?id=${d}`,{},{credentials:"include"});if(i&&i.code===1)b().add({title:(i==null?void 0:i.msg)||"已更新管理员状态",color:"green"}),await B.getStatus();else throw new Error((i==null?void 0:i.msg)||"更新失败")}catch(e){b().add({title:"更新失败",description:e.message,color:"red"})}},ds=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要删除用户“${e}”吗？删除后不可恢复。`)||!window.confirm("该操作存在风险，是否继续？"))return;const d=l.id??l.ID??l.user_id,i=await ql("user",{id:d},{credentials:"include"});if(i&&i.code===1)b().add({title:(i==null?void 0:i.msg)||"已删除用户",color:"green"}),await B.getStatus();else throw new Error((i==null?void 0:i.msg)||"删除失败")}catch(e){b().add({title:"删除失败",description:e.message,color:"red"})}},ll=C(!1),rs=async()=>{try{const l=(w.from||w.user||"").trim();if(!l||!w.host||!w.port||!w.user||!w.pass||!w.encryption)throw new Error("请完整填写地址、主机、端口、加密协议、用户名和密码");ll.value=!0,w.enabled||(w.enabled=!0,await bt());let e=await ke("notify/test",{type:"email",to:l},{credentials:"include"});if((!e||e.code!==1)&&(e=await ke("email/test",{to:l},{credentials:"include"})),e&&e.code===1)b().add({title:(e==null?void 0:e.msg)||"测试邮件已发送",color:"green"});else throw new Error((e==null?void 0:e.msg)||"发送失败或接口不存在")}catch(l){b().add({title:"失败",description:l.message,color:"red"})}finally{ll.value=!1}},us=()=>{try{if(!r.githubOAuthEnabled)throw new Error("请先开启 GitHub 登录");if(!r.githubClientId||!r.githubCallbackURL)throw new Error("请先填写 Client ID 与回调地址");const l=Tt().public.baseApi||"/api";window.open(`${l}/oauth/github/login`,"_blank")}catch(l){b().add({title:"无法测试",description:l.message,color:"red"})}},cs=async()=>{_.checking=!0;try{const e=await(await fetch("/api/version/check",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if(e.code===1){const{hasUpdate:d,lastUpdateTime:i}=e.data;_.hasUpdate=d,_.latestVersion=new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d?b().add({title:"发现版本",description:`最新版本发布于 ${_.latestVersion}`,color:"orange"}):b().add({title:"已是最新版本",description:"当前使用的是最新版本",color:"green"})}else throw new Error(e.msg||"检查更新失败")}catch(l){console.error("检查版本更新失败:",l),b().add({title:"检查更新失败",description:"请科学上网后重试",color:"red"})}finally{_.checking=!1}};Ce(async()=>{var l;try{const d=await(await fetch("/api/version",{credentials:"include"})).json();d&&d.code===1&&(_.currentVersion=String(((l=d.data)==null?void 0:l.version)||""))}catch{}});const ms=async()=>{var l;if(!B.isLogin){b().add({title:"错误",description:"请先登录",color:"red"});return}try{if(typeof window<"u"&&!window.confirm("重新生成将使旧 Token 失效，确认继续？"))return;ol.value=!0;const e=await fetch("/api/user/token/regenerate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),d=await e.json();if(!e.ok)throw new Error(d.msg||"Token生成请求失败");if(d.code===1&&((l=d.data)!=null&&l.token))$.value=d.data.token,rt.value=!1,b().add({title:"成功",description:(d==null?void 0:d.msg)||"Token 已更新",color:"green"});else throw new Error(d.msg||"Token 生成失败")}catch(e){console.error("Token生成错误:",e),b().add({title:"错误",description:e.message||"Token 生成失败",color:"red"})}finally{ol.value=!1}},ps=async()=>{try{await navigator.clipboard.writeText($.value),b().add({title:"成功",description:"Token 已复制到剪贴板",color:"green"})}catch{b().add({title:"错误",description:"复制失败",color:"red"})}},kl=async()=>{try{const l=await fetch("/api/user/logout",{method:"POST",credentials:"include"}),e=await l.json().catch(()=>({}));if(!l.ok||e.code!==1)throw new Error((e==null?void 0:e.msg)||"退出失败");B.clearUserStatus(),b().add({title:"成功",description:"已退出登录",color:"green"}),Pe.push("/")}catch{B.clearUserStatus(),b().add({title:"成功",description:"已退出登录",color:"green"}),Pe.push("/")}},St=I(()=>(B==null?void 0:B.isLogin)??!1),Ue=I(()=>{var l;return((l=B.user)==null?void 0:l.is_admin)??!1}),Ge=C(!0),Bt=C(!1),Cl=C(!1),lt=C(null),yt=C(null),$t=C(null),Vl=C(null),Ae=C(!1),xt=C(""),ht=C(!1),_e=C(""),kt=C(1),Rt=C(0),jt=C(0);let sl=!1,Pt={x:0,y:0};const T=fe({username:"",description:"",oldPassword:"",newPassword:"",confirmPassword:"",email:"",emailCode:"",newEmail:"",changeCode:""}),K=fe({username:!1,description:!1,password:!1,emailBind:!1,emailChange:!1}),al=C(!1),rt=C(!1),ol=C(!1),It=C(!1),Dt=C(!1),_t=C(!1),ut=I(()=>{const l=T.newPassword||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),vs=I(()=>ut.value<=1?"弱":ut.value===2?"中":"强"),gs=I(()=>ut.value<=1?"red":ut.value===2?"orange":"green"),fs=I(()=>!T.oldPassword||!T.newPassword||!T.confirmPassword||T.newPassword===T.oldPassword||T.newPassword!==T.confirmPassword?!1:ut.value>=2),bs=async()=>{try{if(!T.username.trim())throw new Error("用户名不能为空");const l=await $e("user/update",{username:T.username,type:"username"},{credentials:"include"});if(l&&l.code===1)await B.getUser(),K.username=!1,T.username="",b().add({title:"成功",description:(l==null?void 0:l.msg)||"用户名已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){b().add({title:"错误",description:l.message||"更新失败",color:"red"})}},ws=async()=>{try{const l=(T.description||"").trim(),e=await $e("user/update",{description:l},{credentials:"include"});if(e&&e.code===1)await B.getUser(),K.description=!1,T.description="",b().add({title:"成功",description:"个性签名已更新",color:"green"});else throw new Error((e==null?void 0:e.msg)||"保存失败")}catch(l){b().add({title:"错误",description:(l==null?void 0:l.message)||"更新失败",color:"red"})}},ys=async()=>{try{if(!T.newPassword||!T.oldPassword||!T.confirmPassword)throw new Error("密码不能为空");if(T.newPassword===T.oldPassword)throw new Error("新密码不能与当前密码相同");if(T.newPassword!==T.confirmPassword)throw new Error("两次输入不一致");if(ut.value<2)throw new Error("密码强度不足");const l=await $e("user/change_password",{password:T.newPassword,oldPassword:T.oldPassword},{credentials:"include"});if(l&&l.code===1)K.password=!1,T.oldPassword="",T.newPassword="",T.confirmPassword="",b().add({title:"成功",description:(l==null?void 0:l.msg)||"密码已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){b().add({title:"错误",description:l.message||"更新失败",color:"red"})}},xs=async()=>{try{const l=String(T.email||"").trim();if(!l)throw new Error("邮箱不能为空");const e=await ke("user/email/bind",{email:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"发送失败");b().add({title:"成功",description:"验证码已发送",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"发送失败",color:"red"})}},hs=async()=>{try{const l=String(T.emailCode||"").trim();if(!l)throw new Error("请输入验证码");const e=await ke("user/email/verify",{code:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"绑定失败");await B.getUser(),K.emailBind=!1,T.email="",T.emailCode="",b().add({title:"成功",description:"邮箱已绑定",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"绑定失败",color:"red"})}},ks=async()=>{try{const l=await ke("user/email/change/send_code",{},{credentials:"include"});if(!l||l.code!==1)throw new Error((l==null?void 0:l.msg)||"发送失败");b().add({title:"成功",description:"验证码已发送到当前邮箱",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"发送失败",color:"red"})}},Cs=async()=>{try{const l=String(T.changeCode||"").trim(),e=String(T.newEmail||"").trim();if(!l||!e)throw new Error("请输入验证码与新邮箱");const d=await ke("user/email/change",{code:l,newEmail:e},{credentials:"include"});if(!d||d.code!==1)throw new Error((d==null?void 0:d.msg)||"更换失败");al.value=!0,T.email=e,T.emailCode="",b().add({title:"成功",description:"已向新邮箱发送验证码，请在下方输入验证码完成更换",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"更换失败",color:"red"})}},Vs=async()=>{try{const l=String(T.emailCode||"").trim();if(!l)throw new Error("请输入新邮箱验证码");const e=await ke("user/email/verify",{code:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"确认失败");al.value=!1,K.emailChange=!1,T.changeCode="",T.newEmail="",T.email="",T.emailCode="",await B.getUser(),b().add({title:"成功",description:"邮箱已更换",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"确认失败",color:"red"})}},Us=()=>{var l;(l=lt.value)==null||l.click()},Es=()=>{var e,d;const l=((d=(e=lt.value)==null?void 0:e.files)==null?void 0:d[0])||null;Vl.value=l||null,l&&(_e.value=URL.createObjectURL(l),X.value=_e.value,kt.value=1,Rt.value=0,jt.value=0,ht.value=!0)},Ts=async l=>{try{if(!l){b().add({title:"错误",description:"请先选择头像图片",color:"red"});return}Ae.value=!0;const e=new FormData;e.append("image",l);const d=await fetch("/api/images/upload",{method:"POST",body:e,credentials:"include"}),i=await d.json().catch(()=>({}));if(!d.ok||i.code!==1||!i.data)throw new Error((i==null?void 0:i.msg)||"上传失败");const h=String(i.data||"").trim(),x=await $e("user/update",{avatar_url:h},{credentials:"include"});if(!x||x.code!==1)throw new Error((x==null?void 0:x.msg)||"保存失败");await B.getUser(),b().add({title:"成功",description:"头像已更新",color:"green"}),Vl.value=null,lt.value&&(lt.value.value=""),X.value=""}catch(e){b().add({title:"错误",description:e.message||"操作失败",color:"red"})}finally{Ae.value=!1}},Ls=async()=>{try{const l=String(xt.value||"").trim();if(!l)throw new Error("请填写头像链接");if(!/^https?:\/\//i.test(l)&&!l.startsWith("/api"))throw new Error("链接需以 http 或 /api 开头");Ae.value=!0,X.value=l.startsWith("http")?l:`${S}${l}`;const e=await $e("user/update",{avatar_url:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"保存失败");await B.getUser(),b().add({title:"成功",description:"头像链接已保存",color:"green"})}catch(l){b().add({title:"错误",description:l.message||"操作失败",color:"red"})}finally{Ae.value=!1}};Se(xt,l=>{const e=String(l||"").trim();if(!e){X.value="";return}/^https?:\/\//i.test(e)?X.value=e:e.startsWith("/api")&&(X.value=`${S}${e}`)});const Ul=l=>{sl=!0;const e=l.touches?l.touches[0]:l;Pt={x:e.clientX,y:e.clientY},window.addEventListener("mousemove",Ht),window.addEventListener("mouseup",Mt),window.addEventListener("touchmove",Ht),window.addEventListener("touchend",Mt)},Ht=l=>{if(!sl)return;const e=l.touches?l.touches[0]:l,d=e.clientX-Pt.x,i=e.clientY-Pt.y;Rt.value+=d,jt.value+=i,Pt={x:e.clientX,y:e.clientY}},Mt=()=>{sl=!1,window.removeEventListener("mousemove",Ht),window.removeEventListener("mouseup",Mt),window.removeEventListener("touchmove",Ht),window.removeEventListener("touchend",Mt)},As=async()=>{try{if(!_e.value)return;Ae.value=!0;const l=await new Promise((xe,q)=>{const Z=new Image;Z.crossOrigin="anonymous",Z.onload=()=>xe(Z),Z.onerror=q,Z.src=_e.value}),e=400,d=document.createElement("canvas");d.width=e,d.height=e;const i=d.getContext("2d"),h=kt.value,x=l.naturalWidth,k=l.naturalHeight,Y=x*h,ee=k*h,ge=e/2+Rt.value-Y/2,re=e/2+jt.value-ee/2;i.clearRect(0,0,e,e),i.drawImage(l,ge,re,Y,ee);const Ye=await new Promise(xe=>d.toBlob(q=>xe(q),"image/png")),Ee=new File([Ye],"avatar.png",{type:"image/png"});await Ts(Ee),ht.value=!1,_e.value&&URL.revokeObjectURL(_e.value),_e.value="",X.value=""}catch(l){b().add({title:"错误",description:l.message||"裁剪失败",color:"red"})}finally{Ae.value=!1}},Ss=()=>{ht.value=!1},Bs=async()=>{var l,e;try{const d=String(((l=B.user)==null?void 0:l.username)||((e=B.user)==null?void 0:e.Username)||"").trim();if(!d)throw new Error("请先设置用户名");const i=`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(d)}&backgroundType=gradient&radius=50&scale=100&size=100`;Ae.value=!0;const h=await $e("user/update",{avatar_url:i},{credentials:"include"});if(!h||h.code!==1)throw new Error((h==null?void 0:h.msg)||"保存失败");await B.getUser(),X.value="",xt.value="",lt.value&&(lt.value.value=""),b().add({title:"成功",description:"已切换为首字母头像",color:"green"})}catch(d){b().add({title:"错误",description:(d==null?void 0:d.message)||"操作失败",color:"red"})}finally{Ae.value=!1}},nl={siteTitle:"站点标题",subtitleText:"欢迎语",backgrounds:"背景图片",cardFooterTitle:"卡片页脚标题",cardFooterLink:"卡片页脚链接",pageFooterHTML:"页面底部HTML",rssTitle:"RSS 标题",rssDescription:"RSS 描述",rssAuthorName:"RSS 作者",rssFaviconURL:"RSS 图标链接",commentPageTitle:"留言页面标题",commentPageDescription:"留言页面说明",aboutPageTitle:"关于页面标题",aboutPageDescription:"关于页面说明",aboutMarkdown:"关于页面 Markdown 内容"},r=fe({siteTitle:"",subtitleText:"",welcomeName:"",welcomeAvatarURL:"",welcomeDescription:"",welcomeUseAdmin:!1,backgrounds:[],cardFooterTitle:"",cardFooterLink:"",pageFooterHTML:"",rssTitle:"",rssDescription:"",rssAuthorName:"",rssFaviconURL:"",hitokotoEnabled:!0,friendLinks:[],linksTitle:"",linksDescription:"",linksApplyTitle:"",linksApplyText:"",friendLinkEmailEnabled:!1,commentPageTitle:"",commentPageDescription:"",aboutPageTitle:"",aboutPageDescription:"",aboutMarkdown:"",walineServerURL:"",commentEnabled:!0,commentSystem:"builtin",commentEmailEnabled:!1,commentLoginRequired:!0,githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",notifyEnabled:!1,enableGithubCard:!1,pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"light",announcementText:"",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1,musicCssCdnURL:"",musicJsCdnURL:"",socialLinks:[],calendarEnabled:!0,timeEnabled:!0,leftAdEnabled:!0,leftAdImageURL:"https://picsum.photos/seed/single-ad/640/640",leftAdLinkURL:"https://note.noisework.cn",leftAdDescription:"示例广告（单条配置）",leftAds:[{imageURL:"https://picsum.photos/seed/ad-1/640/640",linkURL:"https://note.noisework.cn",description:"写作与记录，开启灵感之旅"},{imageURL:"https://picsum.photos/seed/ad-2/640/640",linkURL:"https://noisework.cn",description:"探索新主题与小工具"},{imageURL:"https://picsum.photos/seed/ad-3/640/640",linkURL:"https://github.com",description:"开源项目，欢迎 Star"}],leftAdsIntervalMs:4e3}),Je=I({get:()=>r.enableGithubCard===!0,set:l=>{const e=l===!0||l==="true"||l===1||l==="1";r.enableGithubCard=e}}),st=fe({username:"",password:""}),ve=fe({siteTitle:!1,subtitleText:!1,backgrounds:!1,cardFooterTitle:!1,cardFooterLink:!1,pageFooterHTML:!1,rssTitle:!1,rssDescription:!1,rssAuthorName:!1,rssFaviconURL:!1,walineServerURL:!1,socialLinks:!1,friendLinkEmailEnabled:!1,commentPageTitle:!1,commentPageDescription:!1,aboutPageTitle:!1,aboutPageDescription:!1}),ie={siteTitle:"说说笔记",subtitleText:"欢迎访问，点击头像可更换封面背景！",avatarURL:"",welcomeName:"",welcomeAvatarURL:"",welcomeDescription:"",welcomeUseAdmin:!1,backgrounds:["https://s2.loli.net/2025/03/27/KJ1trnU2ksbFEYM.jpg","https://s2.loli.net/2025/03/27/MZqaLczCvwjSmW7.jpg","https://s2.loli.net/2025/03/27/UMijKXwJ9yTqSeE.jpg","https://s2.loli.net/2025/03/27/WJQIlkXvBg2afcR.jpg","https://s2.loli.net/2025/03/27/oHNQtf4spkq2iln.jpg","https://s2.loli.net/2025/03/27/PMRuX5loc6Uaimw.jpg","https://s2.loli.net/2025/03/27/U2WIslbNyTLt4rD.jpg","https://s2.loli.net/2025/03/27/xu1jZL5Og4pqT9d.jpg","https://s2.loli.net/2025/03/27/OXqwzZ6v3PVIns9.jpg","https://s2.loli.net/2025/03/27/HGuqlE6apgNywbh.jpg","https://s2.loli.net/2025/03/26/d7iyuPYA8cRqD1K.jpg","https://s2.loli.net/2025/03/27/wYy12qDMH6bGJOI.jpg","https://s2.loli.net/2025/03/27/y67m2k5xcSdTsHN.jpg"],cardFooterTitle:"Noise·说说·笔记~",cardFooterLink:"note.noisework.cn",pageFooterHTML:'<div class="text-center text-xs text-gray-400 py-4">来自<a href="https://www.noisework.cn" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Noise</a> 使用<a href="https://github.com/rcy1314/echo-noise" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Ech0-Noise</a>发布</div>',rssTitle:"Noise的说说笔记",rssDescription:"一个说说笔记~",rssAuthorName:"Noise",rssFaviconURL:"/favicon.ico",hitokotoEnabled:!0,linksTitle:"友情链接",linksDescription:"推荐站点和朋友们的主页",linksApplyTitle:"申请友链须知",linksApplyText:"请提供站点名称、网址、图标（可选）、简介与有效邮箱。提交后需管理员审核，审核通过后展示。",friendLinkEmailEnabled:!1,commentPageTitle:"留言",commentPageDescription:"欢迎留下你的看法",aboutPageTitle:"关于本站",aboutPageDescription:"这里是站点的介绍与说明",aboutMarkdown:`# 关于我

这里是一个默认的个人简介示例：

- 喜欢记录与分享
- 热爱开源与学习
- 持续打磨产品体验

欢迎通过友链或留言与我交流！`,walineServerURL:"请前往waline官网https://waline.js.org查看部署配置",githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"light",announcementText:"欢迎访问我的说说笔记！",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"2141128031",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1,musicCssCdnURL:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css",musicJsCdnURL:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js",socialLinks:[{name:"GitHub",url:"https://github.com/rcy1314",icon:"i-mdi-github"},{name:"X",url:"https://x.com/liangwenhao3",icon:"i-mdi-twitter"},{name:"主页",url:"https://www.noisework.cn/",icon:"i-mdi-home"},{name:"博客",url:"https://www.noiseblogs.top/",icon:"i-mdi-notebook"}],friendLinks:[{title:"NoiseWork",link:"https://www.noisework.cn/",icon:"i-mdi-home",description:"个人主页与作品集合"},{title:"NoiseBlogs",link:"https://www.noiseblogs.top/",icon:"i-mdi-notebook",description:"技术随笔与学习记录"}],calendarEnabled:!0,timeEnabled:!0,leftAdEnabled:!0,leftAds:[{imageURL:"https://picsum.photos/seed/ad-1/640/640",linkURL:"https://note.noisework.cn",description:"写作与记录，开启灵感之旅"},{imageURL:"https://picsum.photos/seed/ad-2/640/640",linkURL:"https://noisework.cn",description:"探索新主题与小工具"},{imageURL:"https://picsum.photos/seed/ad-3/640/640",linkURL:"https://github.com",description:"开源项目，欢迎 Star"}],leftAdsIntervalMs:4e3},$s=l=>{r[l]=ie[l],ve[l]=!1},He=async()=>{var l,e;try{const i=await(await fetch("/api/frontend/config",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if((l=i==null?void 0:i.data)!=null&&l.frontendSettings){const h=i.data.frontendSettings,x=["enableGithubCard","pwaEnabled","announcementEnabled","hitokotoEnabled","musicEnabled","musicLyric","musicAutoplay","musicDefaultMinimized","musicEmbed","commentEnabled","commentEmailEnabled","commentLoginRequired","githubOAuthEnabled","notifyEnabled","calendarEnabled","timeEnabled","leftAdEnabled","welcomeUseAdmin","friendLinkEmailEnabled"];if(Object.keys(r).forEach(q=>{if(q==="backgrounds"){const Z=h[q];Array.isArray(Z)&&(r[q]=[...Z])}else if(q==="socialLinks"){const Z=h[q];Array.isArray(Z)?r[q]=[...Z]:r[q]=[...ie.socialLinks||[]]}else if(q==="leftAds"){const Z=h[q];Array.isArray(Z)?r[q]=[...Z]:r[q]=[...ie.leftAds||[]]}else if(q==="friendLinks"){const Z=h[q];Array.isArray(Z)?r[q]=[...Z]:r[q]=[...ie.friendLinks||[]]}else if(x.includes(q)){const Z=h[q]??ie[q];r[q]=Z===!0||Z==="true"}else{const Z=h[q]??ie[q];r[q]=typeof Z=="string"?Z.trim():Z}}),h.enableGithubCard!==void 0){const q=h.enableGithubCard;r.enableGithubCard=q===!0||q==="true"}const k=(r.pwaTitle||r.siteTitle||"说说笔记").trim(),Y=(r.rssFaviconURL||"/favicon.ico").trim(),ee=(r.pwaDescription||"").trim();if(!!r.pwaEnabled)Ta({title:k,meta:[{name:"description",content:ee},{name:"theme-color",content:"#000000"}],link:[{rel:"manifest",href:"/manifest.webmanifest"},{rel:"icon",href:Y},{rel:"apple-touch-icon",href:Y}]});else try{const q=document.querySelector('link[rel="manifest"]');q&&((e=q.parentElement)==null||e.removeChild(q)),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(async Z=>{for(const gt of Z)await gt.unregister();const Gt=await caches.keys();await Promise.all(Gt.map(gt=>caches.delete(gt)))})}catch{}const re=String(r.musicCssCdnURL||"").trim(),Ye=String(r.musicJsCdnURL||"").trim();(re||Ye)&&Bl();const Ee=String(r.musicCssCdnURL||"").trim().toLowerCase(),xe=String(r.musicJsCdnURL||"").trim().toLowerCase();Ee.includes("api.hypcvgm.top")&&xe.includes("api.hypcvgm.top")?ze.value="hypcvgm":Ee.includes("jsdelivr")&&xe.includes("jsdelivr")?ze.value="jsdelivr":Ee.includes("unpkg")&&xe.includes("unpkg")?ze.value="unpkg":ze.value="custom"}}catch(d){console.error("获取配置失败:",d)}},oe=async l=>{try{if(l==="backgrounds"){const h=r.backgrounds.filter(x=>x&&x.trim()!=="");r.backgrounds=h}if(l==="leftAds"){const h=(r.leftAds||[]).map(x=>({imageURL:String((x==null?void 0:x.imageURL)||"").trim(),linkURL:String((x==null?void 0:x.linkURL)||"").trim(),description:String((x==null?void 0:x.description)||"").trim()})).filter(x=>x.imageURL!=="");r.leftAds=h}const d=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:r})});if(!d.ok){const h=await d.json();throw new Error(h.msg||"请求失败")}const i=await d.json();if(i.code===1){if(ve[l]=!1,await He(),l==="leftAds"||l==="leftAdEnabled")b().add({title:"成功",description:"广告模块更新成功",color:"green"});else if(l==="announcementEnabled"){const h=!!r.announcementEnabled;b().add({title:"成功",description:h?"已开启公告":"已关闭公告",color:h?"green":"gray"})}else{const h=l==="defaultContentTheme"?"默认主题色":nl[l]||(l==="pwa"?"PWA 设置":l);b().add({title:"成功",description:`${h}已更新`,color:"green"})}if(l==="defaultContentTheme"){const h=(r.defaultContentTheme||"dark").trim()}}else throw new Error(i.msg||"保存失败")}catch(e){console.error("保存配置失败:",e);const d=l==="defaultContentTheme"?"默认主题色":nl[l]||l;b().add({title:"失败",description:`${d}保存失败`,color:"red"})}},Rs=async()=>{try{const e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:r})}),d=await e.json();if(e.ok&&d.code===1){if(await He(),b().add({title:"成功",description:"PWA 设置已更新",color:"green"}),"serviceWorker"in navigator){const i=await navigator.serviceWorker.getRegistrations();if(r.pwaEnabled)await navigator.serviceWorker.register("/sw.js");else{for(const x of i)await x.unregister();const h=await caches.keys();await Promise.all(h.map(x=>caches.delete(x)))}}window.dispatchEvent(new Event("frontend-config-updated"))}else throw new Error(d.msg||"保存失败")}catch(l){b().add({title:"错误",description:l.message||"保存失败",color:"red"})}},js=async()=>{var l,e;try{const i=await(await fetch("/api/status",{credentials:"include"})).json().catch(()=>({})),h=((l=i==null?void 0:i.data)==null?void 0:l.users)||((e=i==null?void 0:i.data)==null?void 0:e.Users)||[],x=Array.isArray(h)?h.find(Y=>!!((Y==null?void 0:Y.is_admin)??(Y==null?void 0:Y.IsAdmin))):null,k=Tt().public.baseApi||"/api";if(x){const Y=String((x==null?void 0:x.username)||(x==null?void 0:x.Username)||"").trim(),ee=String((x==null?void 0:x.avatar_url)||(x==null?void 0:x.AvatarURL)||"").trim(),ge=String((x==null?void 0:x.description)||"").trim();r.welcomeName=Y||r.welcomeName||"",r.welcomeAvatarURL=ee?ee.startsWith("http")?ee:`${k}${ee}`:r.welcomeAvatarURL||"",r.welcomeDescription=ge||r.welcomeDescription||"",r.welcomeUseAdmin=!0,b().add({title:"已填充管理员信息",color:"green"})}else b().add({title:"未找到管理员",color:"orange"})}catch(d){b().add({title:"失败",description:(d==null?void 0:d.message)||"获取失败",color:"red"})}},Ps=()=>{r.welcomeName="",r.welcomeAvatarURL="",r.welcomeDescription="",r.welcomeUseAdmin=!1,b().add({title:"已重置欢迎组件",color:"gray"})},Is=async l=>{const e=l.target.files;if(!(!e||!e[0]))try{const d=e[0],i=new FormData;i.append("image",d);const h=await fetch("/api/images/upload",{method:"POST",credentials:"include",body:i}),x=await h.json().catch(()=>({}));if(!h.ok||x.code!==1||!x.data)throw new Error((x==null?void 0:x.msg)||"上传失败");const k=String(x.data||"").startsWith("http")?x.data:`/api${x.data}`;r.avatarURL=k,await oe("avatarURL"),b().add({title:"成功",description:"站点头像已更新",color:"green"})}catch(d){b().add({title:"失败",description:(d==null?void 0:d.message)||"上传失败",color:"red"})}finally{$t.value&&($t.value.value="")}},El=async()=>{try{const l={frontendSettings:{commentEnabled:!!r.commentEnabled,commentSystem:"builtin",commentEmailEnabled:!!r.commentEmailEnabled,commentLoginRequired:!!r.commentLoginRequired}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)await He(),window.dispatchEvent(new Event("frontend-config-updated")),b().add({title:"成功",description:"评论设置已更新",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){b().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Tl=C(!1);Se(()=>r.commentLoginRequired,async()=>{if(!Tl.value||gl.value){Tl.value=!0;return}try{await El()}catch{}});const Ds=()=>{r.socialLinks.push({name:"",url:"",icon:""})},_s=l=>{r.socialLinks.splice(l,1)},Hs=async()=>{try{await oe("socialLinks"),window.dispatchEvent(new Event("frontend-config-updated")),b().add({title:"成功",description:"社交链接已更新",color:"green"})}catch(l){b().add({title:"错误",description:(l==null?void 0:l.message)||"保存失败",color:"red"})}},zt=C(""),Me=C(!1),ct=C([]),mt=C(1),Nt=C(!1),Ct=C({}),il=C("builtin"),Ll=l=>{try{const e=new Date(l);if(isNaN(e.getTime()))return String(l);const d=i=>i.toString().padStart(2,"0");return`${e.getFullYear()}-${d(e.getMonth()+1)}-${d(e.getDate())} ${d(e.getHours())}:${d(e.getMinutes())}`}catch{return String(l)}},Ms=()=>{Me.value=!Me.value,Me.value&&Al()},dl=l=>!!Ct.value[l.id],zs=l=>{Ct.value[l.id]=!Ct.value[l.id]},Al=async()=>{var l,e;try{Me.value=!0,ct.value.splice(0),mt.value=1;const d=(zt.value||"").trim(),i=await nt("comments",{q:d,page:mt.value,pageSize:5},{credentials:"include"});if(i&&i.code===1){const h=Array.isArray((l=i.data)==null?void 0:l.items)?i.data.items:[];h.forEach(k=>{ct.value.push(k),Ct.value[k.id]=!0});const x=Number(((e=i.data)==null?void 0:e.total)||0);Nt.value=mt.value*5<x,h.length===0?b().add({title:"无结果",description:"未找到匹配评论",color:"gray"}):b().add({title:"已加载",description:`本页 ${h.length} 条${Nt.value?"，还有更多":""}`,color:"green"})}else throw new Error((i==null?void 0:i.msg)||"加载失败")}catch(d){b().add({title:"加载失败",description:d.message,color:"red"})}},Ns=async()=>{var l,e;try{mt.value+=1;const d=(zt.value||"").trim(),i=await nt("comments",{q:d,page:mt.value,pageSize:5},{credentials:"include"});if(i&&i.code===1){(Array.isArray((l=i.data)==null?void 0:l.items)?i.data.items:[]).forEach(k=>ct.value.push(k));const x=Number(((e=i.data)==null?void 0:e.total)||0);Nt.value=mt.value*5<x}else throw new Error((i==null?void 0:i.msg)||"加载失败")}catch(d){b().add({title:"加载失败",description:d.message,color:"red"})}},Os=async l=>{try{const e=await ql(`messages/${l.message_id}/comments/${l.id}`,void 0,{credentials:"include"});if(e&&e.code===1){const d=ct.value.findIndex(i=>i.id===l.id);d>=0&&ct.value.splice(d,1),delete Ct.value[l.id],b().add({title:"成功",description:"已删除该评论",color:"green"})}else throw new Error((e==null?void 0:e.msg)||"删除失败")}catch(e){b().add({title:"删除失败",description:e.message,color:"red"})}},Ot=C(!1),pt=C(!1),Xe=C(null),Ws=I(()=>{var e;const l=String(((e=Xe.value)==null?void 0:e.content)||"").trim();return l.length>120?l.slice(0,120)+"...":l}),Fs=l=>{confirm("确认删除该评论吗？此操作不可恢复。")&&(Xe.value=l,pt.value=!1,Ot.value=!0)},rl=()=>{pt.value=!1,Ot.value=!1,Xe.value=null},qs=async()=>{if(!pt.value||!Xe.value){b().add({title:"请先勾选确认",color:"orange"});return}await Os(Xe.value),rl()};Se(()=>String(r.commentSystem||"").toLowerCase(),l=>{il.value=l,l!=="builtin"&&(Me.value=!1)}),Se(()=>!!r.commentEnabled,l=>{l||(Me.value=!1)});const Ks=async()=>{try{const l={frontendSettings:{enableGithubCard:!!Je.value}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)r.enableGithubCard=!!Je.value,await He(),window.dispatchEvent(new Event("frontend-config-updated")),b().add({title:"成功",description:"GitHub 解析设置已保存",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){b().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Sl=async()=>{try{const l={frontendSettings:{musicEnabled:!!r.musicEnabled,musicPlaylistId:String(r.musicPlaylistId||""),musicSongId:String(r.musicSongId||""),musicPosition:String(r.musicPosition||"bottom-left"),musicTheme:String(r.musicTheme||"auto"),musicLyric:!!r.musicLyric,musicAutoplay:!!r.musicAutoplay,musicDefaultMinimized:!!r.musicDefaultMinimized,musicEmbed:!!r.musicEmbed,musicCssCdnURL:String(r.musicCssCdnURL||""),musicJsCdnURL:String(r.musicJsCdnURL||"")}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)await He(),Bl(),window.dispatchEvent(new Event("frontend-config-updated")),b().add({title:"成功",description:"音乐配置已更新",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){b().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Gs=()=>{r.musicEnabled=ie.musicEnabled,r.musicPlaylistId=ie.musicPlaylistId,r.musicSongId=ie.musicSongId,r.musicPosition=ie.musicPosition,r.musicTheme=ie.musicTheme,r.musicLyric=ie.musicLyric,r.musicAutoplay=ie.musicAutoplay,r.musicDefaultMinimized=ie.musicDefaultMinimized,r.musicEmbed=ie.musicEmbed,r.musicCssCdnURL=ie.musicCssCdnURL,r.musicJsCdnURL=ie.musicJsCdnURL},Js=()=>{r.leftAdEnabled=!0;const l=ie,e=Array.isArray(l.leftAds)?l.leftAds:[];r.leftAds=e.map(d=>({imageURL:String((d==null?void 0:d.imageURL)||""),linkURL:String((d==null?void 0:d.linkURL)||""),description:String((d==null?void 0:d.description)||"")})),r.leftAdsIntervalMs=Number(l.leftAdsIntervalMs)},ul=I({get:()=>r.musicEmbed?"embed":"float",set:l=>{r.musicEmbed=l==="embed"}}),ze=C("hypcvgm"),Bl=()=>{};Se(ze,l=>{l==="hypcvgm"?(r.musicCssCdnURL="https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css",r.musicJsCdnURL="https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js"):l==="jsdelivr"?(r.musicCssCdnURL="https://cdn.jsdelivr.net/gh/ImBHCN/NeteaseMiniPlayer@v2/netease-mini-player-v2.css",r.musicJsCdnURL="https://cdn.jsdelivr.net/gh/ImBHCN/NeteaseMiniPlayer@v2/netease-mini-player-v2.js"):l==="unpkg"&&(r.musicCssCdnURL="https://unpkg.com/netease-mini-player/dist/netease-mini-player-v2.css",r.musicJsCdnURL="https://unpkg.com/netease-mini-player/dist/netease-mini-player-v2.js")});const Xs=async()=>{try{await oe("githubOAuthEnabled"),await oe("githubClientId"),await oe("githubClientSecret"),await oe("githubCallbackURL"),b().add({title:"成功",description:"GitHub 登录配置已保存",color:"green"})}catch(l){b().add({title:"错误",description:(l==null?void 0:l.message)||"保存失败",color:"red"})}},cl=C(!1),Wt=C(0),ml=C(""),Ys=async l=>{const e=l.target.files;if(!e)return;const d=["image/jpeg","image/png","image/webp"];for(const i of Array.from(e))try{if(!d.includes(i.type))throw new Error("仅支持 JPG/PNG/WEBP 格式");cl.value=!0,Wt.value=0,ml.value=i.name;const h=new FormData;h.append("image",i);const x=new XMLHttpRequest,k=await new Promise((re,Ye)=>{x.upload.onprogress=Ee=>{Ee.lengthComputable&&(Wt.value=Math.round(Ee.loaded/Ee.total*100))},x.onreadystatechange=()=>{if(x.readyState===4)if(x.status>=200&&x.status<300)try{re(JSON.parse(x.responseText))}catch{Ye(new Error("响应解析失败"))}else Ye(new Error("上传失败"))},x.open("POST","/api/images/upload",!0),x.withCredentials=!0,x.send(h)});if(!k||k.code!==1)throw new Error((k==null?void 0:k.msg)||"上传失败");const Y=String(k.data||""),ee=Y.startsWith("http")?Y:`/api${Y}`,ge=[...r.backgrounds,ee];r.backgrounds=ge,await oe("backgrounds"),b().add({title:"上传成功",description:`${i.name} 已添加到背景图片列表`,color:"green"})}catch(h){b().add({title:"错误",description:(h==null?void 0:h.message)||"上传失败",color:"red"})}finally{cl.value=!1,Wt.value=0,ml.value=""}yt.value&&(yt.value.value="")};Ce(()=>{window.addEventListener("frontend-config-updated",l=>{const{key:e,value:d}=l.detail;e&&d!==void 0&&(r[e]=d);try{const i=document.documentElement,h=u.value!=="light",x=i.classList.contains("dark");h&&!x?i.classList.add("dark"):!h&&x&&i.classList.remove("dark")}catch{}})});const Zs=()=>{He(),Cl.value=!1},Qs=async()=>{r.backgrounds.push("")},ea=async l=>{r.backgrounds.splice(l,1),await oe("backgrounds")},ta=()=>{var l;(l=yt.value)==null||l.click()},pl=C(!1),$l=C(""),vl=l=>{l&&($l.value=l,pl.value=!0)},la=l=>{if(l<=0)return;const e=[...r.backgrounds],[d]=e.splice(l,1);e.splice(l-1,0,d),r.backgrounds=e},sa=l=>{const e=[...r.backgrounds];if(l>=e.length-1)return;const[d]=e.splice(l,1);e.splice(l+1,0,d),r.backgrounds=e},aa=l=>{var h;const e=(h=l.dataTransfer)==null?void 0:h.files;if(!e||e.length===0)return;const d=yt.value;if(!d)return;const i=new DataTransfer;Array.from(e).forEach(x=>i.items.add(x)),d.files=i.files,d.dispatchEvent(new Event("change"))};Se(()=>B.isLogin,l=>{l||(B.getStatus(),B.getUser(),B.$reset())});const gl=C(!1);Ce(async()=>{var l;try{if(gl.value=!0,await Promise.all([B.getStatus(),B.getUser(),He(),we()]),B.isLogin){const d=await(await fetch("/api/user/token",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();d.code===1&&((l=d.data)!=null&&l.token)&&($.value=d.data.token)}}catch(e){console.error("初始化失败:",e),b().add({title:"系统提示",description:"当前未登录",color:"red",timeout:3e3})}finally{gl.value=!1}});const Vt=C(null),vt=C("sqlite"),oa=I(()=>({sqlite:"SQLite",postgres:"Postgres",mysql:"MySQL",other:"其它"})[vt.value]||vt.value),na=async()=>{try{const l=await fetch("/api/backup/download",{credentials:"include"});if(!l.ok)throw new Error("下载失败");const e=await l.blob(),d=window.URL.createObjectURL(e),i=document.createElement("a");i.href=d,i.download=`noise_backup_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(d),document.body.removeChild(i)}catch(l){b().add({title:"错误",description:l.message||"备份下载失败",color:"red"})}},ia=()=>{var l;(l=Vt.value)==null||l.click()},da=J,Rl=async l=>{const e=l.target.files;if(!(!e||!e[0])){try{const d=new FormData;d.append("database",e[0]);const h=await(await fetch("/api/backup/restore",{method:"POST",credentials:"include",body:d})).json();if(h.code===1)b().add({title:"成功",description:"数据库恢复成功",color:"green"}),da("restore-success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(h.msg)}catch(d){b().add({title:"错误",description:d.message||"数据库恢复失败",color:"red"})}Vt.value&&(Vt.value.value="")}},Q=C(!1),L=fe({provider:"",endpoint:"",region:"",bucket:"",accessKey:"",secretKey:"",usePathStyle:!0,publicBaseURL:""}),at=C(!1),Ut=C("instant"),Ft=C(15),jl=C(""),qt=C(""),Kt=C(""),fl=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();if((e==null?void 0:e.code)===1){const d=(e.data.dbType||"sqlite").toLowerCase();vt.value=d==="sqlite"||d==="postgres"||d==="mysql"?d:"other",Q.value=!!e.data.storageEnabled;const i=e.data.storageConfig||{};L.provider=i.provider||"",L.endpoint=i.endpoint||"",L.region=i.region||"",L.bucket=i.bucket||"",L.accessKey=i.accessKey||"",L.secretKey=i.secretKey||"",L.usePathStyle=!!i.usePathStyle,L.publicBaseURL=i.publicBaseURL||"",at.value=!!i.autoSyncEnabled,Ut.value=i.syncMode||"instant",Ft.value=Number(i.syncIntervalMinute||15),jl.value=(i.lastSyncTime||"").replace("T"," ").replace("Z","")}}catch{}},ra=async()=>{try{const l={storageEnabled:Q.value,storageConfig:{...L,autoSyncEnabled:at.value,syncMode:Ut.value,syncIntervalMinute:Ft.value}},d=await(await fetch("/api/settings",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json();if((d==null?void 0:d.code)===1)b().add({title:"已保存云存储配置",color:"green"});else throw new Error((d==null?void 0:d.msg)||"保存失败")}catch(l){b().add({title:"保存失败",description:l.message,color:"red"})}},ua=async()=>{try{const e=await(await fetch("/api/backup/storage/sync-now",{method:"POST",credentials:"include"})).json();if((e==null?void 0:e.code)===1)b().add({title:"已同步到云端",color:"green"}),await fl();else throw new Error((e==null?void 0:e.msg)||"同步失败")}catch(l){b().add({title:"同步失败",description:l.message,color:"red"})}};Se(()=>L.provider,l=>{l==="r2"?(L.usePathStyle=!0,L.region||(L.region="auto")):l==="s3"&&L.usePathStyle===void 0&&(L.usePathStyle=!1)});const ca=async()=>{try{const l=qt.value.trim();if(!l)throw new Error("请填写预签名上传URL");const e=await ke("backup/storage/upload",{uploadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)b().add({title:"云备份上传成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"上传失败")}catch(l){b().add({title:"上传失败",description:l.message,color:"red"})}},ma=async()=>{try{const l=Kt.value.trim();if(!l)throw new Error("请填写预签名下载URL");const e=await ke("backup/storage/restore",{downloadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)b().add({title:"云备份恢复成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"恢复失败")}catch(l){b().add({title:"恢复失败",description:l.message,color:"red"})}},pa=async()=>{var l;try{const e=await ke("backup/storage/presign/upload",{objectKey:"backup.zip",contentType:"application/zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))qt.value=e.data.url,b().add({title:"生成上传预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){b().add({title:"生成失败",description:e.message,color:"red"})}},va=async()=>{var l;try{const e=await ke("backup/storage/presign/download",{objectKey:"backup.zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))Kt.value=e.data.url,b().add({title:"生成下载预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){b().add({title:"生成失败",description:e.message,color:"red"})}},ga=async()=>{try{const l=(L.publicBaseURL||"").trim();if(!l)throw new Error("请先在配置中填写公共访问前缀");const e=(l.endsWith("/")?l:l+"/")+"backup.zip",d=await ke("backup/storage/restore",{downloadURL:e},{credentials:"include"});if((d==null?void 0:d.code)===1)b().add({title:"云备份恢复成功",color:"green"});else throw new Error((d==null?void 0:d.msg)||"恢复失败")}catch(l){b().add({title:"恢复失败",description:l.message,color:"red"})}};return C(null),(l,e)=>{var Gt,gt,Pl,Il,Dl,_l,Hl,Ml,zl,Nl,Ol;const d=Qt,i=yl,h=za,x=Sa,k=xl,Y=hl,ee=Ra,ge=ls,re=ss,Ye=Ba,Ee=es,xe=Ql("USwitch"),q=ja,Z=Aa;return g(),f("div",{class:n(["fixed inset-0 w-full h-full overflow-x-hidden overflow-y-auto",o.value.pageBg])},[t("div",tn,[t("aside",{class:n(["w-72 h-screen overflow-y-auto backdrop-blur-md flex flex-col fixed left-0 top-0 z-40 transition-transform duration-300 md:transition-none border-r",[{"translate-x-0":U.value,"-translate-x-full md:translate-x-0":!U.value},o.value.sidebarBg,o.value.border,o.value.sidebarText]])},[t("div",ln,[t("img",{src:O.value,class:"w-14 h-14 rounded-full ring-2 ring-indigo-400/60 shadow-lg object-cover",alt:"avatar"},null,8,sn),t("div",an,[t("div",on,y(((Gt=Te(B).user)==null?void 0:Gt.username)||"未登录"),1),t("div",{class:n(["text-xs",o.value.mutedText])},"总笔记 "+y(((Pl=(gt=Te(B))==null?void 0:gt.status)==null?void 0:Pl.total_messages)||0),3)])]),t("nav",nn,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[0]||(e[0]=s=>j("system"))},[a(d,{name:"i-heroicons-cpu-chip",class:"w-5 h-5 text-indigo-300"}),e[204]||(e[204]=t("span",{class:"text-sm text-center"},"系统信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[1]||(e[1]=s=>j("user"))},[a(d,{name:"i-heroicons-user-circle",class:"w-5 h-5 text-indigo-300"}),e[205]||(e[205]=t("span",{class:"text-sm text-center"},"用户信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[2]||(e[2]=s=>j("site"))},[a(d,{name:"i-heroicons-wrench-screwdriver",class:"w-5 h-5 text-indigo-300"}),e[206]||(e[206]=t("span",{class:"text-sm text-center"},"网站配置",-1))],2),Ue.value?(g(),f("div",dn,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[3]||(e[3]=s=>j("site-register"))},[a(d,{name:"i-heroicons-user-plus",class:"w-5 h-5 text-indigo-300"}),e[207]||(e[207]=t("span",{class:"text-sm text-center"},"注册开关",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[4]||(e[4]=s=>j("site-pwa"))},[a(d,{name:"i-heroicons-rocket-launch",class:"w-5 h-5 text-indigo-300"}),e[208]||(e[208]=t("span",{class:"text-sm text-center"},"PWA 模式",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[5]||(e[5]=s=>j("site-github-card"))},[a(d,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[209]||(e[209]=t("span",{class:"text-sm text-center"},"GitHub 卡片",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[6]||(e[6]=s=>j("site-github-login"))},[a(d,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[210]||(e[210]=t("span",{class:"text-sm text-center"},"GitHub 登录",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[7]||(e[7]=s=>j("site-announcement"))},[a(d,{name:"i-heroicons-megaphone",class:"w-5 h-5 text-indigo-300"}),e[211]||(e[211]=t("span",{class:"text-sm text-center"},"公告栏",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[8]||(e[8]=s=>j("site-music"))},[a(d,{name:"i-heroicons-musical-note",class:"w-5 h-5 text-indigo-300"}),e[212]||(e[212]=t("span",{class:"text-sm text-center"},"音乐配置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[9]||(e[9]=s=>j("site-default-theme"))},[a(d,{name:"i-heroicons-swatch",class:"w-5 h-5 text-indigo-300"}),e[213]||(e[213]=t("span",{class:"text-sm text-center"},"默认主题",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[10]||(e[10]=s=>j("site-configs"))},[a(d,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5 text-indigo-300"}),e[214]||(e[214]=t("span",{class:"text-sm text-center"},"站点信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[11]||(e[11]=s=>j("comments"))},[a(d,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5 text-indigo-300"}),e[215]||(e[215]=t("span",{class:"text-sm text-center"},"评论系统",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[12]||(e[12]=s=>j("email"))},[a(d,{name:"i-heroicons-envelope",class:"w-5 h-5 text-indigo-300"}),e[216]||(e[216]=t("span",{class:"text-sm text-center"},"邮件设置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[13]||(e[13]=s=>j("admin-users"))},[a(d,{name:"i-heroicons-shield-check",class:"w-5 h-5 text-indigo-300"}),e[217]||(e[217]=t("span",{class:"text-sm text-center"},"管理员用户",-1))],2)])):A("",!0),Ue.value?(g(),f("button",{key:1,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[14]||(e[14]=s=>j("notify"))},[a(d,{name:"i-heroicons-bell-alert",class:"w-5 h-5 text-indigo-300"}),e[218]||(e[218]=t("span",{class:"text-sm text-center"},"推送配置",-1))],2)):A("",!0),Ue.value?(g(),f("button",{key:2,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[15]||(e[15]=s=>j("attachments"))},[a(d,{name:"i-heroicons-paper-clip",class:"w-5 h-5 text-indigo-300"}),e[219]||(e[219]=t("span",{class:"text-sm text-center"},"附件管理",-1))],2)):A("",!0),Ue.value?(g(),f("button",{key:3,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[16]||(e[16]=s=>j("db"))},[a(d,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[220]||(e[220]=t("span",{class:"text-sm text-center"},"数据库管理",-1))],2)):A("",!0)]),t("div",rn,[t("div",un,"当前版本: "+y(_.currentVersion||"最新"),1),t("div",cn,[a(i,{size:"xs",color:"indigo",variant:"soft",loading:_.checking,class:"shadow-md",onClick:cs},{default:c(()=>[m(y(_.checking?"检测中...":"检查版本发布时间"),1)]),_:1},8,["loading"])]),_.hasUpdate?(g(),f("div",mn,[a(d,{name:"i-heroicons-arrow-up-circle",class:"w-4 h-4"}),t("span",null,"最近更新于 "+y(_.latestVersion),1)])):A("",!0)])],2),t("main",{ref_key:"adminMain",ref:W,class:n(["w-full min-h-screen md:pl-72 overflow-y-auto",o.value.text])},[t("div",{class:n(["md:hidden flex items-center justify-between px-4 border-b rounded-b-2xl transition-all duration-200",[o.value.headerBg,o.value.border,o.value.text,le.value?"py-2":"py-3"]])},[t("div",pn,[t("button",{class:n(["rounded-lg shadow",[ue.value,le.value?"p-1.5":"p-2"]]),onClick:e[17]||(e[17]=s=>U.value=!U.value)},[a(d,{name:"i-heroicons-bars-3",class:"w-5 h-5"})],2),e[221]||(e[221]=t("span",{class:"font-semibold"},"系统管理面板",-1))]),t("div",vn,[a(i,{variant:"soft",color:u.value==="light"?"gray":"white",class:"shadow",onClick:e[18]||(e[18]=s=>l.$router.push("/"))},{default:c(()=>e[222]||(e[222]=[m("返回首页")])),_:1},8,["color"]),St.value?(g(),bl(i,{key:0,icon:"i-heroicons-power",color:"red",variant:"solid",onClick:kl},{default:c(()=>e[223]||(e[223]=[m("退出登录")])),_:1})):A("",!0)])],2),U.value?(g(),f("div",{key:0,class:"fixed inset-0 bg-black/40 md:hidden",onClick:e[19]||(e[19]=s=>U.value=!1)})):A("",!0),t("div",gn,[t("div",fn,[t("h1",{class:n(["text-2xl md:text-3xl font-bold text-center",o.value.text])},"系统管理面板",2)]),t("div",bn,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",wn,[t("div",yn,[t("span",{class:n(o.value.text)},"配色",2),t("div",xn,[t("div",hn,[a(h,{modelValue:u.value,"onUpdate:modelValue":e[20]||(e[20]=s=>u.value=s),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",kn,[a(h,{modelValue:u.value,"onUpdate:modelValue":e[21]||(e[21]=s=>u.value=s),value:"midnight",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="midnight"?o.value.text:"text-slate-400")},"深蓝",2)]),t("div",Cn,[a(h,{modelValue:u.value,"onUpdate:modelValue":e[22]||(e[22]=s=>u.value=s),value:"slate",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="slate"?o.value.text:"text-slate-400")},"石板",2)]),t("div",Vn,[a(h,{modelValue:u.value,"onUpdate:modelValue":e[23]||(e[23]=s=>u.value=s),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="light"?o.value.text:"text-slate-400")},"明亮",2)])])]),t("div",Un,[a(i,{size:"sm",color:"green",class:"shadow",onClick:be},{default:c(()=>e[224]||(e[224]=[m("保存")])),_:1})])])],2)]),A("",!0),A("",!0),t("div",En,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Tn,[t("div",null,[t("span",{class:n(o.value.text)},"系统管理员",2),t("span",Ln,y((Dl=(Il=Te(B))==null?void 0:Il.status)==null?void 0:Dl.username),1)]),t("div",null,[t("span",{class:n(o.value.text)},"当前用户",2),t("span",An,y(St.value&&((_l=Te(B).user)==null?void 0:_l.username)||"未登录"),1)]),t("div",null,[t("span",{class:n(o.value.text)},"笔记总数",2),t("span",Sn,y((Ml=(Hl=Te(B))==null?void 0:Hl.status)==null?void 0:Ml.total_messages)+" 条",1)])])],2)]),St.value?(g(),f("div",Bn,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",{class:n(["flex items-center justify-between px-4 py-3",o.value.text])},e[234]||(e[234]=[t("div",{class:"font-semibold"},"用户信息配置",-1)]),2),t("div",$n,[t("div",{class:n(["rounded-lg p-3 h-full",o.value.subtleBg])},[t("div",Rn,[t("span",{class:n(o.value.mutedText)},"用户名",2),a(i,{size:"sm",onClick:e[31]||(e[31]=s=>K.username=!K.username),color:K.username?"gray":"green",variant:K.username?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(K.username?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),K.username?(g(),f("div",jn,[a(k,{modelValue:T.username,"onUpdate:modelValue":e[32]||(e[32]=s=>T.username=s),placeholder:"新用户名",class:"w-full mb-2"},null,8,["modelValue"]),t("div",Pn,[a(i,{onClick:bs,color:"primary",class:"shadow"},{default:c(()=>e[235]||(e[235]=[m("保存")])),_:1})])])):(g(),f("div",In,[a(ee,{color:"primary",variant:"soft",class:"ml-0 text-xs px-2 py-1 rounded-md !text-slate-800 dark:!text-slate-200"},{default:c(()=>{var s;return[m(y((s=Te(B).user)==null?void 0:s.username),1)]}),_:1})])),t("div",Dn,[t("div",_n,[t("span",{class:n(o.value.mutedText)},"头像",2),t("div",Hn,[a(i,{size:"sm",onClick:Et(Us,["stop"]),color:"indigo",variant:"soft",class:"shadow"},{default:c(()=>e[236]||(e[236]=[m("上传头像")])),_:1}),a(i,{size:"sm",loading:Ae.value,onClick:Et(Bs,["stop"]),color:"orange",variant:"soft",class:"shadow"},{default:c(()=>e[237]||(e[237]=[m("使用首字母头像")])),_:1},8,["loading"])])]),t("div",Mn,[t("img",{src:O.value,class:"w-10 h-10 rounded-full object-cover",alt:"avatar"},null,8,zn)]),t("p",{class:n(["text-xs mt-1",o.value.mutedText])},"选择图片后自动进入裁剪，裁剪完成即可保存并预览",2),t("input",{ref_key:"avatarInput",ref:lt,type:"file",accept:"image/*",class:"hidden",onChange:Es},null,544),t("div",Nn,[a(k,{modelValue:xt.value,"onUpdate:modelValue":e[33]||(e[33]=s=>xt.value=s),placeholder:"头像链接（http或/api开头）",class:"flex-1"},null,8,["modelValue"]),a(i,{size:"sm",loading:Ae.value,onClick:Et(Ls,["stop"]),color:"primary",variant:"solid",class:"shadow"},{default:c(()=>e[238]||(e[238]=[m("保存链接")])),_:1},8,["loading"])]),a(ge,{modelValue:ht.value,"onUpdate:modelValue":e[35]||(e[35]=s=>ht.value=s)},{default:c(()=>[t("div",On,[t("div",{class:n([o.value.mutedText,"mb-2"])},"裁剪头像（拖动图片调整位置，滑块调整缩放）",2),t("div",Wn,[_e.value?(g(),f("img",{key:0,src:_e.value,alt:"to-crop",style:ha({position:"absolute",left:"50%",top:"50%",transform:`translate(-50%, -50%) translate(${Rt.value}px, ${jt.value}px) scale(${kt.value})`,userSelect:"none"}),onMousedown:Ul,onTouchstart:Ul},null,44,Fn)):A("",!0)]),t("div",qn,[t("span",{class:n(o.value.mutedText)},"缩放",2),Jt(t("input",{type:"range",min:"0.5",max:"3",step:"0.01","onUpdate:modelValue":e[34]||(e[34]=s=>kt.value=s)},null,512),[[ka,kt.value,void 0,{number:!0}]]),a(i,{loading:Ae.value,color:"green",onClick:As},{default:c(()=>e[239]||(e[239]=[m("裁剪并保存")])),_:1},8,["loading"]),a(i,{color:"indigo",variant:"soft",onClick:Ss},{default:c(()=>e[240]||(e[240]=[m("取消")])),_:1})])])]),_:1},8,["modelValue"]),t("div",Kn,[t("div",Gn,[t("span",{class:n(o.value.mutedText)},"个性签名",2),a(i,{size:"sm",onClick:e[36]||(e[36]=s=>K.description=!K.description),color:K.description?"gray":"green",variant:K.description?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(K.description?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),K.description?(g(),f("div",Jn,[a(Y,{modelValue:T.description,"onUpdate:modelValue":e[37]||(e[37]=s=>T.description=s),placeholder:"一句话介绍自己",class:"w-full mb-2"},null,8,["modelValue"]),t("div",Xn,[a(i,{onClick:ws,color:"primary",class:"shadow"},{default:c(()=>e[241]||(e[241]=[m("保存")])),_:1})])])):(g(),f("div",Yn,[t("div",{class:n([o.value.subtleBg,o.value.border,"rounded-md p-3 border"])},[t("p",{class:n([o.value.text,"break-words"])},y(((zl=Te(B).user)==null?void 0:zl.description)||"执迷不悟"),3)],2)]))])])],2),t("div",{class:n(["rounded-lg p-3 md:col-span-2",o.value.subtleBg])},[t("div",Zn,[t("div",Qn,[t("span",{class:n(o.value.mutedText)},"API Token",2),a(ee,{color:"primary",variant:"subtle",class:"text-xs px-2 py-1 rounded-md !text-primary-600 dark:!text-primary-300"},{default:c(()=>[m(y($.value?"已生成":"未生成"),1)]),_:1}),a(i,{size:"xs",loading:ol.value,onClick:ms,color:"indigo",variant:"soft",class:"shadow text-xs px-2 py-1 rounded-md text-slate-600 dark:text-slate-200",title:"重新生成将使旧 Token 失效"},{default:c(()=>e[242]||(e[242]=[m("重新生成")])),_:1},8,["loading"])])]),$.value?(g(),f("div",ei,[t("div",ti,[a(k,{modelValue:$.value,"onUpdate:modelValue":e[38]||(e[38]=s=>$.value=s),type:rt.value?"text":"password",readonly:"",class:"font-mono text-sm flex-1 min-w-0"},null,8,["modelValue","type"]),a(i,{icon:rt.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"indigo",variant:"ghost",onClick:e[39]||(e[39]=s=>rt.value=!rt.value),title:rt.value?"隐藏":"显示"},null,8,["icon","title"]),a(i,{icon:"i-heroicons-clipboard",color:"indigo",variant:"ghost",onClick:ps,title:"复制 Token"})]),t("p",{class:n(["text-xs mt-1",o.value.mutedText])},"请妥善保管此 Token",2)])):(g(),f("div",li,[t("p",{class:n(o.value.mutedText)},"暂无 Token",2)])),t("div",si,[t("span",{class:n(o.value.mutedText)},"邮箱",2),(Nl=Te(B).user)!=null&&Nl.email?(g(),f("span",{key:0,class:n([o.value.text,o.value.border,"inline-flex items-center px-2 py-0.5 rounded-md"])},y((Ol=Te(B).user)==null?void 0:Ol.email),3)):(g(),f("span",ai,"未绑定邮箱，请先绑定邮箱"))]),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",oi,[t("span",{class:n(o.value.mutedText)},"修改密码",2),a(i,{size:"sm",onClick:e[40]||(e[40]=s=>K.password=!K.password),color:K.password?"gray":"green",variant:K.password?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(K.password?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),K.password?(g(),f("div",ni,[t("div",ii,[a(k,{modelValue:T.oldPassword,"onUpdate:modelValue":e[41]||(e[41]=s=>T.oldPassword=s),type:It.value?"text":"password",placeholder:"当前密码",class:"flex-1"},null,8,["modelValue","type"]),a(i,{icon:It.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"indigo",variant:"ghost",onClick:e[42]||(e[42]=s=>It.value=!It.value)},null,8,["icon"])]),t("div",di,[a(k,{modelValue:T.newPassword,"onUpdate:modelValue":e[43]||(e[43]=s=>T.newPassword=s),type:Dt.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),a(ee,{color:gs.value,variant:"soft"},{default:c(()=>[m(y(vs.value),1)]),_:1},8,["color"]),a(i,{icon:Dt.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"indigo",variant:"ghost",onClick:e[44]||(e[44]=s=>Dt.value=!Dt.value)},null,8,["icon"])]),t("div",ri,[a(k,{modelValue:T.confirmPassword,"onUpdate:modelValue":e[45]||(e[45]=s=>T.confirmPassword=s),type:_t.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"]),a(i,{icon:_t.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"indigo",variant:"ghost",onClick:e[46]||(e[46]=s=>_t.value=!_t.value)},null,8,["icon"])]),t("div",ui,[a(i,{onClick:ys,disabled:!fs.value,color:"primary",class:"shadow"},{default:c(()=>e[243]||(e[243]=[m("保存")])),_:1},8,["disabled"])])])):A("",!0)],2),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",ci,[t("span",{class:n(o.value.mutedText)},"绑定邮箱",2),a(i,{size:"sm",onClick:e[47]||(e[47]=s=>K.emailBind=!K.emailBind),color:K.emailBind?"gray":"green",variant:K.emailBind?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(K.emailBind?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),K.emailBind?(g(),f("div",mi,[t("div",pi,[a(k,{modelValue:T.email,"onUpdate:modelValue":e[48]||(e[48]=s=>T.email=s),type:"email",placeholder:"输入邮箱",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"indigo",variant:"soft",onClick:xs},{default:c(()=>e[244]||(e[244]=[m("发送验证码")])),_:1})]),t("div",vi,[a(k,{modelValue:T.emailCode,"onUpdate:modelValue":e[49]||(e[49]=s=>T.emailCode=s),placeholder:"验证码",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"primary",class:"shadow",onClick:hs},{default:c(()=>e[245]||(e[245]=[m("绑定")])),_:1})])])):A("",!0)],2),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",gi,[t("span",{class:n(o.value.mutedText)},"更换邮箱",2),a(i,{size:"sm",onClick:e[50]||(e[50]=s=>K.emailChange=!K.emailChange),color:K.emailChange?"gray":"green",variant:K.emailChange?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(K.emailChange?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),K.emailChange?(g(),f("div",fi,[t("div",bi,[a(i,{color:"indigo",variant:"soft",onClick:ks},{default:c(()=>e[246]||(e[246]=[m("向当前邮箱发送验证码")])),_:1}),a(k,{modelValue:T.changeCode,"onUpdate:modelValue":e[51]||(e[51]=s=>T.changeCode=s),placeholder:"收到的验证码",class:"flex-1"},null,8,["modelValue"])]),t("div",wi,[a(k,{modelValue:T.newEmail,"onUpdate:modelValue":e[52]||(e[52]=s=>T.newEmail=s),type:"email",placeholder:"新的邮箱",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"primary",class:"shadow",onClick:Cs},{default:c(()=>e[247]||(e[247]=[m("更换")])),_:1})]),al.value?(g(),f("div",yi,[a(k,{modelValue:T.emailCode,"onUpdate:modelValue":e[53]||(e[53]=s=>T.emailCode=s),placeholder:"新邮箱验证码",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"primary",class:"shadow",onClick:Vs},{default:c(()=>e[248]||(e[248]=[m("确认更换")])),_:1})])):A("",!0)])):A("",!0)],2)],2)])],2)])):A("",!0),t("div",xi,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",hi,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5"}),e[249]||(e[249]=t("span",null,"网站配置",-1))],2)]),t("div",ki,[t("div",{class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",Ci,[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-hand-thumb-up",class:"w-4 h-4"}),e[250]||(e[250]=t("span",null,"系统欢迎组件",-1))],2),t("div",Vi,[a(i,{size:"sm",color:"indigo",variant:"soft",onClick:js},{default:c(()=>e[251]||(e[251]=[m("使用管理员头像信息")])),_:1}),a(i,{size:"sm",color:"indigo",variant:"soft",onClick:Ps},{default:c(()=>e[252]||(e[252]=[m("重置")])),_:1}),a(i,{size:"sm",color:"primary",class:"shadow",onClick:e[54]||(e[54]=s=>oe("welcome"))},{default:c(()=>e[253]||(e[253]=[m("保存")])),_:1})])]),t("div",Ui,[t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"显示名称",2),a(k,{modelValue:r.welcomeName,"onUpdate:modelValue":e[55]||(e[55]=s=>r.welcomeName=s),placeholder:"如 Noise 或站点名"},null,8,["modelValue"])]),t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"头像URL",2),a(k,{modelValue:r.welcomeAvatarURL,"onUpdate:modelValue":e[56]||(e[56]=s=>r.welcomeAvatarURL=s),placeholder:"http/https 或以 /api 开头的站内路径"},null,8,["modelValue"])]),t("div",Ei,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"简介文案",2),a(Y,{modelValue:r.welcomeDescription,"onUpdate:modelValue":e[57]||(e[57]=s=>r.welcomeDescription=s),placeholder:"一句话欢迎语或个人签名"},null,8,["modelValue"])])]),t("div",{class:n(["text-xs mt-2",o.value.mutedText])},"未登录时展示该组件；登录后显示当前用户的头像与签名",2)],2),t("div",{id:"site-register-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-user-plus",class:"w-4 h-4"}),e[254]||(e[254]=m()),e[255]||(e[255]=t("span",null,"新用户注册",-1))],2),t("div",Ti,[t("div",Li,[a(h,{modelValue:N.value,"onUpdate:modelValue":e[58]||(e[58]=s=>N.value=s),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(N.value?o.value.text:"text-slate-400")},"允许",2)]),t("div",Ai,[a(h,{modelValue:N.value,"onUpdate:modelValue":e[59]||(e[59]=s=>N.value=s),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(N.value?"text-slate-400":o.value.text)},"不允许",2)]),a(i,{color:"green",onClick:Ve,class:"shadow"},{default:c(()=>e[256]||(e[256]=[m("保存")])),_:1})])],2),t("div",{id:"site-pwa-section",class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",Si,[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-rocket-launch",class:"w-4 h-4"}),e[257]||(e[257]=m()),e[258]||(e[258]=t("span",null,"PWA 模式",-1))],2),t("div",Bi,[a(x,{modelValue:r.pwaEnabled,"onUpdate:modelValue":e[60]||(e[60]=s=>r.pwaEnabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:Rs,class:"shadow"},{default:c(()=>e[259]||(e[259]=[m("保存")])),_:1})])]),t("div",$i,[t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 标题",2),a(k,{modelValue:r.pwaTitle,"onUpdate:modelValue":e[61]||(e[61]=s=>r.pwaTitle=s),placeholder:r.siteTitle||"说说笔记"},null,8,["modelValue","placeholder"])]),t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 图标",2),a(k,{modelValue:r.pwaIconURL,"onUpdate:modelValue":e[62]||(e[62]=s=>r.pwaIconURL=s),placeholder:"/favicon.ico"},null,8,["modelValue"])]),t("div",Ri,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 描述",2),a(Y,{modelValue:r.pwaDescription,"onUpdate:modelValue":e[63]||(e[63]=s=>r.pwaDescription=s),placeholder:r.description||""},null,8,["modelValue","placeholder"])])])],2),t("div",{id:"site-github-card-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-mdi-github",class:"w-4 h-4"}),e[260]||(e[260]=m()),e[261]||(e[261]=t("span",null,"GitHub 链接卡片解析",-1))],2),t("div",ji,[t("div",Pi,[a(h,{modelValue:Je.value,"onUpdate:modelValue":e[64]||(e[64]=s=>Je.value=s),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(Je.value?o.value.text:"text-slate-400")},"开启",2)]),t("div",Ii,[a(h,{modelValue:Je.value,"onUpdate:modelValue":e[65]||(e[65]=s=>Je.value=s),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(Je.value?"text-slate-400":o.value.text)},"关闭",2)]),a(i,{color:"green",onClick:Ks,class:"shadow"},{default:c(()=>e[262]||(e[262]=[m("保存")])),_:1})])],2),t("div",{id:"site-announcement-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-megaphone",class:"w-4 h-4"}),e[263]||(e[263]=m()),e[264]||(e[264]=t("span",null,"公告栏开关",-1))],2),t("div",Di,[a(x,{modelValue:r.announcementEnabled,"onUpdate:modelValue":e[66]||(e[66]=s=>r.announcementEnabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:e[67]||(e[67]=s=>oe("announcementEnabled")),class:"shadow"},{default:c(()=>e[265]||(e[265]=[m("保存")])),_:1})])],2),t("div",{class:n(["rounded-lg p-3 mt-3",o.value.subtleBg])},[t("div",{class:n(["text-sm mb-2",o.value.mutedText])},"公告栏文本",2),a(Y,{modelValue:r.announcementText,"onUpdate:modelValue":e[68]||(e[68]=s=>r.announcementText=s),placeholder:"请输入公告内容",class:"w-full mb-2"},null,8,["modelValue"]),t("div",_i,[a(i,{color:"primary",class:"shadow",onClick:e[69]||(e[69]=s=>oe("announcementText"))},{default:c(()=>e[266]||(e[266]=[m("保存公告文本")])),_:1})])],2),t("div",Hi,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Mi,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-musical-note",class:"w-5 h-5"}),e[267]||(e[267]=t("span",null,"音乐配置",-1))],2),t("div",zi,[a(x,{modelValue:r.musicEnabled,"onUpdate:modelValue":e[70]||(e[70]=s=>r.musicEnabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:Sl,class:"shadow"},{default:c(()=>e[268]||(e[268]=[m("保存")])),_:1})])]),t("div",Ni,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",Oi,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌单 ID",2),a(k,{modelValue:r.musicPlaylistId,"onUpdate:modelValue":e[71]||(e[71]=s=>r.musicPlaylistId=s),disabled:(r.musicSongId||"").trim()!=="",placeholder:"如 14273792576"},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌曲 ID",2),a(k,{modelValue:r.musicSongId,"onUpdate:modelValue":e[72]||(e[72]=s=>r.musicSongId=s),disabled:(r.musicPlaylistId||"").trim()!=="",placeholder:"可选，优先歌单"},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"显示位置",2),a(re,{modelValue:r.musicPosition,"onUpdate:modelValue":e[73]||(e[73]=s=>r.musicPosition=s),disabled:ul.value==="embed",options:[{label:"左下角",value:"bottom-left"},{label:"右下角",value:"bottom-right"},{label:"左上角",value:"top-left"},{label:"右上角",value:"top-right"}]},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"主题",2),a(re,{modelValue:r.musicTheme,"onUpdate:modelValue":e[74]||(e[74]=s=>r.musicTheme=s),options:[{label:"自动",value:"auto"},{label:"深色",value:"dark"},{label:"浅色",value:"light"}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"CDN 源",2),a(re,{modelValue:ze.value,"onUpdate:modelValue":e[75]||(e[75]=s=>ze.value=s),options:[{label:"官方 CDN",value:"hypcvgm"},{label:"jsDelivr",value:"jsdelivr"},{label:"unpkg",value:"unpkg"},{label:"自定义",value:"custom"}]},null,8,["modelValue"])]),ze.value==="custom"?(g(),f("div",Wi,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"CSS CDN 地址",2),a(k,{modelValue:r.musicCssCdnURL,"onUpdate:modelValue":e[76]||(e[76]=s=>r.musicCssCdnURL=s),placeholder:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css"},null,8,["modelValue"])])):A("",!0),ze.value==="custom"?(g(),f("div",Fi,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"JS CDN 地址",2),a(k,{modelValue:r.musicJsCdnURL,"onUpdate:modelValue":e[77]||(e[77]=s=>r.musicJsCdnURL=s),placeholder:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js"},null,8,["modelValue"])])):A("",!0),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"显示歌词",2),a(re,{modelValue:r.musicLyric,"onUpdate:modelValue":e[78]||(e[78]=s=>r.musicLyric=s),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"自动播放",2),a(re,{modelValue:r.musicAutoplay,"onUpdate:modelValue":e[79]||(e[79]=s=>r.musicAutoplay=s),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"默认最小化",2),a(re,{modelValue:r.musicDefaultMinimized,"onUpdate:modelValue":e[80]||(e[80]=s=>r.musicDefaultMinimized=s),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",qi,[t("span",{class:n(["text-sm",o.value.mutedText])},"展示模式",2),a(re,{modelValue:ul.value,"onUpdate:modelValue":e[81]||(e[81]=s=>ul.value=s),options:[{label:"嵌入",value:"embed"},{label:"浮动",value:"float"}]},null,8,["modelValue"])])]),t("div",Ki,[a(i,{variant:"soft",color:"indigo",onClick:Gs},{default:c(()=>e[269]||(e[269]=[m("重置")])),_:1}),a(i,{color:"green",onClick:Sl},{default:c(()=>e[270]||(e[270]=[m("保存")])),_:1})]),t("div",{class:n(["text-xs mt-2",o.value.mutedText])},"保存后首页自动刷新显示播放器；歌单与单曲任选其一",2)],2)])],2)]),t("div",{id:"site-default-theme-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-swatch",class:"w-4 h-4"}),e[271]||(e[271]=m()),e[272]||(e[272]=t("span",null,"默认主题色",-1))],2),t("div",Gi,[t("div",Ji,[a(h,{modelValue:r.defaultContentTheme,"onUpdate:modelValue":e[82]||(e[82]=s=>r.defaultContentTheme=s),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(r.defaultContentTheme==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",Xi,[a(h,{modelValue:r.defaultContentTheme,"onUpdate:modelValue":e[83]||(e[83]=s=>r.defaultContentTheme=s),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(r.defaultContentTheme==="light"?o.value.text:"text-slate-400")},"白天",2)]),a(i,{color:"green",onClick:e[84]||(e[84]=s=>oe("defaultContentTheme")),class:"shadow"},{default:c(()=>e[273]||(e[273]=[m("保存")])),_:1})])],2),t("div",Yi,[(g(),f(de,null,me(nl,(s,R)=>t("div",{key:R,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",Zi,[t("span",{class:n(o.value.mutedText)},y(s),3),a(i,{size:"sm",onClick:H=>ve[R]=!ve[R],color:ve[R]?"gray":"green",variant:ve[R]?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(ve[R]?"取消":"编辑"),1)]),_:2},1032,["onClick","color","variant"])]),ve[R]?(g(),f("div",Qi,[R==="背景图片"||R==="backgrounds"?(g(),f("div",ed,[(g(!0),f(de,null,me(r.backgrounds,(H,he)=>(g(),f("div",{key:he,class:"flex items-center gap-3"},[t("img",{src:H||"/favicon.ico",class:n(["w-14 h-14 rounded object-cover border",o.value.border]),onClick:ot=>vl(H)},null,10,td),a(k,{modelValue:r.backgrounds[he],"onUpdate:modelValue":ot=>r.backgrounds[he]=ot,placeholder:"输入图片URL",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),t("div",ld,[a(i,{size:"xs",variant:"soft",icon:"i-heroicons-arrow-up",onClick:ot=>la(he)},{default:c(()=>e[274]||(e[274]=[m("上移")])),_:2},1032,["onClick"]),a(i,{size:"xs",variant:"soft",icon:"i-heroicons-arrow-down",onClick:ot=>sa(he)},{default:c(()=>e[275]||(e[275]=[m("下移")])),_:2},1032,["onClick"]),a(i,{size:"xs",variant:"soft",icon:"i-heroicons-eye",onClick:ot=>vl(H)},{default:c(()=>e[276]||(e[276]=[m("预览")])),_:2},1032,["onClick"]),a(i,{size:"xs",color:"red",variant:"soft",icon:"i-heroicons-trash",onClick:ot=>ea(he)},{default:c(()=>e[277]||(e[277]=[m("删除")])),_:2},1032,["onClick"])])]))),128)),t("div",{class:n(["rounded border-2 border-dashed p-4 text-center",o.value.border]),onDragover:e[85]||(e[85]=Et(()=>{},["prevent"])),onDrop:Et(aa,["prevent"])},[t("div",sd,[a(i,{onClick:Qs,icon:"i-heroicons-plus",variant:"ghost"},{default:c(()=>e[278]||(e[278]=[m("添加链接")])),_:1}),a(i,{onClick:ta,icon:"i-heroicons-cloud-arrow-up",variant:"ghost"},{default:c(()=>e[279]||(e[279]=[m("上传图片")])),_:1})]),cl.value?(g(),f("div",ad,[t("div",{class:n(["text-xs",o.value.mutedText])},y(ml.value),3),a(Ye,{value:Wt.value,class:"mt-1"},null,8,["value"])])):A("",!0)],34)])):R==="avatarURL"?(g(),f("div",od,[t("div",nd,[t("img",{src:r.avatarURL,class:"w-12 h-12 rounded-full object-cover",alt:"site-avatar"},null,8,id),a(i,{size:"sm",color:"indigo",variant:"soft",onClick:e[86]||(e[86]=H=>{var he;return(he=$t.value)==null?void 0:he.click()})},{default:c(()=>e[280]||(e[280]=[m("上传图片")])),_:1}),t("input",{ref_for:!0,ref_key:"siteAvatarInput",ref:$t,type:"file",accept:"image/*",class:"hidden",onChange:Is},null,544)]),a(k,{modelValue:r.avatarURL,"onUpdate:modelValue":e[87]||(e[87]=H=>r.avatarURL=H),placeholder:"输入图片URL",class:"w-full"},null,8,["modelValue"])])):R==="subtitleText"||R==="linksDescription"||R==="commentPageDescription"||R==="aboutPageDescription"||R==="aboutMarkdown"?(g(),bl(Y,{key:2,modelValue:r[R],"onUpdate:modelValue":H=>r[R]=H,placeholder:`输入${s}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(g(),bl(k,{key:3,modelValue:r[R],"onUpdate:modelValue":H=>r[R]=H,placeholder:`输入${s}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),t("div",dd,[a(i,{onClick:H=>$s(R),variant:"ghost",color:"indigo"},{default:c(()=>e[281]||(e[281]=[m("重置")])),_:2},1032,["onClick"]),a(i,{onClick:H=>oe(R),color:"primary",class:"shadow"},{default:c(()=>e[282]||(e[282]=[m("保存")])),_:2},1032,["onClick"])])])):(g(),f("div",rd,[R==="backgrounds"?(g(),f("div",ud,[(g(!0),f(de,null,me(r.backgrounds,(H,he)=>(g(),f("img",{key:he,src:H,class:n(["w-full h-24 object-cover rounded cursor-pointer border",o.value.border]),onClick:ot=>vl(H)},null,10,cd))),128))])):R==="avatarURL"?(g(),f("div",md,[t("img",{src:r.avatarURL,class:"w-12 h-12 rounded-full object-cover",alt:"site-avatar"},null,8,pd),t("span",{class:n(o.value.mutedText)},"站点头像预览",2)])):(g(),f("div",{key:2,class:n([o.value.subtleBg,o.value.border,"rounded-md p-3 border"])},[t("p",{class:n([o.value.text,"break-words"])},y(r[R]),3)],2))]))],2)),64))]),Cl.value?(g(),f("div",vd,[a(i,{onClick:Zs,variant:"ghost",color:"indigo"},{default:c(()=>e[283]||(e[283]=[m("重置")])),_:1}),a(i,{onClick:l.saveConfig,color:"primary",class:"shadow"},{default:c(()=>e[284]||(e[284]=[m("保存所有更改")])),_:1},8,["onClick"])])):A("",!0),t("div",gd,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",fd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-megaphone",class:"w-5 h-5"}),e[285]||(e[285]=t("span",null,"左侧广告模块",-1))],2),t("div",bd,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.leftAdEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.leftAdEnabled?"已启用":"未启用"),3),a(x,{modelValue:r.leftAdEnabled,"onUpdate:modelValue":e[88]||(e[88]=s=>r.leftAdEnabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:e[89]||(e[89]=s=>oe("leftAdEnabled")),class:"shadow"},{default:c(()=>e[286]||(e[286]=[m("保存")])),_:1})])]),t("div",wd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",yd,[t("div",{class:n(["text-sm font-semibold mb-2",o.value.text])},"多广告（自动轮播）",2),t("div",{class:n(["text-xs mb-2",o.value.mutedText])},"若同时配置单条与多条，优先显示多条",2),t("div",xd,[(g(!0),f(de,null,me(r.leftAds,(s,R)=>(g(),f("div",{key:R,class:n(["rounded-md border p-3",o.value.border])},[t("div",hd,[t("div",{class:n(["text-sm",o.value.text])},"广告 #"+y(R+1),3),t("div",kd,[a(i,{size:"xs",color:"red",variant:"soft",onClick:H=>r.leftAds.splice(R,1)},{default:c(()=>e[287]||(e[287]=[m("删除")])),_:2},1032,["onClick"])])]),t("div",Cd,[a(k,{modelValue:s.imageURL,"onUpdate:modelValue":H=>s.imageURL=H,placeholder:"海报图片 URL"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:s.linkURL,"onUpdate:modelValue":H=>s.linkURL=H,placeholder:"跳转链接"},null,8,["modelValue","onUpdate:modelValue"]),a(Y,{modelValue:s.description,"onUpdate:modelValue":H=>s.description=H,placeholder:"描述文本（可选）",class:"md:col-span-2"},null,8,["modelValue","onUpdate:modelValue"])])],2))),128)),t("div",Vd,[t("div",Ud,[a(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:e[90]||(e[90]=s=>r.leftAds.push({imageURL:"",linkURL:"",description:""}))},{default:c(()=>e[288]||(e[288]=[m("新增广告")])),_:1}),a(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:Js},{default:c(()=>e[289]||(e[289]=[m("重置为默认")])),_:1})]),t("div",Ed,[t("span",{class:n(["text-sm",o.value.mutedText])},"轮播间隔(ms)",2),a(k,{modelValue:r.leftAdsIntervalMs,"onUpdate:modelValue":e[91]||(e[91]=s=>r.leftAdsIntervalMs=s),modelModifiers:{number:!0},type:"number",class:"w-28"},null,8,["modelValue"])])])])]),t("div",Td,[a(i,{color:"primary",class:"shadow",onClick:e[92]||(e[92]=s=>oe("leftAds"))},{default:c(()=>e[290]||(e[290]=[m("保存广告配置")])),_:1})])],2)])],2)]),t("div",Ld,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Ad,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-sparkles",class:"w-5 h-5"}),e[291]||(e[291]=t("span",null,"随机一言（Hitokoto）",-1))],2),t("div",Sd,[a(x,{modelValue:r.hitokotoEnabled,"onUpdate:modelValue":e[93]||(e[93]=s=>r.hitokotoEnabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:e[94]||(e[94]=s=>oe("hitokotoEnabled")),class:"shadow"},{default:c(()=>e[292]||(e[292]=[m("保存")])),_:1})])]),t("div",Bd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",{class:n(["text-sm",o.value.mutedText])},"开启后，首页左栏广告位下方显示随机一言",2)],2)])],2)]),t("div",$d,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Rd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-link",class:"w-5 h-5"}),e[293]||(e[293]=t("span",null,"社交链接配置",-1))],2),t("div",jd,[a(i,{size:"sm",onClick:e[95]||(e[95]=s=>ve.socialLinks=!ve.socialLinks),color:ve.socialLinks?"gray":"green",variant:ve.socialLinks?"soft":"solid",class:"shadow"},{default:c(()=>[m(y(ve.socialLinks?"取消":"编辑"),1)]),_:1},8,["color","variant"]),a(i,{color:"green",class:"shadow",onClick:Hs},{default:c(()=>e[294]||(e[294]=[m("保存")])),_:1})])]),t("div",Pd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[ve.socialLinks?(g(),f("div",Id,[(g(!0),f(de,null,me(r.socialLinks,(s,R)=>(g(),f("div",{key:R,class:n(["rounded-md border p-3",o.value.border])},[t("div",Dd,[a(k,{modelValue:s.name,"onUpdate:modelValue":H=>s.name=H,placeholder:"名称"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:s.url,"onUpdate:modelValue":H=>s.url=H,placeholder:"链接 URL"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:s.icon,"onUpdate:modelValue":H=>s.icon=H,placeholder:"图标名称(可选)"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",_d,[a(i,{size:"xs",color:"red",variant:"soft",onClick:H=>_s(R)},{default:c(()=>e[295]||(e[295]=[m("删除")])),_:2},1032,["onClick"])])],2))),128)),t("div",Hd,[a(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:Ds},{default:c(()=>e[296]||(e[296]=[m("新增链接")])),_:1})])])):(g(),f("div",{key:1,class:n(["text-sm",o.value.mutedText])},"共有 "+y((r.socialLinks||[]).length)+" 条社交链接",3))],2)])],2)]),t("div",Md,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",zd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-link",class:"w-5 h-5"}),e[297]||(e[297]=t("span",null,"友链配置",-1))],2),t("div",Nd,[a(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:e[96]||(e[96]=s=>r.friendLinks.push({title:"",link:"",icon:"",description:""}))},{default:c(()=>e[298]||(e[298]=[m("新增友链")])),_:1}),a(i,{color:"primary",class:"shadow",onClick:e[97]||(e[97]=s=>oe("friendLinks"))},{default:c(()=>e[299]||(e[299]=[m("保存")])),_:1})])]),t("div",Od,[t("div",{class:n(["rounded-lg p-4 mb-3",o.value.subtleBg])},[t("div",Wd,[a(k,{modelValue:r.linksApplyTitle,"onUpdate:modelValue":e[98]||(e[98]=s=>r.linksApplyTitle=s),placeholder:"友链申请标题，如 申请友链须知"},null,8,["modelValue"]),a(Y,{modelValue:r.linksApplyText,"onUpdate:modelValue":e[99]||(e[99]=s=>r.linksApplyText=s),placeholder:"填写申请说明与格式",class:"md:col-span-2"},null,8,["modelValue"]),t("div",Fd,[t("span",{class:n(["text-sm",o.value.mutedText])},"审核结果邮件通知",2),a(x,{modelValue:r.friendLinkEmailEnabled,"onUpdate:modelValue":e[100]||(e[100]=s=>r.friendLinkEmailEnabled=s)},null,8,["modelValue"]),a(i,{size:"xs",color:"green",variant:"soft",onClick:e[101]||(e[101]=s=>oe("friendLinkEmailEnabled"))},{default:c(()=>e[300]||(e[300]=[m("保存开关")])),_:1})])]),t("div",qd,[a(i,{color:"primary",variant:"soft",onClick:e[102]||(e[102]=s=>{oe("linksApplyTitle"),oe("linksApplyText")})},{default:c(()=>e[301]||(e[301]=[m("保存说明")])),_:1})])],2),t("div",{class:n(["rounded-lg p-4 space-y-3",o.value.subtleBg])},[(g(!0),f(de,null,me(r.friendLinks,(s,R)=>(g(),f("div",{key:R,class:n(["rounded-md border p-3 space-y-2",o.value.border])},[t("div",Kd,[t("div",{class:n(["text-sm",o.value.text])},"友链 #"+y(R+1),3),a(i,{size:"xs",color:"red",variant:"soft",onClick:H=>r.friendLinks.splice(R,1)},{default:c(()=>e[302]||(e[302]=[m("删除")])),_:2},1032,["onClick"])]),t("div",Gd,[a(k,{modelValue:s.title,"onUpdate:modelValue":H=>s.title=H,placeholder:"网站标题"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:s.link,"onUpdate:modelValue":H=>s.link=H,placeholder:"链接 (http/https)"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:s.icon,"onUpdate:modelValue":H=>s.icon=H,placeholder:"图标名称 (如 i-mdi-github，可选)"},null,8,["modelValue","onUpdate:modelValue"]),a(Y,{modelValue:s.description,"onUpdate:modelValue":H=>s.description=H,placeholder:"网站介绍 (可选)",class:"md:col-span-2"},null,8,["modelValue","onUpdate:modelValue"])])],2))),128))],2)])],2)])])],2)]),Ue.value?(g(),f("div",Jd,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Xd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-check-badge",class:"w-5 h-5"}),e[303]||(e[303]=t("span",null,"友链申请审核",-1))],2),t("div",Yd,[a(k,{modelValue:M.value,"onUpdate:modelValue":e[103]||(e[103]=s=>M.value=s),placeholder:"搜索标题或网址",class:"w-64"},null,8,["modelValue"]),a(i,{color:"primary",variant:"soft",onClick:G},{default:c(()=>e[304]||(e[304]=[m("刷新")])),_:1})])]),t("div",Zd,[p.value.length===0?(g(),f("div",{key:0,class:n(["text-sm",o.value.mutedText])},"暂无申请",2)):(g(),f("div",Qd,[(g(!0),f(de,null,me(p.value,s=>(g(),f("div",{key:s.id,class:n(["rounded border px-3 py-2",o.value.border])},[t("div",er,[t("div",{class:n(["text-sm truncate",o.value.text])},[m("#"+y(s.id)+" · "+y(s.title||s.link)+" · "+y(Ll(s.created_at))+" · ",1),t("span",{class:n(["px-2 py-0.5 rounded text-xs",z(s.status)])},y(s.status),3)],2),t("div",tr,[a(i,{size:"xs",color:"green",variant:"soft",onClick:R=>ae(s)},{default:c(()=>e[305]||(e[305]=[m("通过")])),_:2},1032,["onClick"]),a(i,{size:"xs",color:"red",variant:"soft",onClick:R=>ce(s)},{default:c(()=>e[306]||(e[306]=[m("拒绝")])),_:2},1032,["onClick"])])]),t("div",{class:n(["text-xs mt-1",o.value.mutedText])},y(s.description||"-"),3),t("div",{class:n(["text-xs mt-1",o.value.mutedText])},"邮箱："+y(s.email||"-"),3),s.feedback?(g(),f("div",{key:0,class:n(["text-xs mt-1",o.value.mutedText])},"反馈："+y(s.feedback),3)):A("",!0)],2))),128))]))])],2)])):A("",!0),t("div",lr,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",sr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5"}),e[307]||(e[307]=t("span",{class:"whitespace-nowrap"},"评论系统",-1))],2),t("div",ar,[t("div",or,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.commentEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.commentEnabled?"已启用":"未启用"),3),a(x,{modelValue:r.commentEnabled,"onUpdate:modelValue":e[104]||(e[104]=s=>r.commentEnabled=s),class:"shrink-0"},null,8,["modelValue"])]),t("div",nr,[t("span",{class:n(["text-sm",o.value.mutedText])},"邮件通知",2),a(x,{modelValue:r.commentEmailEnabled,"onUpdate:modelValue":e[105]||(e[105]=s=>r.commentEmailEnabled=s),disabled:!r.commentEnabled,class:"shrink-0"},null,8,["modelValue","disabled"])]),t("div",ir,[t("span",{class:n(["text-sm",o.value.mutedText])},"仅登录后评论",2),a(x,{modelValue:r.commentLoginRequired,"onUpdate:modelValue":e[106]||(e[106]=s=>r.commentLoginRequired=s),disabled:!r.commentEnabled,class:"shrink-0"},null,8,["modelValue","disabled"])]),a(i,{color:"green",onClick:El,class:"shadow w-full sm:w-auto"},{default:c(()=>e[308]||(e[308]=[m("保存")])),_:1})])]),t("div",dr,[a(Lo,{config:r,"onUpdate:config":e[107]||(e[107]=s=>r=s),theme:o.value,onCommentSystemChanged:e[108]||(e[108]=s=>il.value=s)},null,8,["config","theme"]),Ue.value&&r.commentEnabled&&String(il.value||r.commentSystem).toLowerCase()==="builtin"?(g(),f("div",{key:0,class:n(["mt-4 rounded-lg p-3",o.value.subtleBg])},[t("div",rr,[a(k,{modelValue:zt.value,"onUpdate:modelValue":e[109]||(e[109]=s=>zt.value=s),placeholder:"搜索评论内容/昵称/邮箱/网址",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"primary",variant:"soft",onClick:Al},{default:c(()=>e[309]||(e[309]=[m("搜索")])),_:1}),a(i,{variant:"soft",color:Me.value?"gray":"indigo",onClick:Ms},{default:c(()=>[m(y(Me.value?"折叠":"展开"),1)]),_:1},8,["color"])]),Me.value?(g(),f("div",ur,[(g(!0),f(de,null,me(ct.value,s=>(g(),f("div",{key:s.id,class:n(["rounded border px-3 py-2",o.value.border])},[t("div",cr,[t("div",{class:n(["text-sm truncate",o.value.text])},"#"+y(s.id)+" · "+y(s.nick||"匿名")+" · "+y(Ll(s.created_at)),3),a(i,{size:"xs",variant:"ghost",color:dl(s)?"gray":"primary",onClick:R=>zs(s)},{default:c(()=>[m(y(dl(s)?"收起":"展开"),1)]),_:2},1032,["color","onClick"])]),t("div",{class:n(["mt-1 text-sm truncate",o.value.text])},y(s.content),3),dl(s)?(g(),f("div",mr,[t("div",null,[t("span",{class:n(o.value.mutedText)},"消息ID",2),e[310]||(e[310]=m("：")),t("span",{class:n(o.value.text)},y(s.message_id),3)]),t("div",null,[t("span",{class:n(o.value.mutedText)},"父评论ID",2),e[311]||(e[311]=m("：")),t("span",{class:n(o.value.text)},y(s.parent_id||0),3)]),t("div",null,[t("span",{class:n(o.value.mutedText)},"邮箱",2),e[312]||(e[312]=m("：")),t("span",{class:n(o.value.text)},y(s.mail||"-"),3)]),t("div",pr,[t("span",{class:n(o.value.mutedText)},"网址",2),e[313]||(e[313]=m("：")),s.link?(g(),f("a",{key:0,href:s.link,target:"_blank",rel:"noopener",class:"underline"},y(s.link),9,vr)):(g(),f("span",{key:1,class:n(o.value.text)},"-",2))]),t("div",gr,[a(i,{color:"red",variant:"soft",onClick:R=>Fs(s)},{default:c(()=>e[314]||(e[314]=[m("删除该评论")])),_:2},1032,["onClick"])])])):A("",!0)],2))),128)),Nt.value?(g(),f("div",fr,[a(i,{variant:"soft",onClick:Ns},{default:c(()=>e[315]||(e[315]=[m("加载更多")])),_:1})])):A("",!0)])):A("",!0)],2)):A("",!0)])],2),a(ge,{modelValue:Ot.value,"onUpdate:modelValue":e[111]||(e[111]=s=>Ot.value=s),ui:{width:"sm:max-w-md"}},{default:c(()=>[a(Ee,null,{header:c(()=>[t("div",br,[e[316]||(e[316]=t("h3",{class:"text-lg font-medium"},"再次确认删除",-1)),a(i,{color:"indigo",variant:"ghost",icon:"i-mdi-close",class:"-my-1",onClick:rl})])]),footer:c(()=>[t("div",Vr,[a(i,{color:"indigo",variant:"outline",onClick:rl},{default:c(()=>e[319]||(e[319]=[m("取消")])),_:1}),a(i,{color:"red",disabled:!pt.value,onClick:qs},{default:c(()=>e[320]||(e[320]=[m("确认删除")])),_:1},8,["disabled"])])]),default:c(()=>{var s,R,H;return[t("div",wr,[e[318]||(e[318]=t("div",{class:"text-sm"},"此操作不可恢复，确认删除该评论？",-1)),t("div",yr,"评论ID："+y((s=Xe.value)==null?void 0:s.id),1),t("div",xr,"消息ID："+y((R=Xe.value)==null?void 0:R.message_id),1),t("div",hr,"昵称："+y(((H=Xe.value)==null?void 0:H.nick)||"匿名"),1),t("div",kr,"内容片段："+y(Ws.value),1),t("label",Cr,[Jt(t("input",{type:"checkbox","onUpdate:modelValue":e[110]||(e[110]=he=>pt.value=he)},null,512),[[Ca,pt.value]]),e[317]||(e[317]=m(" 我已知晓此操作不可恢复 "))])])]}),_:1})]),_:1},8,["modelValue"])]),t("div",{class:n(["mx-4 my-2 border-t",o.value.border])},null,2),Ue.value?(g(),f("div",Ur,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Er,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-envelope",class:"w-5 h-5"}),e[321]||(e[321]=t("span",null,"邮件设置（SMTP）",-1))],2),t("div",Tr,[a(x,{modelValue:w.enabled,"onUpdate:modelValue":e[112]||(e[112]=s=>w.enabled=s)},null,8,["modelValue"]),a(i,{color:"green",onClick:bt,class:"shadow"},{default:c(()=>e[322]||(e[322]=[m("保存")])),_:1})])]),t("div",Lr,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"地址",2),a(k,{modelValue:w.from,"onUpdate:modelValue":e[113]||(e[113]=s=>w.from=s),placeholder:"发件地址，如 name@example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"驱动",2),a(re,{modelValue:w.driver,"onUpdate:modelValue":e[114]||(e[114]=s=>w.driver=s),options:["smtp"]},null,8,["modelValue"])]),t("div",{class:n(["text-sm font-semibold mt-1 mb-2",o.value.text])},"SMTP 设置",2),t("div",Ar,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"主机",2),a(k,{modelValue:w.host,"onUpdate:modelValue":e[115]||(e[115]=s=>w.host=s),placeholder:"smtp.example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"端口",2),a(k,{modelValue:w.port,"onUpdate:modelValue":e[116]||(e[116]=s=>w.port=s),placeholder:"465 或 587"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"加密协议（小写 ssl 或 tls）",2),a(re,{modelValue:w.encryption,"onUpdate:modelValue":e[117]||(e[117]=s=>w.encryption=s),options:["ssl","tls"]},null,8,["modelValue"])]),e[323]||(e[323]=t("div",{class:"md:col-span-1"},null,-1)),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"用户名",2),a(k,{modelValue:w.user,"onUpdate:modelValue":e[118]||(e[118]=s=>w.user=s),placeholder:"通常与发件地址一致"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"密码",2),a(k,{modelValue:w.pass,"onUpdate:modelValue":e[119]||(e[119]=s=>w.pass=s),type:ye.value?"text":"password",placeholder:"邮箱或应用专用密码"},null,8,["modelValue","type"])])]),t("div",{class:n(["flex items-center justify-between mt-2",o.value.mutedText])},[t("span",Sr,"使用上述设置发送测试邮件到："+y(w.from||w.user||"请先填写地址"),1),a(i,{disabled:!(w.from||w.user),loading:ll.value,color:"primary",onClick:rs},{default:c(()=>e[324]||(e[324]=[m("发送测试邮件")])),_:1},8,["disabled","loading"])],2),t("div",Br,[a(i,{variant:"soft",color:"indigo",onClick:se},{default:c(()=>e[325]||(e[325]=[m("刷新")])),_:1}),a(i,{color:"green",onClick:bt},{default:c(()=>e[326]||(e[326]=[m("保存")])),_:1})])],2)])],2)])):A("",!0),Ue.value?(g(),f("div",$r,[t("div",{class:n([o.value.cardBg,o.value.border,je])},[t("div",Rr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-shield-check",class:"w-5 h-5"}),e[327]||(e[327]=t("span",null,"用户管理",-1))],2)]),t("div",jr,[t("div",{class:n(["rounded-lg p-3 mb-3",o.value.subtleBg])},[t("div",Pr,[a(k,{modelValue:Ie.value,"onUpdate:modelValue":e[120]||(e[120]=s=>Ie.value=s),placeholder:"搜索用户名或ID",class:"flex-1"},null,8,["modelValue"]),a(i,{color:"primary",variant:"soft",onClick:Ke},{default:c(()=>e[328]||(e[328]=[m("搜索")])),_:1}),a(i,{variant:"soft",color:"indigo",onClick:Ke},{default:c(()=>e[329]||(e[329]=[m("刷新")])),_:1}),a(i,{variant:"soft",color:Le.value?"gray":"indigo",onClick:e[121]||(e[121]=s=>Le.value=!Le.value)},{default:c(()=>[m(y(Le.value?"折叠":"展开"),1)]),_:1},8,["color"])])],2),Le.value?(g(),f("div",{key:0,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",Ir,[(g(!0),f(de,null,me(tt.value,s=>(g(),f("div",{key:s.id??s.ID,class:n(["rounded border px-3 py-2",o.value.border])},[t("div",Dr,[a(ee,{color:"indigo",variant:"soft"},{default:c(()=>[m("#"+y(s.id??s.ID),1)]),_:2},1024),t("span",{class:n(["truncate",o.value.text])},y(s.username??s.Username),3),a(ee,{color:s.is_admin??s.IsAdmin?"primary":"gray",variant:"subtle"},{default:c(()=>[m(y(s.is_admin??s.IsAdmin?"管理员":"普通"),1)]),_:2},1032,["color"]),e[330]||(e[330]=t("div",{class:"flex-1"},null,-1)),a(i,{size:"xs",variant:"ghost",color:tl(s)?"gray":"primary",onClick:R=>as(s)},{default:c(()=>[m(y(tl(s)?"收起":"展开"),1)]),_:2},1032,["color","onClick"])]),t("div",_r,[a(i,{color:s.is_admin??s.IsAdmin?"orange":"green",variant:s.is_admin??s.IsAdmin?"soft":"solid",class:"shadow",onClick:R=>is(s)},{default:c(()=>[m(y(s.is_admin??s.IsAdmin?"取消管理员":"设为管理员"),1)]),_:2},1032,["color","variant","onClick"]),a(i,{color:"red",variant:"soft",class:"shadow",onClick:R=>ds(s)},{default:c(()=>e[331]||(e[331]=[m("删除")])),_:2},1032,["onClick"])]),tl(s)?(g(),f("div",{key:0,class:n(["mt-3 rounded p-3",o.value.subtleBg])},[t("div",Hr,[t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"用户ID",2),t("div",{class:n(o.value.text)},y(s.id??s.ID),3)]),t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"用户名",2),t("div",{class:n(o.value.text)},y(s.username??s.Username),3)]),t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"角色",2),t("div",{class:n(o.value.text)},y(s.is_admin??s.IsAdmin?"管理员":"普通用户"),3)])]),t("div",Mr,[t("div",{class:n(["text-sm mb-1",o.value.text])},"重置密码",2),t("div",zr,[a(k,{modelValue:wt.password[s.id??s.ID],"onUpdate:modelValue":R=>wt.password[s.id??s.ID]=R,type:At.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","type"]),a(i,{icon:At.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"indigo",variant:"ghost",onClick:e[122]||(e[122]=R=>At.value=!At.value)},null,8,["icon"]),a(i,{disabled:!os(s),color:"primary",onClick:R=>ns(s)},{default:c(()=>e[332]||(e[332]=[m("保存")])),_:2},1032,["disabled","onClick"])])])],2)):A("",!0)],2))),128))])],2)):A("",!0)])],2)])):A("",!0),a(ge,{modelValue:Qe.value,"onUpdate:modelValue":e[126]||(e[126]=s=>Qe.value=s)},{default:c(()=>[a(Ee,null,{default:c(()=>[e[335]||(e[335]=t("div",{class:"font-semibold mb-2"},"重置管理员密码",-1)),t("div",Nr,[t("div",Or,[a(k,{modelValue:pe.newPass,"onUpdate:modelValue":e[123]||(e[123]=s=>pe.newPass=s),type:dt.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),a(ee,{color:We.value,variant:"soft"},{default:c(()=>[m(y(Be.value),1)]),_:1},8,["color"])]),t("div",Wr,[a(k,{modelValue:pe.confirmPass,"onUpdate:modelValue":e[124]||(e[124]=s=>pe.confirmPass=s),type:dt.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"])]),t("div",Fr,[a(i,{variant:"ghost",color:"indigo",onClick:e[125]||(e[125]=s=>Qe.value=!1)},{default:c(()=>e[333]||(e[333]=[m("取消")])),_:1}),a(i,{disabled:!Fe.value,color:"primary",onClick:et},{default:c(()=>e[334]||(e[334]=[m("保存")])),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["modelValue"]),Ue.value?(g(),f("div",qr,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Kr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-bell-alert",class:"w-5 h-5"}),e[336]||(e[336]=t("span",null,"推送配置",-1))],2),t("div",Gr,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.notifyEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.notifyEnabled?"已启用":"未启用"),3),a(xe,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[127]||(e[127]=s=>r.notifyEnabled=s),color:"primary",size:"lg"},null,8,["modelValue"]),t("div",Jr,[a(h,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[128]||(e[128]=s=>r.notifyEnabled=s),value:!0},null,8,["modelValue"]),t("span",{class:n(r.notifyEnabled?o.value.text:"text-gray-400")},"开启",2),a(h,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[129]||(e[129]=s=>r.notifyEnabled=s),value:!1},null,8,["modelValue"]),t("span",{class:n(r.notifyEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",Xr,[a(ko,{config:Te(D),"onUpdate:config":e[130]||(e[130]=s=>Va(D)?D.value=s:D=s),immediate:!0,subtleBg:o.value.subtleBg,text:o.value.text,mutedText:o.value.mutedText,disabled:!r.notifyEnabled},null,8,["config","subtleBg","text","mutedText","disabled"])])],2)])):A("",!0),Ue.value?(g(),f("div",Yr,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Zr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-mdi-github",class:"w-5 h-5"}),e[337]||(e[337]=t("span",null,"GitHub 登录",-1))],2),t("div",Qr,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.githubOAuthEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.githubOAuthEnabled?"已启用":"未启用"),3),a(xe,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[131]||(e[131]=s=>r.githubOAuthEnabled=s),color:"primary",size:"lg"},null,8,["modelValue"]),a(x,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[132]||(e[132]=s=>r.githubOAuthEnabled=s)},null,8,["modelValue"]),t("div",eu,[a(h,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[133]||(e[133]=s=>r.githubOAuthEnabled=s),value:!0},null,8,["modelValue"]),t("span",{class:n(r.githubOAuthEnabled?o.value.text:"text-gray-400")},"开启",2),a(h,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[134]||(e[134]=s=>r.githubOAuthEnabled=s),value:!1},null,8,["modelValue"]),t("span",{class:n(r.githubOAuthEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",tu,[t("div",lu,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client ID",2),a(k,{modelValue:r.githubClientId,"onUpdate:modelValue":e[135]||(e[135]=s=>r.githubClientId=s),placeholder:"GitHub OAuth App Client ID",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client Secret",2),a(k,{modelValue:r.githubClientSecret,"onUpdate:modelValue":e[136]||(e[136]=s=>r.githubClientSecret=s),type:"password",placeholder:"GitHub OAuth App Client Secret",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",su,[t("div",{class:n(["text-sm mb-2",o.value.text])},"回调地址",2),a(k,{modelValue:r.githubCallbackURL,"onUpdate:modelValue":e[137]||(e[137]=s=>r.githubCallbackURL=s),placeholder:"例如 https://your.domain.com/oauth/github/callback",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])])]),t("div",au,[a(i,{variant:"soft",color:"indigo",onClick:He},{default:c(()=>e[338]||(e[338]=[m("刷新")])),_:1}),a(i,{color:"green",onClick:Xs},{default:c(()=>e[339]||(e[339]=[m("保存")])),_:1}),a(i,{color:"primary",onClick:us},{default:c(()=>e[340]||(e[340]=[m("测试")])),_:1})]),t("div",{class:n(["text-xs",o.value.mutedText])},"默认不开启，开启后登录页显示“GitHub 一键登录”按钮",2)])],2)])):A("",!0),Ue.value?(g(),f("div",ou,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[a(en,{theme:o.value},null,8,["theme"])],2)])):A("",!0),Ue.value?(g(),f("div",nu,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",iu,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[a(d,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[341]||(e[341]=t("span",null,"本地数据库管理配置",-1)),t("span",{class:n(["ml-2 text-xs px-2 py-1 rounded",o.value.subtleBg])},"当前 DB："+y(oa.value),3)],2),t("div",du,[a(i,{color:"primary",icon:"i-heroicons-arrow-down-tray",disabled:vt.value!=="sqlite",onClick:na},{default:c(()=>e[342]||(e[342]=[m("下载本地备份")])),_:1},8,["disabled"]),a(i,{color:"warning",variant:"soft",icon:"i-heroicons-arrow-up-tray",disabled:vt.value!=="sqlite",onClick:ia},{default:c(()=>e[343]||(e[343]=[m("恢复本地数据库")])),_:1},8,["disabled"]),t("input",{type:"file",ref_key:"databaseFileInput",ref:Vt,accept:".zip",class:"hidden",onChange:Rl},null,544)])]),t("div",ru,[t("div",{class:n(["text-yellow-400 text-sm rounded p-2",o.value.subtleBg])},"🔔：仅针对 SQLite 本地数据库；"+y(vt.value!=="sqlite"?"当前为云/外部数据库，请在服务端操作":"可在此下载与恢复本地备份"),3),t("input",{type:"file",ref_key:"databaseFileInput",ref:Vt,accept:".zip",class:"hidden",onChange:Rl},null,544),t("div",{class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",{class:n(["font-semibold mb-2 flex items-center justify-between",o.value.text])},[e[344]||(e[344]=t("span",null,"云存储接入（R2/S3）",-1)),t("div",uu,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([Q.value?"text-green-400":"text-red-400","text-sm"])},y(Q.value?"已启用":"未启用"),3),a(xe,{modelValue:Q.value,"onUpdate:modelValue":e[138]||(e[138]=s=>Q.value=s)},null,8,["modelValue"]),t("div",cu,[a(h,{modelValue:Q.value,"onUpdate:modelValue":e[139]||(e[139]=s=>Q.value=s),value:!0},null,8,["modelValue"]),t("span",{class:n(Q.value?o.value.text:"text-gray-400")},"开启",2),a(h,{modelValue:Q.value,"onUpdate:modelValue":e[140]||(e[140]=s=>Q.value=s),value:!1},null,8,["modelValue"]),t("span",{class:n(Q.value?"text-gray-400":o.value.text)},"关闭",2)])])],2),t("div",mu,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"提供方",2),a(re,{modelValue:L.provider,"onUpdate:modelValue":e[141]||(e[141]=s=>L.provider=s),options:[{label:"S3",value:"s3"},{label:"R2",value:"r2"}],disabled:!Q.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Endpoint",2),a(k,{modelValue:L.endpoint,"onUpdate:modelValue":e[142]||(e[142]=s=>L.endpoint=s),placeholder:"https://...",disabled:!Q.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Region",2),a(k,{modelValue:L.region,"onUpdate:modelValue":e[143]||(e[143]=s=>L.region=s),placeholder:"auto 或区域名",disabled:!Q.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Bucket",2),a(k,{modelValue:L.bucket,"onUpdate:modelValue":e[144]||(e[144]=s=>L.bucket=s),placeholder:"bucket 名称",disabled:!Q.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Access Key",2),a(k,{modelValue:L.accessKey,"onUpdate:modelValue":e[145]||(e[145]=s=>L.accessKey=s),disabled:!Q.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Secret Key",2),a(k,{modelValue:L.secretKey,"onUpdate:modelValue":e[146]||(e[146]=s=>L.secretKey=s),type:"password",disabled:!Q.value},null,8,["modelValue","disabled"])]),L.provider==="s3"?(g(),f("div",pu,[t("span",{class:n(["text-sm",o.value.mutedText])},"使用路径风格地址",2),a(xe,{modelValue:L.usePathStyle,"onUpdate:modelValue":e[147]||(e[147]=s=>L.usePathStyle=s),disabled:!Q.value},null,8,["modelValue","disabled"])])):A("",!0),t("div",vu,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"公共访问前缀",2),a(k,{modelValue:L.publicBaseURL,"onUpdate:modelValue":e[148]||(e[148]=s=>L.publicBaseURL=s),placeholder:"https://bucket.example.com/",disabled:!Q.value},null,8,["modelValue","disabled"])])]),t("div",gu,[a(i,{variant:"soft",color:"indigo",onClick:fl},{default:c(()=>e[345]||(e[345]=[m("刷新")])),_:1}),a(i,{color:"green",onClick:ra},{default:c(()=>e[346]||(e[346]=[m("保存")])),_:1})]),t("div",fu,[t("div",bu,[t("div",wu,[t("span",{class:n(["text-sm",o.value.mutedText])},"自动同步至云端",2),a(xe,{modelValue:at.value,"onUpdate:modelValue":e[149]||(e[149]=s=>at.value=s),disabled:!(Q.value&&L.provider&&L.endpoint&&L.bucket&&L.accessKey&&L.secretKey)},null,8,["modelValue","disabled"])]),t("div",yu,[t("span",{class:n(["text-sm",o.value.mutedText])},"模式",2),a(re,{modelValue:Ut.value,"onUpdate:modelValue":e[150]||(e[150]=s=>Ut.value=s),options:[{label:"即时",value:"instant"},{label:"定时",value:"scheduled"}],disabled:!at.value||!(Q.value&&L.provider&&L.endpoint&&L.bucket&&L.accessKey&&L.secretKey)},null,8,["modelValue","disabled"])]),Ut.value==="scheduled"?(g(),f("div",xu,[t("span",{class:n(["text-sm",o.value.mutedText])},"间隔(分钟)",2),a(k,{modelValue:Ft.value,"onUpdate:modelValue":e[151]||(e[151]=s=>Ft.value=s),modelModifiers:{number:!0},type:"number",min:"1",class:"w-24",disabled:!at.value||!(Q.value&&L.provider&&L.endpoint&&L.bucket&&L.accessKey&&L.secretKey)},null,8,["modelValue","disabled"])])):A("",!0),t("div",hu,[t("span",{class:n(["text-sm",o.value.mutedText])},"上次同步",2),t("span",{class:n(["text-sm",o.value.text])},y(jl.value||"—"),3),a(i,{color:"primary",disabled:!at.value||!(Q.value&&L.provider&&L.endpoint&&L.bucket&&L.accessKey&&L.secretKey),onClick:ua},{default:c(()=>e[347]||(e[347]=[m("立即同步")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"上传URL（预签名）",2),t("div",ku,[a(k,{modelValue:qt.value,"onUpdate:modelValue":e[152]||(e[152]=s=>qt.value=s),placeholder:"粘贴R2/S3预签名上传URL",class:"flex-1"},null,8,["modelValue"]),a(i,{disabled:!Q.value,onClick:pa},{default:c(()=>e[348]||(e[348]=[m("生成")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"下载URL（预签名）",2),t("div",Cu,[a(k,{modelValue:Kt.value,"onUpdate:modelValue":e[153]||(e[153]=s=>Kt.value=s),placeholder:"粘贴R2/S3预签名下载URL",class:"flex-1"},null,8,["modelValue"]),a(i,{disabled:!Q.value,onClick:va},{default:c(()=>e[349]||(e[349]=[m("生成")])),_:1},8,["disabled"])])])]),t("div",Vu,[a(i,{color:"primary",onClick:ca},{default:c(()=>e[350]||(e[350]=[m("上传备份到云")])),_:1}),a(i,{color:"warning",onClick:ma},{default:c(()=>e[351]||(e[351]=[m("从云恢复备份")])),_:1}),a(i,{color:"blue",variant:"solid",disabled:!Q.value||!L.publicBaseURL,onClick:ga},{default:c(()=>e[352]||(e[352]=[m("按配置恢复")])),_:1},8,["disabled"])])],2)])],2)])):A("",!0)])],2),Jt(t("div",{class:n(["flex fixed bottom-0 left-0 right-0 md:left-72 z-50 border-t px-3 py-3 justify-between items-center backdrop-blur-md shadow-xl",[o.value.bottomBg,o.value.border]])},[a(i,{icon:"i-heroicons-arrow-left",color:u.value==="light"?"gray":u.value==="midnight"?"blue":u.value==="slate"?"slate":"gray",variant:u.value==="light"?"soft":"solid",onClick:e[154]||(e[154]=s=>l.$router.push("/")),class:"shadow ring-1 ring-inset ring-slate-400/30 transition hover:opacity-90"},{default:c(()=>e[353]||(e[353]=[m(" 返回首页 ")])),_:1},8,["color","variant"]),St.value?(g(),f("div",Uu,[a(i,{icon:"i-heroicons-power",color:"red",variant:"solid",onClick:kl,class:"shadow transition hover:opacity-90"},{default:c(()=>e[354]||(e[354]=[m(" 退出登录 ")])),_:1})])):(g(),f("div",Eu,[a(i,{color:"primary",onClick:e[155]||(e[155]=s=>{Bt.value=!0,Ge.value=!0})},{default:c(()=>e[355]||(e[355]=[m("登录")])),_:1}),a(i,{color:"secondary",onClick:e[156]||(e[156]=s=>{Bt.value=!0,Ge.value=!1})},{default:c(()=>e[356]||(e[356]=[m("注册")])),_:1})]))],2),[[Ua,E.value]]),A("",!0)]),a(ge,{modelValue:Bt.value,"onUpdate:modelValue":e[202]||(e[202]=s=>Bt.value=s)},{default:c(()=>[t("div",{class:n(["p-6 rounded-lg",o.value.cardBg])},[t("h3",{class:n(["text-xl font-semibold mb-4",o.value.text])},y(Ge.value?"用户登录":"用户注册"),3),a(Z,{state:st,class:"space-y-4"},{default:c(()=>[a(q,null,{default:c(()=>[a(k,{modelValue:st.username,"onUpdate:modelValue":e[198]||(e[198]=s=>st.username=s),placeholder:"用户名",class:"w-full"},null,8,["modelValue"])]),_:1}),a(q,null,{default:c(()=>[a(k,{modelValue:st.password,"onUpdate:modelValue":e[199]||(e[199]=s=>st.password=s),type:"password",placeholder:"密码",class:"w-full"},null,8,["modelValue"])]),_:1}),t("div",Tu,[a(i,{variant:"ghost",onClick:e[200]||(e[200]=s=>Ge.value=!Ge.value)},{default:c(()=>[m(y(Ge.value?"去注册":"去登录"),1)]),_:1}),a(i,{color:"primary",onClick:e[201]||(e[201]=s=>Ge.value?Te(Ne)(st):Te(Oe)(st))},{default:c(()=>[m(y(Ge.value?"登录":"注册"),1)]),_:1})])]),_:1},8,["state"])],2)]),_:1},8,["modelValue"]),a(ge,{modelValue:pl.value,"onUpdate:modelValue":e[203]||(e[203]=s=>pl.value=s)},{default:c(()=>[t("div",Lu,[t("img",{src:$l.value,class:"max-h-[70vh] w-auto mx-auto rounded"},null,8,Au)])]),_:1},8,["modelValue"]),t("input",{type:"file",ref_key:"bgFileInput",ref:yt,accept:"image/*",multiple:"",class:"hidden",onChange:Ys},null,544)],2)}}}),Bu=Zt(Su,[["__scopeId","data-v-8d0469a6"]]),Hu=it({__name:"status",setup(v){const J=typeof document<"u"?Array.from(document.documentElement.classList):[];return Ce(()=>{if(typeof window>"u")return;const U=(localStorage.getItem("adminTheme")||"dark").toLowerCase(),u=document.documentElement;u.classList.remove("dark"),U!=="light"&&u.classList.add("dark")}),La(()=>{if(typeof window>"u")return;const U=document.documentElement;Array.from(U.classList).forEach(u=>U.classList.remove(u)),J.forEach(u=>U.classList.add(u))}),(U,u)=>(g(),f(de,null,[a(Bu),a($a)],64))}});export{Hu as default};
