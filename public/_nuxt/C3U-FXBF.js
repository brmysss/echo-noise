import{M as Ue,N as te,L as ve,A as de,O as je,t as ge,ac as Ee,a0 as Ne,i as H,ad as We,P as pe,D as m,E as f,H as s,R as O,a7 as rt,ae as it,T as ae,V as P,Q as J,K as v,U as A,r as M,a4 as he,S as ie,W as G,af as Be,B as fe,c as dt,ag as ut,Z as ct,a1 as Fe,n as $,ah as pt,ai as ft,$ as Ae,aj as mt,X as me,I as n,ak as ze,k as se,w as De,al as gt,G as b,_ as Ge,F as ke,h as re,a6 as wt,a9 as vt,ab as bt}from"./Dp-Aei3E.js";import{u as Me,e as yt,_ as qe,d as Ke,b as ht,a as kt,c as Ct,N as Vt}from"./BhyYl5Xx.js";const $t={wrapper:"",inner:"",label:{wrapper:"flex content-center items-center justify-between",base:"block font-medium text-gray-700 dark:text-gray-200",required:"after:content-['*'] after:ms-0.5 after:text-red-500 dark:after:text-red-400"},size:{"2xs":"text-xs",xs:"text-xs",sm:"text-sm",md:"text-sm",lg:"text-sm",xl:"text-base"},container:"mt-1 relative",description:"text-gray-500 dark:text-gray-400",hint:"text-gray-500 dark:text-gray-400",help:"mt-2 text-gray-500 dark:text-gray-400",error:"mt-2 text-red-500 dark:text-red-400",default:{size:"sm"}},Tt={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},Te=Ue(te.ui.strategy,te.ui.radio,Tt),St=de({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>Te.default.color,validator(e){return te.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:u}){const{ui:c,attrs:g}=je("radio",ge(e,"ui"),Te,ge(e,"class")),a=e.id??Ee(),r=Ne("radio-group",null),{emitFormChange:k,color:C,name:T}=r??Me(e,Te),V=H({get(){return e.modelValue},set(p){u("update:modelValue",p),r||k()}});function z(p){u("change",p.target.value)}const U=H(()=>We(pe(c.value.base,c.value.form,c.value.background,c.value.border,C.value&&c.value.ring.replaceAll("{color}",C.value),C.value&&c.value.color.replaceAll("{color}",C.value)),e.inputClass));return{inputId:a,ui:c,attrs:g,pick:V,name:T,inputClass:U,onChange:z}}}),Ut=["data-n-ids"],jt=["id","name","required","value","disabled"],Et=["for"];function At(e,u,c,g,a,r){return f(),m("div",{class:P(e.ui.wrapper),"data-n-ids":e.attrs["data-n-ids"]},[s("div",{class:P(e.ui.container)},[rt(s("input",ae({id:e.inputId,"onUpdate:modelValue":u[0]||(u[0]=k=>e.pick=k),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:e.inputClass},e.attrs,{onChange:u[1]||(u[1]=(...k)=>e.onChange&&e.onChange(...k))}),null,16,jt),[[it,e.pick]])],2),e.label||e.$slots.label?(f(),m("div",{key:0,class:P(e.ui.inner)},[s("label",{for:e.inputId,class:P(e.ui.label)},[J(e.$slots,"label",{label:e.label},()=>[v(A(e.label),1)]),e.required?(f(),m("span",{key:0,class:P(e.ui.required)},"*",2)):O("",!0)],10,Et),e.help||e.$slots.help?(f(),m("p",{key:0,class:P(e.ui.help)},[J(e.$slots,"help",{help:e.help},()=>[v(A(e.help),1)])],2)):O("",!0)],2)):O("",!0)],10,Ut)}const It=ve(St,[["render",At]]),Se=Ue(te.ui.strategy,te.ui.formGroup,$t),xt=de({inheritAttrs:!1,props:{name:{type:String,default:null},size:{type:String,default:null,validator(e){return Object.keys(Se.size).includes(e)}},label:{type:String,default:null},description:{type:String,default:null},required:{type:Boolean,default:!1},help:{type:String,default:null},error:{type:[String,Boolean],default:null},hint:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},eagerValidation:{type:Boolean,default:!1}},setup(e){const{ui:u,attrs:c}=je("formGroup",ge(e,"ui"),Se,ge(e,"class")),g=Ne("form-errors",null),a=H(()=>{var C,T;return e.error&&typeof e.error=="string"||typeof e.error=="boolean"?e.error:(T=(C=g==null?void 0:g.value)==null?void 0:C.find(V=>V.path===e.name))==null?void 0:T.message}),r=H(()=>u.value.size[e.size??Se.default.size]),k=M(Ee());return he("form-group",{error:a,inputId:k,name:H(()=>e.name),size:H(()=>e.size),eagerValidation:H(()=>e.eagerValidation)}),{ui:u,attrs:c,inputId:k,size:r,error:a}}}),Pt=["for"];function Ht(e,u,c,g,a,r){return f(),m("div",ae({class:e.ui.wrapper},e.attrs),[s("div",{class:P(e.ui.inner)},[e.label||e.$slots.label?(f(),m("div",{key:0,class:P([e.ui.label.wrapper,e.size])},[s("label",{for:e.inputId,class:P([e.ui.label.base,e.required?e.ui.label.required:""])},[e.$slots.label?J(e.$slots,"label",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[v(A(e.label),1)],64))],10,Pt),e.hint||e.$slots.hint?(f(),m("span",{key:0,class:P([e.ui.hint])},[e.$slots.hint?J(e.$slots,"hint",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[v(A(e.hint),1)],64))],2)):O("",!0)],2)):O("",!0),e.description||e.$slots.description?(f(),m("p",{key:1,class:P([e.ui.description,e.size])},[e.$slots.description?J(e.$slots,"description",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[v(A(e.description),1)],64))],2)):O("",!0)],2),s("div",{class:P([e.label?e.ui.container:""])},[J(e.$slots,"default",ie(Be({error:e.error}))),typeof e.error=="string"&&e.error?(f(),m("p",{key:0,class:P([e.ui.error,e.size])},[e.$slots.error?J(e.$slots,"error",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[v(A(e.error),1)],64))],2)):e.help||e.$slots.help?(f(),m("p",{key:1,class:P([e.ui.help,e.size])},[e.$slots.help?J(e.$slots,"help",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[v(A(e.help),1)],64))],2)):O("",!0)],2)],16)}const Lt=ve(xt,[["render",Ht]]);class Ce extends Error{constructor(u){super(u),this.message=u,Object.setPrototypeOf(this,Ce.prototype)}}const Rt=de({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:u,emit:c}){const g=Ee(),a=yt(`form-${g}`),r=M(null);fe(()=>{a.on(async U=>{var p;U.type!=="submit"&&((p=e.validateOn)!=null&&p.includes(U.type))&&await V(U.path,{silent:!0})})}),dt(()=>{a.reset()});const k=M([]);he("form-errors",k),he("form-events",a);const C=M({});he("form-inputs",C);async function T(){let U=await e.validate(e.state);if(e.schema){const{errors:p,result:o}=await Yt(e.state,e.schema);p?U=U.concat(p):r.value=o}return U}async function V(U,p={silent:!1}){let o=U;if(U&&!Array.isArray(U)&&(o=[U]),o){const j=k.value.filter(S=>!o.includes(S.path)),y=(await T()).filter(S=>o.includes(S.path));k.value=j.concat(y)}else k.value=await T();if(k.value.length>0){if(p.silent)return!1;throw new Ce(`Form validation failed: ${JSON.stringify(k.value,null,2)}`)}return e.state}async function z(U){var o;const p=U;try{(o=e.validateOn)!=null&&o.includes("submit")&&await V(),p.data=e.schema?r.value:e.state,c("submit",p)}catch(j){if(!(j instanceof Ce))throw j;const y={...p,errors:k.value.map(S=>({...S,id:C.value[S.path]}))};c("error",y)}}return u({validate:V,errors:k,setErrors(U,p){p?k.value=k.value.filter(o=>o.path!==p).concat(U):k.value=U},async submit(){await z(new Event("submit"))},getErrors(U){return U?k.value.filter(p=>p.path===U):k.value},clear(U){U?k.value=k.value.filter(p=>p.path!==U):k.value=[]}}),{onSubmit:z,errors:ut(k)}}});function Ot(e){return e.validate&&e.__isYupSchema__}function zt(e){return e.inner!==void 0}function Nt(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function Wt(e){return e.validateAsync!==void 0&&e.id!==void 0}function Bt(e){return e.isJoi===!0}function Ft(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}function Dt(e){return e.parse!==void 0}function Gt(e){return"~standard"in e}async function Mt(e,u){const c=await u["~standard"].validate(e);return!c.issues||c.issues.length===0?{errors:null,result:"value"in c?c.value:null}:{errors:c.issues.map(a=>{var r;return{path:((r=a.path)==null?void 0:r.map(k=>typeof k=="object"?k.key:k).join("."))||"",message:a.message}}),result:null}}async function qt(e,u){const c=await("_parse"in u?u._parse(e):"_run"in u?u._run({typed:!1,value:e},{}):u(e));return!c.issues||c.issues.length===0?{errors:null,result:"output"in c?c.output:"value"in c?c.value:null}:{errors:c.issues.map(a=>{var r;return{path:((r=a.path)==null?void 0:r.map(k=>k.key).join("."))||"",message:a.message}}),result:null}}async function Kt(e,u){try{return{errors:null,result:await u.validateAsync(e,{abortEarly:!1})}}catch(c){if(Bt(c))return{errors:c.details.map(a=>({path:a.path.join("."),message:a.message})),result:null};throw c}}async function Jt(e,u){const c=await u.safeParseAsync(e);return c.success===!1?{errors:c.error.issues.map(a=>({path:a.path.join("."),message:a.message})),result:null}:{result:c.data,errors:null}}async function _t(e,u){const[c,g]=u.validate(e);return c?{errors:c.failures().map(r=>({message:r.message,path:r.path.join(".")})),result:null}:{errors:null,result:g}}async function Qt(e,u){try{return{errors:null,result:await u.validate(e,{abortEarly:!1})}}catch(c){if(zt(c))return{errors:c.inner.map(a=>({path:a.path??"",message:a.message})),result:null};throw c}}function Yt(e,u){if(Gt(u))return Mt(e,u);if(Dt(u))return Jt(e,u);if(Wt(u))return Kt(e,u);if(Ft(u))return qt(e,u);if(Ot(u))return Qt(e,u);if(Nt(u))return _t(e,u);throw new Error("Form validation failed: Unsupported form schema")}function Xt(e,u,c,g,a,r){return f(),m("form",{onSubmit:u[0]||(u[0]=ct((...k)=>e.onSubmit&&e.onSubmit(...k),["prevent"]))},[J(e.$slots,"default",ie(Be({errors:e.errors})))],32)}const Zt=ve(Rt,[["render",Xt]]),eo=()=>{const e=Fe(),u=$(),c=pt(),g=async()=>{const T=await e.getStatus();return T&&e.setUserStatus(T),T},a=async T=>{await e.register(T)&&u.add({title:"注册成功",description:"欢迎使用！请登录",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3})},r=async T=>{await e.login(T)&&(await g(),u.add({title:"登录成功",description:"欢迎回来！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),c.push("/"))},k=async()=>{await e.logout(),e.clearUserStatus(),u.add({title:"注销成功",description:"欢迎再次使用！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),c.push("/")},C=async()=>await g();return fe(async()=>{await g()}),{register:a,login:r,logout:k,getStatus:C}},ee=Ue(te.ui.strategy,te.ui.select,ft),to=de({components:{UIcon:Ae},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>ee.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>ee.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(e){return Object.keys(ee.size).includes(e)}},color:{type:String,default:()=>ee.default.color,validator(e){return[...te.ui.colors,...Object.keys(ee.color)].includes(e)}},variant:{type:String,default:()=>ee.default.variant,validator(e){return[...Object.keys(ee.variant),...Object.values(ee.color).flatMap(u=>Object.keys(u))].includes(e)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:u,slots:c}){const{ui:g,attrs:a}=je("select",ge(e,"ui"),ee,ge(e,"class")),{size:r,rounded:k}=mt({ui:g,props:e}),{emitFormChange:C,inputId:T,color:V,size:z,name:U}=Me(e,ee),p=H(()=>r.value??z.value),o=I=>{u("update:modelValue",I.target.value)},j=I=>{u("change",I.target.value),C()},y=I=>ze(I,e.valueAttribute,""),S=I=>ze(I,e.optionAttribute,""),F=I=>["string","number","boolean"].includes(typeof I)?{[e.valueAttribute]:I,[e.optionAttribute]:I}:{...I,[e.valueAttribute]:y(I),[e.optionAttribute]:S(I)},D=H(()=>e.options.map(I=>F(I))),d=H(()=>e.placeholder?[{[e.valueAttribute]:"",[e.optionAttribute]:e.placeholder,disabled:!0},...D.value]:D.value),_=H(()=>{const I=F(e.modelValue),le=d.value.find(X=>X[e.valueAttribute]===I[e.valueAttribute]);return le?le[e.valueAttribute]:""}),L=H(()=>{var le,X;const I=((X=(le=g.value.color)==null?void 0:le[V.value])==null?void 0:X[e.variant])||g.value.variant[e.variant];return We(pe(g.value.base,g.value.form,k.value,g.value.size[p.value],e.padded?g.value.padding[p.value]:"p-0",I==null?void 0:I.replaceAll("{color}",V.value),(R.value||c.leading)&&g.value.leading.padding[p.value],(ne.value||c.trailing)&&g.value.trailing.padding[p.value]),e.placeholder&&!e.modelValue&&g.value.placeholder,e.selectClass)}),R=H(()=>e.icon&&e.leading||e.icon&&!e.trailing||e.loading&&!e.trailing||e.leadingIcon),ne=H(()=>e.icon&&e.trailing||e.loading&&e.trailing||e.trailingIcon),Ve=H(()=>e.loading?e.loadingIcon:e.leadingIcon||e.icon),we=H(()=>e.loading&&!R.value?e.loadingIcon:e.trailingIcon||e.icon),w=H(()=>pe(g.value.icon.leading.wrapper,g.value.icon.leading.pointer,g.value.icon.leading.padding[p.value])),Q=H(()=>pe(g.value.icon.base,V.value&&te.ui.colors.includes(V.value)&&g.value.icon.color.replaceAll("{color}",V.value),g.value.icon.size[p.value],e.loading&&g.value.icon.loading)),oe=H(()=>pe(g.value.icon.trailing.wrapper,g.value.icon.trailing.pointer,g.value.icon.trailing.padding[p.value])),Y=H(()=>pe(g.value.icon.base,V.value&&te.ui.colors.includes(V.value)&&g.value.icon.color.replaceAll("{color}",V.value),g.value.icon.size[p.value],e.loading&&!R.value&&g.value.icon.loading));return{ui:g,attrs:a,name:U,inputId:T,normalizedOptionsWithPlaceholder:d,normalizedValue:_,isLeading:R,isTrailing:ne,selectClass:L,leadingIconName:Ve,leadingIconClass:Q,leadingWrapperIconClass:w,trailingIconName:we,trailingIconClass:Y,trailingWrapperIconClass:oe,onInput:o,onChange:j}}}),oo=["id","name","value","required","disabled"],so=["value","label"],ao=["value","selected","disabled","textContent"],no=["value","selected","disabled","textContent"];function lo(e,u,c,g,a,r){const k=Ae;return f(),m("div",{class:P(e.ui.wrapper)},[s("select",ae({id:e.inputId,name:e.name,value:e.modelValue,required:e.required,disabled:e.disabled,class:e.selectClass},e.attrs,{onInput:u[0]||(u[0]=(...C)=>e.onInput&&e.onInput(...C)),onChange:u[1]||(u[1]=(...C)=>e.onChange&&e.onChange(...C))}),[(f(!0),m(G,null,me(e.normalizedOptionsWithPlaceholder,(C,T)=>(f(),m(G,null,[C.children?(f(),m("optgroup",{key:`${C[e.valueAttribute]}-optgroup-${T}`,value:C[e.valueAttribute],label:C[e.optionAttribute]},[(f(!0),m(G,null,me(C.children,(V,z)=>(f(),m("option",{key:`${V[e.valueAttribute]}-${T}-${z}`,value:V[e.valueAttribute],selected:V[e.valueAttribute]===e.normalizedValue,disabled:V.disabled,textContent:A(V[e.optionAttribute])},null,8,ao))),128))],8,so)):(f(),m("option",{key:`${C[e.valueAttribute]}-${T}`,value:C[e.valueAttribute],selected:C[e.valueAttribute]===e.normalizedValue,disabled:C.disabled,textContent:A(C[e.optionAttribute])},null,8,no))],64))),256))],16,oo),e.isLeading&&e.leadingIconName||e.$slots.leading?(f(),m("span",{key:0,class:P(e.leadingWrapperIconClass)},[J(e.$slots,"leading",{disabled:e.disabled,loading:e.loading},()=>[n(k,{name:e.leadingIconName,class:P(e.leadingIconClass)},null,8,["name","class"])],!0)],2)):O("",!0),e.isTrailing&&e.trailingIconName||e.$slots.trailing?(f(),m("span",{key:1,class:P(e.trailingWrapperIconClass)},[J(e.$slots,"trailing",{disabled:e.disabled,loading:e.loading},()=>[n(k,{name:e.trailingIconName,class:P(e.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):O("",!0)],2)}const ro=ve(to,[["render",lo],["__scopeId","data-v-db8f1118"]]),io={class:"bg-gray-700 rounded-lg p-4 mb-6"},uo={class:"space-y-4"},co={class:"bg-gray-800 rounded p-3"},po={class:"flex justify-between items-center mb-2"},fo={class:"flex items-center gap-2"},mo={key:0,class:"space-y-2"},go={class:"flex justify-end gap-2"},wo={class:"bg-gray-800 rounded p-3"},vo={class:"flex justify-between items-center mb-2"},bo={class:"flex items-center gap-2"},yo={key:0,class:"space-y-2"},ho={class:"flex justify-end gap-2"},ko={class:"bg-gray-800 rounded p-3"},Co={class:"flex justify-between items-center mb-2"},Vo={class:"flex items-center gap-2"},$o={key:0,class:"space-y-2"},To={class:"flex justify-end gap-2"},So={class:"bg-gray-800 rounded p-3"},Uo={class:"flex justify-between items-center mb-2"},jo={class:"flex items-center gap-2"},Eo={key:0,class:"space-y-2"},Ao={class:"flex justify-end gap-2"},Io={class:"bg-gray-800 rounded p-3"},xo={class:"flex justify-between items-center mb-2"},Po={class:"flex items-center gap-2"},Ho={key:0,class:"space-y-2"},Lo={class:"flex justify-end gap-2"},Ro={class:"bg-gray-800 rounded p-3"},Oo={class:"flex justify-between items-center mb-2"},zo={class:"flex items-center gap-2"},No={key:0,class:"space-y-2"},Wo={class:"flex justify-end gap-2"},Bo={class:"mt-4 flex flex-wrap gap-2"},Fo=de({__name:"NotifyPanel",props:{config:{},immediate:{type:Boolean}},emits:["save"],setup(e,{emit:u}){const c=u,g=e,a=se({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:"",twitterEnabled:!1,twitterApiKey:"",twitterApiSecret:"",twitterAccessToken:"",twitterAccessTokenSecret:"",customHttpEnabled:!1,customHttpUrl:"",customHttpMethod:"POST",customHttpHeaders:"",customHttpBody:'{"content":"{{content}}"}'}),r=se({webhook:!1,telegram:!1,wework:!1,feishu:!1,twitter:!1,customHttp:!1}),k=["webhook","telegram","wework","feishu","twitter","customHttp"],C=p=>({webhook:"Webhook",telegram:"Telegram",wework:"企业微信",feishu:"飞书",twitter:"Twitter",customHttp:"自定义HTTP"})[p]||p,T=p=>{const o=p.toLowerCase();Object.keys(a).forEach(j=>{j.toLowerCase().startsWith(o)&&(a[j]=g.config[j])}),r[p]=!1},V=p=>{var j,y,S,F,D,d,_,L,R,ne;const o=a;switch(p){case"webhook":return o.webhookEnabled&&!!((j=o.webhookURL)!=null&&j.trim());case"telegram":return o.telegramEnabled&&!!((y=o.telegramToken)!=null&&y.trim())&&!!((S=o.telegramChatID)!=null&&S.trim());case"wework":return o.weworkEnabled&&!!((F=o.weworkKey)!=null&&F.trim());case"feishu":return o.feishuEnabled&&!!((D=o.feishuWebhook)!=null&&D.trim());case"twitter":return o.twitterEnabled&&!!((d=o.twitterApiKey)!=null&&d.trim())&&!!((_=o.twitterApiSecret)!=null&&_.trim())&&!!((L=o.twitterAccessToken)!=null&&L.trim())&&!!((R=o.twitterAccessTokenSecret)!=null&&R.trim());case"customHttp":return o.customHttpEnabled&&!!((ne=o.customHttpUrl)!=null&&ne.trim());default:return!1}},z=async p=>{try{switch(p){case"webhook":if(a.webhookEnabled&&!a.webhookURL)throw new Error("Webhook URL不能为空");break;case"telegram":if(a.telegramEnabled&&(!a.telegramToken||!a.telegramChatID))throw new Error("Telegram配置不完整");break;case"wework":if(a.weworkEnabled&&!a.weworkKey)throw new Error("企业微信Key不能为空");break;case"feishu":if(a.feishuEnabled&&!a.feishuWebhook)throw new Error("飞书Webhook不能为空");break;case"twitter":if(a.twitterEnabled&&(!a.twitterApiKey||!a.twitterApiSecret||!a.twitterAccessToken||!a.twitterAccessTokenSecret))throw new Error("Twitter配置不完整");break;case"customHttp":if(a.customHttpEnabled&&!a.customHttpUrl)throw new Error("自定义HTTP URL不能为空");break}const o={webhookEnabled:a.webhookEnabled,webhookURL:a.webhookURL,telegramEnabled:a.telegramEnabled,telegramToken:a.telegramToken,telegramChatID:a.telegramChatID,weworkEnabled:a.weworkEnabled,weworkKey:a.weworkKey,feishuEnabled:a.feishuEnabled,feishuWebhook:a.feishuWebhook,feishuSecret:a.feishuSecret,twitterEnabled:a.twitterEnabled,twitterApiKey:a.twitterApiKey,twitterApiSecret:a.twitterApiSecret,twitterAccessToken:a.twitterAccessToken,twitterAccessTokenSecret:a.twitterAccessTokenSecret,customHttpEnabled:a.customHttpEnabled,customHttpUrl:a.customHttpUrl,customHttpMethod:a.customHttpMethod,customHttpHeaders:a.customHttpHeaders,customHttpBody:a.customHttpBody},y=await(await fetch("/api/notify/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)})).json();if(y.code===1)r[p]=!1,y.data&&Object.keys(y.data).forEach(S=>{S.endsWith("Enabled")?a[S]=!!y.data[S]&&y.data[S]!=="false":a[S]=y.data[S]||""}),c("save",{...a}),$().add({title:"成功",description:`${C(p)}配置已保存`,color:"green"});else throw new Error(y.msg||"保存失败")}catch(o){console.error("保存配置失败:",o),$().add({title:"错误",description:o.message||"保存失败",color:"red"})}},U=async p=>{try{if(!V(p))throw new Error(`请先完成并启用${C(p)}配置`);const j=await(await fetch("/api/notify/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:p})})).json();if(j.code===1)$().add({title:"成功",description:`${C(p)}测试消息已发送`,color:"green"});else throw new Error(j.msg||"测试失败")}catch(o){console.error("测试失败:",o),$().add({title:"错误",description:o.message||"测试失败",color:"red"})}};return De(()=>g.config,p=>{p&&Object.keys(a).forEach(o=>{p[o]!==void 0&&(o.endsWith("Enabled")?a[o]=!!p[o]&&p[o]!=="false":a[o]=p[o])})},{deep:!0,immediate:!0}),fe(async()=>{try{const o=await(await fetch("/api/notify/config",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();if(o.code===1&&o.data){const j=o.data;Object.keys(j).forEach(y=>{y.endsWith("Enabled")?a[y]=!!j[y]&&j[y]!=="false":a[y]=j[y]||""}),console.log("加载的配置:",a)}}catch(p){console.error("获取配置失败:",p),$().add({title:"错误",description:"获取推送配置失败",color:"red"})}}),(p,o)=>{const j=gt("USwitch"),y=Ge,S=qe,F=ro,D=Ke;return f(),m("div",io,[o[56]||(o[56]=s("div",{class:"flex justify-between items-center mb-4"},[s("h2",{class:"text-xl font-semibold text-white"},"推送渠道配置")],-1)),s("div",uo,[s("div",co,[s("div",po,[o[38]||(o[38]=s("span",{class:"text-gray-300"},"Webhook推送",-1)),s("div",fo,[n(j,{modelValue:a.webhookEnabled,"onUpdate:modelValue":o[0]||(o[0]=d=>a.webhookEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[1]||(o[1]=d=>r.webhook=!r.webhook),color:r.webhook?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.webhook?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.webhook?(f(),m("div",mo,[n(S,{modelValue:a.webhookURL,"onUpdate:modelValue":o[2]||(o[2]=d=>a.webhookURL=d),placeholder:"Webhook URL"},null,8,["modelValue"]),s("div",go,[n(y,{onClick:o[3]||(o[3]=d=>T("webhook")),variant:"ghost",color:"gray"},{default:b(()=>o[39]||(o[39]=[v(" 重置 ")])),_:1}),n(y,{onClick:o[4]||(o[4]=d=>z("webhook")),color:"primary"},{default:b(()=>o[40]||(o[40]=[v(" 保存 ")])),_:1})])])):O("",!0)]),s("div",wo,[s("div",vo,[o[41]||(o[41]=s("span",{class:"text-gray-300"},"Telegram推送",-1)),s("div",bo,[n(j,{modelValue:a.telegramEnabled,"onUpdate:modelValue":o[5]||(o[5]=d=>a.telegramEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[6]||(o[6]=d=>r.telegram=!r.telegram),color:r.telegram?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.telegram?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.telegram?(f(),m("div",yo,[n(S,{modelValue:a.telegramToken,"onUpdate:modelValue":o[7]||(o[7]=d=>a.telegramToken=d),placeholder:"Bot Token"},null,8,["modelValue"]),n(S,{modelValue:a.telegramChatID,"onUpdate:modelValue":o[8]||(o[8]=d=>a.telegramChatID=d),placeholder:"Chat ID"},null,8,["modelValue"]),s("div",ho,[n(y,{onClick:o[9]||(o[9]=d=>T("telegram")),variant:"ghost",color:"gray"},{default:b(()=>o[42]||(o[42]=[v(" 重置 ")])),_:1}),n(y,{onClick:o[10]||(o[10]=d=>z("telegram")),color:"primary"},{default:b(()=>o[43]||(o[43]=[v(" 保存 ")])),_:1})])])):O("",!0)]),s("div",ko,[s("div",Co,[o[44]||(o[44]=s("span",{class:"text-gray-300"},"企业微信推送",-1)),s("div",Vo,[n(j,{modelValue:a.weworkEnabled,"onUpdate:modelValue":o[11]||(o[11]=d=>a.weworkEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[12]||(o[12]=d=>r.wework=!r.wework),color:r.wework?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.wework?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.wework?(f(),m("div",$o,[n(S,{modelValue:a.weworkKey,"onUpdate:modelValue":o[13]||(o[13]=d=>a.weworkKey=d),placeholder:"WebHook Key"},null,8,["modelValue"]),s("div",To,[n(y,{onClick:o[14]||(o[14]=d=>T("wework")),variant:"ghost",color:"gray"},{default:b(()=>o[45]||(o[45]=[v(" 重置 ")])),_:1}),n(y,{onClick:o[15]||(o[15]=d=>z("wework")),color:"primary"},{default:b(()=>o[46]||(o[46]=[v(" 保存 ")])),_:1})])])):O("",!0)]),s("div",So,[s("div",Uo,[o[47]||(o[47]=s("span",{class:"text-gray-300"},"飞书推送",-1)),s("div",jo,[n(j,{modelValue:a.feishuEnabled,"onUpdate:modelValue":o[16]||(o[16]=d=>a.feishuEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[17]||(o[17]=d=>r.feishu=!r.feishu),color:r.feishu?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.feishu?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.feishu?(f(),m("div",Eo,[n(S,{modelValue:a.feishuWebhook,"onUpdate:modelValue":o[18]||(o[18]=d=>a.feishuWebhook=d),placeholder:"WebHook URL"},null,8,["modelValue"]),n(S,{modelValue:a.feishuSecret,"onUpdate:modelValue":o[19]||(o[19]=d=>a.feishuSecret=d),placeholder:"签名密钥",type:"password"},null,8,["modelValue"]),s("div",Ao,[n(y,{onClick:o[20]||(o[20]=d=>T("feishu")),variant:"ghost",color:"gray"},{default:b(()=>o[48]||(o[48]=[v(" 重置 ")])),_:1}),n(y,{onClick:o[21]||(o[21]=d=>z("feishu")),color:"primary"},{default:b(()=>o[49]||(o[49]=[v(" 保存 ")])),_:1})])])):O("",!0)]),s("div",Io,[s("div",xo,[o[50]||(o[50]=s("span",{class:"text-gray-300"},"Twitter推送",-1)),s("div",Po,[n(j,{modelValue:a.twitterEnabled,"onUpdate:modelValue":o[22]||(o[22]=d=>a.twitterEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[23]||(o[23]=d=>r.twitter=!r.twitter),color:r.twitter?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.twitter?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.twitter?(f(),m("div",Ho,[n(S,{modelValue:a.twitterApiKey,"onUpdate:modelValue":o[24]||(o[24]=d=>a.twitterApiKey=d),placeholder:"API Key"},null,8,["modelValue"]),n(S,{modelValue:a.twitterApiSecret,"onUpdate:modelValue":o[25]||(o[25]=d=>a.twitterApiSecret=d),placeholder:"API Secret"},null,8,["modelValue"]),n(S,{modelValue:a.twitterAccessToken,"onUpdate:modelValue":o[26]||(o[26]=d=>a.twitterAccessToken=d),placeholder:"Access Token"},null,8,["modelValue"]),n(S,{modelValue:a.twitterAccessTokenSecret,"onUpdate:modelValue":o[27]||(o[27]=d=>a.twitterAccessTokenSecret=d),placeholder:"Access Token Secret"},null,8,["modelValue"]),s("div",Lo,[n(y,{onClick:o[28]||(o[28]=d=>T("twitter")),variant:"ghost",color:"gray"},{default:b(()=>o[51]||(o[51]=[v("重置")])),_:1}),n(y,{onClick:o[29]||(o[29]=d=>z("twitter")),color:"primary"},{default:b(()=>o[52]||(o[52]=[v("保存")])),_:1})])])):O("",!0)]),s("div",Ro,[s("div",Oo,[o[53]||(o[53]=s("span",{class:"text-gray-300"},"自定义HTTP推送",-1)),s("div",zo,[n(j,{modelValue:a.customHttpEnabled,"onUpdate:modelValue":o[30]||(o[30]=d=>a.customHttpEnabled=d)},null,8,["modelValue"]),n(y,{size:"sm",onClick:o[31]||(o[31]=d=>r.customHttp=!r.customHttp),color:r.customHttp?"gray":"primary",variant:"soft"},{default:b(()=>[v(A(r.customHttp?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.customHttp?(f(),m("div",No,[n(S,{modelValue:a.customHttpUrl,"onUpdate:modelValue":o[32]||(o[32]=d=>a.customHttpUrl=d),placeholder:"请求URL"},null,8,["modelValue"]),n(F,{modelValue:a.customHttpMethod,"onUpdate:modelValue":o[33]||(o[33]=d=>a.customHttpMethod=d),options:["POST","PUT","PATCH"]},null,8,["modelValue"]),n(D,{modelValue:a.customHttpHeaders,"onUpdate:modelValue":o[34]||(o[34]=d=>a.customHttpHeaders=d),placeholder:"请求Headers（JSON格式）"},null,8,["modelValue"]),n(D,{modelValue:a.customHttpBody,"onUpdate:modelValue":o[35]||(o[35]=d=>a.customHttpBody=d),placeholder:'请求Body模板（如：{"content":"{{content}}"})'},null,8,["modelValue"]),s("div",Wo,[n(y,{onClick:o[36]||(o[36]=d=>T("customHttp")),variant:"ghost",color:"gray"},{default:b(()=>o[54]||(o[54]=[v("重置")])),_:1}),n(y,{onClick:o[37]||(o[37]=d=>z("customHttp")),color:"primary"},{default:b(()=>o[55]||(o[55]=[v("保存")])),_:1})])])):O("",!0)])]),s("div",Bo,[(f(),m(G,null,me(k,d=>n(y,{key:d,onClick:_=>U(d),class:"flex-grow sm:flex-grow-0",variant:"solid"},{default:b(()=>[v(" 测试"+A(C(d)),1)]),_:2},1032,["onClick"])),64))])])}}}),Do={class:"fixed inset-0 bg-black overflow-auto"},Go={class:"min-h-screen p-4 flex items-center justify-center"},Mo={class:"w-[800px] max-w-[95%] bg-[#1a1b2e]/80 backdrop-blur-md rounded-lg shadow-xl p-6"},qo={class:"text-center mb-6 flex items-center justify-center gap-2"},Ko={key:0,class:"text-center mb-6"},Jo={class:"flex items-center justify-center gap-2 text-orange-400"},_o={class:"bg-gray-700 rounded-lg p-4 mb-6"},Qo={class:"grid gap-4"},Yo={class:"flex justify-between items-center"},Xo={class:"text-white font-medium"},Zo={class:"flex justify-between items-center"},es={class:"text-white font-medium"},ts={class:"flex justify-between items-center"},os={class:"text-white font-medium"},ss={key:1,class:"bg-gray-700 rounded-lg p-4 mb-6"},as={class:"space-y-4"},ns={class:"bg-gray-800 rounded p-3"},ls={class:"flex justify-between items-center mb-2"},rs={key:0},is={class:"flex justify-end gap-2"},ds={key:1},us={class:"text-white"},cs={class:"bg-gray-800 rounded p-3"},ps={class:"flex justify-between items-center mb-2"},fs={key:0,class:"mb-2"},ms={class:"flex items-center gap-2"},gs={key:1},ws={class:"bg-gray-800 rounded p-3"},vs={class:"flex justify-between items-center mb-2"},bs={key:0},ys={class:"flex justify-end gap-2"},hs={key:2,class:"bg-gray-700 rounded-lg p-4 mb-6"},ks={class:"flex items-center bg-gray-800 rounded p-3 mb-4 justify-between"},Cs={class:"flex items-center gap-4"},Vs={class:"flex items-center"},$s={class:"flex items-center"},Ts={class:"bg-gray-800 rounded p-4 mb-4"},Ss={class:"flex justify-between items-center mb-3"},Us={class:"flex items-center gap-4"},js={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Es={class:"md:col-span-2"},As={class:"flex items-center bg-gray-800 rounded p-3 mb-4 justify-between"},Is={class:"flex items-center gap-4"},xs={class:"flex items-center"},Ps={class:"flex items-center"},Hs={class:"flex items-center bg-gray-800 rounded p-3 mb-4 justify-between"},Ls={class:"flex items-center gap-4"},Rs={class:"flex items-center"},Os={class:"flex items-center"},zs={class:"space-y-4"},Ns={class:"flex justify-between items-center mb-2"},Ws={class:"text-gray-300"},Bs={key:0},Fs={key:0,class:"space-y-2"},Ds={class:"flex gap-2"},Gs={class:"flex justify-end gap-2"},Ms={key:1},qs={key:0,class:"grid grid-cols-3 gap-2"},Ks=["src","onClick"],Js={key:1,class:"text-white break-words"},_s={key:3,class:"flex justify-end gap-2 mb-6"},Qs={key:5,class:"bg-gray-700 rounded-lg p-4 mb-6"},Ys={class:"space-y-4"},Xs={class:"flex gap-4"},Zs={class:"flex justify-between items-center"},ea={key:0},ta={key:1,class:"flex gap-2"},oa={class:"bg-gray-800 p-6 rounded-lg"},sa={class:"text-xl font-semibold text-white mb-4"},aa={class:"flex justify-between items-center"},na=de({__name:"StatusPanel",emits:["restore-success"],setup(e,{emit:u}){const c=M(!0),g=async()=>{try{const t=await(await fetch("/api/frontend/config",{credentials:"include"})).json();t.code===1&&typeof t.data.allowRegistration=="boolean"&&(c.value=t.data.allowRegistration)}catch{$().add({title:"获取注册配置失败",color:"red"})}};fe(g);const a=async()=>{try{const t=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let i={};t.code===1?i={...t.data,allowRegistration:c.value}:i={allowRegistration:c.value};const E=await(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).json();if(E.code===1)$().add({title:"保存成功",color:"green"});else throw new Error(E.msg||"保存失败")}catch{$().add({title:"保存失败",color:"red"})}},r=Fe(),{login:k,register:C}=eo(),T=M(""),V=se({checking:!1,hasUpdate:!1,latestVersion:""});let z=se({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:""});const U=async()=>{V.checking=!0;try{const t=await(await fetch("/api/version/check",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if(t.code===1){const{hasUpdate:i,lastUpdateTime:x}=t.data;V.hasUpdate=i,V.latestVersion=new Date(x).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),i?$().add({title:"发现版本",description:`最新版本发布于 ${V.latestVersion}`,color:"orange"}):$().add({title:"已是最新版本",description:"当前使用的是最新版本",color:"green"})}else throw new Error(t.msg||"检查更新失败")}catch(l){console.error("检查版本更新失败:",l),$().add({title:"检查更新失败",description:"请科学上网后重试",color:"red"})}finally{V.checking=!1}},p=async()=>{var l;if(!r.isLogin){$().add({title:"错误",description:"请先登录",color:"red"});return}try{const t=await fetch("/api/user/token/regenerate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),i=await t.json();if(!t.ok)throw new Error(i.msg||"Token生成请求失败");if(i.code===1&&((l=i.data)!=null&&l.token))T.value=i.data.token,$().add({title:"成功",description:"Token 已更新",color:"green"});else throw new Error(i.msg||"Token 生成失败")}catch(t){console.error("Token生成错误:",t),$().add({title:"错误",description:t.message||"Token 生成失败",color:"red"})}},o=async()=>{try{await navigator.clipboard.writeText(T.value),$().add({title:"成功",description:"Token 已复制到剪贴板",color:"green"})}catch{$().add({title:"错误",description:"复制失败",color:"red"})}},j=async()=>{try{if(!(await fetch("/api/user/logout",{method:"POST",credentials:"include"})).ok)throw new Error("退出请求失败");r.$reset(),window.location.reload(),$().add({title:"成功",description:"已退出登录",color:"green"})}catch{$().add({title:"错误",description:"退出登录失败",color:"red"})}},y=H(()=>(r==null?void 0:r.isLogin)??!1),S=H(()=>{var l;return((l=r.user)==null?void 0:l.is_admin)??!1}),F=M(!0),D=M(!1),d=M(!1),_=M(null),L=se({username:"",oldPassword:"",newPassword:""}),R=se({username:!1,password:!1}),ne=async()=>{try{if(!L.username.trim())throw new Error("用户名不能为空");const t=await(await fetch("/api/user/update",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:L.username,type:"username"})})).json();if(t.code===1)await r.getUser(),R.username=!1,L.username="",$().add({title:"成功",description:"用户名已更新",color:"green"});else throw new Error(t.msg)}catch(l){$().add({title:"错误",description:l.message||"更新失败",color:"red"})}},Ve=async()=>{try{if(!L.newPassword||!L.oldPassword)throw new Error("密码不能为空");if(L.newPassword===L.oldPassword)throw new Error("新密码不能与当前密码相同");const t=await(await fetch("/api/user/change_password",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:L.newPassword,oldPassword:L.oldPassword})})).json();if(t.code===1)R.password=!1,L.oldPassword="",L.newPassword="",$().add({title:"成功",description:"密码已更新",color:"green"});else throw new Error(t.msg)}catch(l){$().add({title:"错误",description:l.message||"更新失败",color:"red"})}},we={siteTitle:"站点标题",subtitleText:"欢迎语",avatarURL:"头像链接",username:"用户名",description:"个人描述",backgrounds:"背景图片",cardFooterTitle:"卡片页脚标题",cardFooterLink:"卡片页脚链接",pageFooterHTML:"页面底部HTML",rssTitle:"RSS 标题",rssDescription:"RSS 描述",rssAuthorName:"RSS 作者",rssFaviconURL:"RSS 图标链接",walineServerURL:"Waline 评论服务器地址"},w=se({siteTitle:"",subtitleText:"",avatarURL:"",username:"",description:"",backgrounds:[],cardFooterTitle:"",cardFooterLink:"",pageFooterHTML:"",rssTitle:"",rssDescription:"",rssAuthorName:"",rssFaviconURL:"",walineServerURL:"",enableGithubCard:!1,pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"dark"}),Q=H({get:()=>w.enableGithubCard===!0,set:l=>{const t=l===!0||l==="true"||l===1||l==="1";w.enableGithubCard=t}}),oe=se({username:"",password:""}),Y=se({siteTitle:!1,subtitleText:!1,avatarURL:!1,username:!1,description:!1,backgrounds:!1,cardFooterTitle:!1,cardFooterLink:!1,pageFooterHTML:!1,rssTitle:!1,rssDescription:!1,rssAuthorName:!1,rssFaviconURL:!1,walineServerURL:!1}),I={siteTitle:"Noise的说说笔记",subtitleText:"欢迎访问，点击头像可更换封面背景！",avatarURL:"https://s2.loli.net/2025/03/24/HnSXKvibAQlosIW.png",username:"Noise",description:"执迷不悟",backgrounds:["https://s2.loli.net/2025/03/27/KJ1trnU2ksbFEYM.jpg","https://s2.loli.net/2025/03/27/MZqaLczCvwjSmW7.jpg","https://s2.loli.net/2025/03/27/UMijKXwJ9yTqSeE.jpg","https://s2.loli.net/2025/03/27/WJQIlkXvBg2afcR.jpg","https://s2.loli.net/2025/03/27/oHNQtf4spkq2iln.jpg","https://s2.loli.net/2025/03/27/PMRuX5loc6Uaimw.jpg","https://s2.loli.net/2025/03/27/U2WIslbNyTLt4rD.jpg","https://s2.loli.net/2025/03/27/xu1jZL5Og4pqT9d.jpg","https://s2.loli.net/2025/03/27/OXqwzZ6v3PVIns9.jpg","https://s2.loli.net/2025/03/27/HGuqlE6apgNywbh.jpg","https://s2.loli.net/2025/03/26/d7iyuPYA8cRqD1K.jpg","https://s2.loli.net/2025/03/27/wYy12qDMH6bGJOI.jpg","https://s2.loli.net/2025/03/27/y67m2k5xcSdTsHN.jpg"],cardFooterTitle:"Noise·说说·笔记~",cardFooterLink:"note.noisework.cn",pageFooterHTML:'<div class="text-center text-xs text-gray-400 py-4">来自<a href="https://www.noisework.cn" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Noise</a> 使用<a href="https://github.com/rcy1314/echo-noise" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Ech0-Noise</a>发布</div>',rssTitle:"Noise的说说笔记",rssDescription:"一个说说笔记~",rssAuthorName:"Noise",rssFaviconURL:"/favicon.ico",walineServerURL:"请前往waline官网https://waline.js.org查看部署配置",pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"dark"},le=l=>{w[l]=I[l],Y[l]=!1},X=async()=>{var l;try{const i=await(await fetch("/api/frontend/config",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if((l=i==null?void 0:i.data)!=null&&l.frontendSettings){const x=i.data.frontendSettings,E=["enableGithubCard","pwaEnabled"];if(Object.keys(w).forEach(W=>{if(W==="backgrounds"){const K=x[W];Array.isArray(K)&&(w[W]=[...K])}else if(E.includes(W)){const K=x[W]??I[W];w[W]=K===!0||K==="true"}else{const K=x[W]??I[W];w[W]=typeof K=="string"?K.trim():K}}),x.enableGithubCard!==void 0){const W=x.enableGithubCard;w.enableGithubCard=W===!0||W==="true"}const N=(w.pwaTitle||w.siteTitle||"说说笔记").trim(),q=(w.pwaIconURL||w.rssFaviconURL||"/favicon.ico").trim(),ue=(w.pwaDescription||w.description||"").trim();vt({title:N,meta:[{name:"description",content:ue},{name:"theme-color",content:"#000000"}],link:[{rel:"manifest",href:"/manifest.webmanifest"},{rel:"icon",href:q}]})}}catch(t){console.error("获取配置失败:",t)}},be=async l=>{try{if(l==="backgrounds"){const E=w.backgrounds.filter(N=>N&&N.trim()!=="");w.backgrounds=E}const i=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:w})});if(!i.ok){const E=await i.json();throw new Error(E.msg||"请求失败")}const x=await i.json();if(x.code===1){Y[l]=!1,await X();const E=l==="defaultContentTheme"?"默认主题色":we[l]||(l==="pwa"?"PWA 设置":l);if($().add({title:"成功",description:`${E}已更新`,color:"green"}),l==="defaultContentTheme"){const N=(w.defaultContentTheme||"dark").trim()}}else throw new Error(x.msg||"保存失败")}catch(t){console.error("保存配置失败:",t);const i=l==="defaultContentTheme"?"默认主题色":we[l]||l;$().add({title:"失败",description:`${i}保存失败`,color:"red"})}},Je=async()=>{try{const t=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:w})}),i=await t.json();if(t.ok&&i.code===1){if(await X(),$().add({title:"成功",description:"PWA 设置已更新",color:"green"}),"serviceWorker"in navigator){const x=await navigator.serviceWorker.getRegistrations();if(w.pwaEnabled)await navigator.serviceWorker.register("/sw.js");else{for(const N of x)await N.unregister();const E=await caches.keys();await Promise.all(E.map(N=>caches.delete(N)))}}window.dispatchEvent(new Event("frontend-config-updated"))}else throw new Error(i.msg||"保存失败")}catch(l){$().add({title:"错误",description:l.message||"保存失败",color:"red"})}},_e=async()=>{try{const l={frontendSettings:{enableGithubCard:!!Q.value}},t=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),i=await t.json();if(t.ok&&i.code===1)w.enableGithubCard=!!Q.value,await X(),window.dispatchEvent(new Event("frontend-config-updated")),$().add({title:"成功",description:"GitHub 解析设置已保存",color:"green"});else throw new Error(i.msg||"保存失败")}catch(l){$().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Qe=async l=>{const t=l.target.files;if(!t)return;const i=["image/jpeg","image/png","image/webp"];for(const x of Array.from(t))try{if(!i.includes(x.type))throw new Error("仅支持 JPG/PNG/WEBP 格式");const E=new FormData;E.append("image",x);const N=await fetch("/api/images/upload",{method:"POST",credentials:"include",body:E}),q=await N.json();if(!N.ok||q.code!==1)throw new Error(q.msg||"上传失败");if(q.code===1&&q.data){const ue=q.data.startsWith("http")?q.data:`/api${q.data}`,W=[...w.backgrounds,ue];w.backgrounds=W,await be("backgrounds"),$().add({title:"上传成功",description:`${x.name} 已添加到背景图片列表`,color:"green"})}}catch(E){$().add({title:"上传失败",description:E.message||"文件上传失败",color:"red"})}_.value&&(_.value.value="")};fe(()=>{window.addEventListener("frontend-config-updated",l=>{const{key:t,value:i}=l.detail;t&&i!==void 0&&(w[t]=i)})});const Ye=()=>{X(),d.value=!1},Xe=async()=>{w.backgrounds.push("")},Ze=async l=>{w.backgrounds.splice(l,1),await be("backgrounds")},et=()=>{var l;(l=_.value)==null||l.click()},tt=l=>{window.open(l,"_blank")};De(()=>r.isLogin,l=>{l||(r.getStatus(),r.getUser(),r.$reset())});const Ie=M(!1);fe(async()=>{var l;try{if(Ie.value=!0,await Promise.all([r.getStatus(),r.getUser(),X(),g()]),r.isLogin){const i=await(await fetch("/api/user/token",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();i.code===1&&((l=i.data)!=null&&l.token)&&(T.value=i.data.token)}}catch(t){console.error("初始化失败:",t),$().add({title:"系统提示",description:"当前未登录",color:"red",timeout:3e3})}finally{Ie.value=!1}});const ye=M(null),ot=async()=>{try{const l=await fetch("/api/backup/download",{credentials:"include"});if(!l.ok)throw new Error("下载失败");const t=await l.blob(),i=window.URL.createObjectURL(t),x=document.createElement("a");x.href=i,x.download=`noise_backup_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(i),document.body.removeChild(x)}catch(l){$().add({title:"错误",description:l.message||"备份下载失败",color:"red"})}},st=()=>{var l;(l=ye.value)==null||l.click()},at=u,nt=async l=>{const t=l.target.files;if(!(!t||!t[0])){try{const i=new FormData;i.append("database",t[0]);const E=await(await fetch("/api/backup/restore",{method:"POST",credentials:"include",body:i})).json();if(E.code===1)$().add({title:"成功",description:"数据库恢复成功",color:"green"}),at("restore-success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(E.msg)}catch(i){$().add({title:"错误",description:i.message||"数据库恢复失败",color:"red"})}ye.value&&(ye.value.value="")}};return(l,t)=>{var xe,Pe,He,Le,Re,Oe;const i=Ge,x=Ae,E=qe,N=It,q=ht,ue=Ke,W=Lt,K=Zt,lt=kt;return f(),m(G,null,[s("div",Do,[s("div",Go,[s("div",Mo,[t[66]||(t[66]=s("h1",{class:"text-3xl font-bold text-center text-white mb-8"},"系统管理面板",-1)),s("div",qo,[t[25]||(t[25]=s("span",{class:"text-gray-300"},"当前版本: latest",-1)),n(i,{size:"xs",color:"gray",variant:"ghost",loading:V.checking,onClick:U},{default:b(()=>[v(A(V.checking?"检测中...":"检查版本发布时间"),1)]),_:1},8,["loading"])]),V.hasUpdate?(f(),m("div",Ko,[s("div",Jo,[n(x,{name:"i-heroicons-arrow-up-circle",class:"w-5 h-5"}),s("span",null,"发现版本最近更新（于 "+A(V.latestVersion)+"）",1),t[26]||(t[26]=s("a",{href:"https://hub.docker.com/r/noise233/echo-noise/tags",target:"_blank",class:"text-blue-400 hover:text-blue-300 ml-2"}," 查看详情 ",-1))])])):O("",!0),s("div",_o,[t[30]||(t[30]=s("h2",{class:"text-xl font-semibold text-white mb-4"},"系统状态",-1)),s("div",Qo,[s("div",Yo,[t[27]||(t[27]=s("span",{class:"text-gray-300"},"系统管理员",-1)),s("span",Xo,A((Pe=(xe=re(r))==null?void 0:xe.status)==null?void 0:Pe.username),1)]),s("div",Zo,[t[28]||(t[28]=s("span",{class:"text-gray-300"},"当前用户",-1)),s("span",es,A(y.value?(He=re(r).user)==null?void 0:He.username:"未登录"),1)]),s("div",ts,[t[29]||(t[29]=s("span",{class:"text-gray-300"},"笔记总数",-1)),s("span",os,A((Re=(Le=re(r))==null?void 0:Le.status)==null?void 0:Re.total_messages)+" 条",1)])])]),y.value?(f(),m("div",ss,[t[39]||(t[39]=s("h2",{class:"text-xl font-semibold text-white mb-4"},"用户信息配置",-1)),s("div",as,[s("div",ns,[s("div",ls,[t[31]||(t[31]=s("span",{class:"text-gray-300"},"用户名",-1)),n(i,{size:"sm",onClick:t[0]||(t[0]=h=>R.username=!R.username),color:R.username?"gray":"green",variant:R.username?"soft":"solid"},{default:b(()=>[v(A(R.username?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),R.username?(f(),m("div",rs,[n(E,{modelValue:L.username,"onUpdate:modelValue":t[1]||(t[1]=h=>L.username=h),placeholder:"新用户名",class:"w-full mb-2"},null,8,["modelValue"]),s("div",is,[n(i,{onClick:ne,color:"primary"},{default:b(()=>t[32]||(t[32]=[v(" 保存 ")])),_:1})])])):(f(),m("div",ds,[s("p",us,A((Oe=re(r).user)==null?void 0:Oe.username),1)]))]),s("div",cs,[s("div",ps,[t[34]||(t[34]=s("span",{class:"text-gray-300"},"API Token",-1)),n(i,{size:"sm",onClick:p,color:"primary",variant:"soft"},{default:b(()=>t[33]||(t[33]=[v(" 重新生成 ")])),_:1})]),T.value?(f(),m("div",fs,[s("div",ms,[n(E,{modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=h=>T.value=h),readonly:"",class:"font-mono text-sm"},null,8,["modelValue"]),n(i,{icon:"i-heroicons-clipboard",color:"gray",variant:"ghost",onClick:o})]),t[35]||(t[35]=s("p",{class:"text-xs text-gray-400 mt-1"},"请妥善保管此 Token，它用于 API 访问认证",-1))])):(f(),m("div",gs,t[36]||(t[36]=[s("p",{class:"text-gray-400"},"暂无 Token",-1)])))]),s("div",ws,[s("div",vs,[t[37]||(t[37]=s("span",{class:"text-gray-300"},"修改密码",-1)),n(i,{size:"sm",onClick:t[3]||(t[3]=h=>R.password=!R.password),color:R.password?"gray":"green",variant:R.password?"soft":"solid"},{default:b(()=>[v(A(R.password?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),R.password?(f(),m("div",bs,[n(E,{modelValue:L.oldPassword,"onUpdate:modelValue":t[4]||(t[4]=h=>L.oldPassword=h),type:"password",placeholder:"当前密码",class:"w-full mb-2"},null,8,["modelValue"]),n(E,{modelValue:L.newPassword,"onUpdate:modelValue":t[5]||(t[5]=h=>L.newPassword=h),type:"password",placeholder:"新密码",class:"w-full mb-2"},null,8,["modelValue"]),s("div",ys,[n(i,{onClick:Ve,color:"primary"},{default:b(()=>t[38]||(t[38]=[v(" 保存 ")])),_:1})])])):O("",!0)])])])):O("",!0),S.value?(f(),m("div",hs,[t[55]||(t[55]=s("div",{class:"flex justify-between items-center mb-4"},[s("h2",{class:"text-xl font-semibold text-white"},"网站配置")],-1)),s("div",ks,[t[41]||(t[41]=s("span",{class:"text-white"},"新用户注册",-1)),s("div",Cs,[s("div",Vs,[n(N,{modelValue:c.value,"onUpdate:modelValue":t[6]||(t[6]=h=>c.value=h),value:!0,class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(c.value?"text-white":"text-gray-400")},"允许",2)]),s("div",$s,[n(N,{modelValue:c.value,"onUpdate:modelValue":t[7]||(t[7]=h=>c.value=h),value:!1,class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(c.value?"text-gray-400":"text-white")},"不允许",2)]),n(i,{color:"green",onClick:a},{default:b(()=>t[40]||(t[40]=[v("保存")])),_:1})])]),s("div",Ts,[s("div",Ss,[t[43]||(t[43]=s("span",{class:"text-white"},"PWA 模式",-1)),s("div",Us,[n(q,{modelValue:w.pwaEnabled,"onUpdate:modelValue":t[8]||(t[8]=h=>w.pwaEnabled=h)},null,8,["modelValue"]),n(i,{color:"green",onClick:Je},{default:b(()=>t[42]||(t[42]=[v("保存")])),_:1})])]),s("div",js,[s("div",null,[t[44]||(t[44]=s("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 标题",-1)),n(E,{modelValue:w.pwaTitle,"onUpdate:modelValue":t[9]||(t[9]=h=>w.pwaTitle=h),placeholder:w.siteTitle||"说说笔记"},null,8,["modelValue","placeholder"])]),s("div",null,[t[45]||(t[45]=s("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 图标",-1)),n(E,{"model-value":"/favicon.ico",disabled:""})]),s("div",Es,[t[46]||(t[46]=s("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 描述",-1)),n(ue,{modelValue:w.pwaDescription,"onUpdate:modelValue":t[10]||(t[10]=h=>w.pwaDescription=h),placeholder:w.description||""},null,8,["modelValue","placeholder"])])])]),s("div",As,[t[48]||(t[48]=s("span",{class:"text-white"},"GitHub 链接卡片解析",-1)),s("div",Is,[s("div",xs,[n(N,{modelValue:Q.value,"onUpdate:modelValue":t[11]||(t[11]=h=>Q.value=h),value:!0,class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(Q.value?"text-white":"text-gray-400")},"开启",2)]),s("div",Ps,[n(N,{modelValue:Q.value,"onUpdate:modelValue":t[12]||(t[12]=h=>Q.value=h),value:!1,class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(Q.value?"text-gray-400":"text-white")},"关闭",2)]),n(i,{color:"green",onClick:_e},{default:b(()=>t[47]||(t[47]=[v("保存")])),_:1})])]),s("div",Hs,[t[50]||(t[50]=s("span",{class:"text-white"},"默认主题色",-1)),s("div",Ls,[s("div",Rs,[n(N,{modelValue:w.defaultContentTheme,"onUpdate:modelValue":t[13]||(t[13]=h=>w.defaultContentTheme=h),value:"dark",class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(w.defaultContentTheme==="dark"?"text-white":"text-gray-400")},"暗黑",2)]),s("div",Os,[n(N,{modelValue:w.defaultContentTheme,"onUpdate:modelValue":t[14]||(t[14]=h=>w.defaultContentTheme=h),value:"light",class:"mr-2"},null,8,["modelValue"]),s("span",{class:P(w.defaultContentTheme==="light"?"text-white":"text-gray-400")},"白天",2)]),n(i,{color:"green",onClick:t[15]||(t[15]=h=>be("defaultContentTheme"))},{default:b(()=>t[49]||(t[49]=[v("保存")])),_:1})])]),s("div",zs,[(f(),m(G,null,me(we,(h,B)=>s("div",{key:B,class:"bg-gray-800 rounded p-3"},[s("div",Ns,[s("span",Ws,A(h),1),n(i,{size:"sm",onClick:Z=>Y[B]=!Y[B],color:Y[B]?"gray":"green",variant:Y[B]?"soft":"solid"},{default:b(()=>[v(A(Y[B]?"取消":"编辑"),1)]),_:2},1032,["onClick","color","variant"])]),Y[B]?(f(),m("div",Bs,[B==="backgrounds"?(f(),m("div",Fs,[(f(!0),m(G,null,me(w.backgrounds,(Z,ce)=>(f(),m("div",{key:ce,class:"flex gap-2"},[n(E,{modelValue:w.backgrounds[ce],"onUpdate:modelValue":$e=>w.backgrounds[ce]=$e,placeholder:"输入图片URL",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(i,{onClick:$e=>Ze(ce),icon:"i-heroicons-trash",color:"red",variant:"ghost"},null,8,["onClick"])]))),128)),s("div",Ds,[n(i,{onClick:Xe,icon:"i-heroicons-plus",variant:"ghost",class:"mr-2"},{default:b(()=>t[51]||(t[51]=[v(" 添加链接 ")])),_:1}),n(i,{onClick:et,icon:"i-heroicons-cloud-arrow-up",variant:"ghost"},{default:b(()=>t[52]||(t[52]=[v(" 上传图片 ")])),_:1})])])):B==="subtitleText"?(f(),ke(ue,{key:1,modelValue:w[B],"onUpdate:modelValue":Z=>w[B]=Z,placeholder:`输入${h}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(f(),ke(E,{key:2,modelValue:w[B],"onUpdate:modelValue":Z=>w[B]=Z,placeholder:`输入${h}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),s("div",Gs,[n(i,{onClick:Z=>le(B),variant:"ghost",color:"gray"},{default:b(()=>t[53]||(t[53]=[v(" 重置 ")])),_:2},1032,["onClick"]),n(i,{onClick:Z=>be(B),color:"primary"},{default:b(()=>t[54]||(t[54]=[v(" 保存 ")])),_:2},1032,["onClick"])])])):(f(),m("div",Ms,[B==="backgrounds"?(f(),m("div",qs,[(f(!0),m(G,null,me(w.backgrounds,(Z,ce)=>(f(),m("img",{key:ce,src:Z,class:"w-full h-20 object-cover rounded cursor-pointer",onClick:$e=>tt(Z)},null,8,Ks))),128))])):(f(),m("p",Js,A(w[B]),1))]))])),64))])])):O("",!0),d.value?(f(),m("div",_s,[n(i,{onClick:Ye,variant:"ghost",color:"gray"},{default:b(()=>t[56]||(t[56]=[v(" 重置 ")])),_:1}),n(i,{onClick:l.saveConfig,color:"primary"},{default:b(()=>t[57]||(t[57]=[v(" 保存所有更改 ")])),_:1},8,["onClick"])])):O("",!0),S.value?(f(),ke(Fo,{key:4,config:re(z),"onUpdate:config":t[16]||(t[16]=h=>wt(z)?z.value=h:z=h),immediate:!0},null,8,["config"])):O("",!0),S.value?(f(),m("div",Qs,[t[61]||(t[61]=s("h2",{class:"text-xl font-semibold text-white mb-4"},"数据库管理",-1)),s("div",Ys,[s("div",Xs,[n(i,{color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:ot},{default:b(()=>t[58]||(t[58]=[v(" 下载备份 ")])),_:1}),n(i,{color:"warning",variant:"solid",icon:"i-heroicons-arrow-up-tray",onClick:st},{default:b(()=>t[59]||(t[59]=[v(" 恢复数据库 ")])),_:1})]),t[60]||(t[60]=s("div",{class:"text-yellow-400 text-sm max-h-16 overflow-y-auto bg-gray-800/50 rounded p-2"}," 🔔：SQLite一键备份恢复，因兼容问题，不支持云端的PostgreSQL/MySQL数据库，如有使用云端数据库，请前往云服务端来备份和恢复 ",-1)),s("input",{type:"file",ref_key:"databaseFileInput",ref:ye,accept:".zip",class:"hidden",onChange:nt},null,544)])])):O("",!0),s("div",Zs,[n(i,{icon:"i-heroicons-arrow-left",variant:"ghost",color:"white",onClick:t[17]||(t[17]=h=>l.$router.push("/")),class:"text-white hover:text-black"},{default:b(()=>t[62]||(t[62]=[v(" 返回首页 ")])),_:1}),y.value?(f(),m("div",ea,[n(i,{icon:"i-heroicons-power",color:"red",variant:"ghost",onClick:j},{default:b(()=>t[63]||(t[63]=[v(" 退出登录 ")])),_:1})])):(f(),m("div",ta,[n(i,{color:"primary",onClick:t[18]||(t[18]=h=>{D.value=!0,F.value=!0})},{default:b(()=>t[64]||(t[64]=[v(" 登录 ")])),_:1}),n(i,{color:"secondary",onClick:t[19]||(t[19]=h=>{D.value=!0,F.value=!1})},{default:b(()=>t[65]||(t[65]=[v(" 注册 ")])),_:1})]))])])])]),n(lt,{modelValue:D.value,"onUpdate:modelValue":t[24]||(t[24]=h=>D.value=h)},{default:b(()=>[s("div",oa,[s("h3",sa,A(F.value?"用户登录":"用户注册"),1),n(K,{state:oe,class:"space-y-4"},{default:b(()=>[n(W,null,{default:b(()=>[n(E,{modelValue:oe.username,"onUpdate:modelValue":t[20]||(t[20]=h=>oe.username=h),placeholder:"用户名",class:"w-full"},null,8,["modelValue"])]),_:1}),n(W,null,{default:b(()=>[n(E,{modelValue:oe.password,"onUpdate:modelValue":t[21]||(t[21]=h=>oe.password=h),type:"password",placeholder:"密码",class:"w-full"},null,8,["modelValue"])]),_:1}),s("div",aa,[n(i,{variant:"ghost",onClick:t[22]||(t[22]=h=>F.value=!F.value)},{default:b(()=>[v(A(F.value?"去注册":"去登录"),1)]),_:1}),n(i,{color:"primary",onClick:t[23]||(t[23]=h=>F.value?re(k)(oe):re(C)(oe))},{default:b(()=>[v(A(F.value?"登录":"注册"),1)]),_:1})])]),_:1},8,["state"])])]),_:1},8,["modelValue"]),s("input",{type:"file",ref_key:"fileInput",ref:_,accept:"image/*",multiple:"",class:"hidden",onChange:Qe},null,544)],64)}}}),la=ve(na,[["__scopeId","data-v-81289724"]]),da=de({__name:"status",setup(e){const u=()=>{$().add({title:"恢复成功",description:"数据已恢复，页面即将刷新",color:"green",timeout:2e3}),setTimeout(()=>{window.location.reload()},2e3)};return(c,g)=>{const a=bt,r=Ct;return f(),ke(r,null,{default:b(()=>[n(a,{class:"flex justify-center items-center h-screen"},{default:b(()=>[n(la,{onRestoreSuccess:u})]),_:1}),n(Vt)]),_:1})}}});export{da as default};
