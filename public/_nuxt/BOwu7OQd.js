import{M as Te,N as ee,L as we,A as de,O as je,t as ge,ac as Ee,a0 as Ne,i as H,ad as We,P as pe,D as m,E as f,H as a,R,a7 as lt,ae as it,T as ae,V as L,Q as J,K as w,U as A,r as M,a4 as ye,S as ie,W as G,af as Be,B as fe,c as dt,ag as ut,Z as ct,a1 as Fe,n as $,ah as pt,ai as ft,$ as Ae,aj as mt,X as me,I as n,ak as ze,k as se,w as De,al as gt,G as b,_ as Ge,F as he,h as le,a6 as wt,a9 as bt,ab as vt}from"./CYpytnI3.js";import{u as Me,e as yt,_ as qe,d as Ke,b as ht,a as kt,c as Ct,N as Vt}from"./BigsygO6.js";const $t={wrapper:"",inner:"",label:{wrapper:"flex content-center items-center justify-between",base:"block font-medium text-gray-700 dark:text-gray-200",required:"after:content-['*'] after:ms-0.5 after:text-red-500 dark:after:text-red-400"},size:{"2xs":"text-xs",xs:"text-xs",sm:"text-sm",md:"text-sm",lg:"text-sm",xl:"text-base"},container:"mt-1 relative",description:"text-gray-500 dark:text-gray-400",hint:"text-gray-500 dark:text-gray-400",help:"mt-2 text-gray-500 dark:text-gray-400",error:"mt-2 text-red-500 dark:text-red-400",default:{size:"sm"}},St={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},Se=Te(ee.ui.strategy,ee.ui.radio,St),Ut=de({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>Se.default.color,validator(e){return ee.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:u}){const{ui:c,attrs:g}=je("radio",ge(e,"ui"),Se,ge(e,"class")),s=e.id??Ee(),r=Ne("radio-group",null),{emitFormChange:y,color:C,name:S}=r??Me(e,Se),V=H({get(){return e.modelValue},set(p){u("update:modelValue",p),r||y()}});function O(p){u("change",p.target.value)}const T=H(()=>We(pe(c.value.base,c.value.form,c.value.background,c.value.border,C.value&&c.value.ring.replaceAll("{color}",C.value),C.value&&c.value.color.replaceAll("{color}",C.value)),e.inputClass));return{inputId:s,ui:c,attrs:g,pick:V,name:S,inputClass:T,onChange:O}}}),Tt=["data-n-ids"],jt=["id","name","required","value","disabled"],Et=["for"];function At(e,u,c,g,s,r){return f(),m("div",{class:L(e.ui.wrapper),"data-n-ids":e.attrs["data-n-ids"]},[a("div",{class:L(e.ui.container)},[lt(a("input",ae({id:e.inputId,"onUpdate:modelValue":u[0]||(u[0]=y=>e.pick=y),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:e.inputClass},e.attrs,{onChange:u[1]||(u[1]=(...y)=>e.onChange&&e.onChange(...y))}),null,16,jt),[[it,e.pick]])],2),e.label||e.$slots.label?(f(),m("div",{key:0,class:L(e.ui.inner)},[a("label",{for:e.inputId,class:L(e.ui.label)},[J(e.$slots,"label",{label:e.label},()=>[w(A(e.label),1)]),e.required?(f(),m("span",{key:0,class:L(e.ui.required)},"*",2)):R("",!0)],10,Et),e.help||e.$slots.help?(f(),m("p",{key:0,class:L(e.ui.help)},[J(e.$slots,"help",{help:e.help},()=>[w(A(e.help),1)])],2)):R("",!0)],2)):R("",!0)],10,Tt)}const It=we(Ut,[["render",At]]),Ue=Te(ee.ui.strategy,ee.ui.formGroup,$t),Pt=de({inheritAttrs:!1,props:{name:{type:String,default:null},size:{type:String,default:null,validator(e){return Object.keys(Ue.size).includes(e)}},label:{type:String,default:null},description:{type:String,default:null},required:{type:Boolean,default:!1},help:{type:String,default:null},error:{type:[String,Boolean],default:null},hint:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},eagerValidation:{type:Boolean,default:!1}},setup(e){const{ui:u,attrs:c}=je("formGroup",ge(e,"ui"),Ue,ge(e,"class")),g=Ne("form-errors",null),s=H(()=>{var C,S;return e.error&&typeof e.error=="string"||typeof e.error=="boolean"?e.error:(S=(C=g==null?void 0:g.value)==null?void 0:C.find(V=>V.path===e.name))==null?void 0:S.message}),r=H(()=>u.value.size[e.size??Ue.default.size]),y=M(Ee());return ye("form-group",{error:s,inputId:y,name:H(()=>e.name),size:H(()=>e.size),eagerValidation:H(()=>e.eagerValidation)}),{ui:u,attrs:c,inputId:y,size:r,error:s}}}),Ht=["for"];function Lt(e,u,c,g,s,r){return f(),m("div",ae({class:e.ui.wrapper},e.attrs),[a("div",{class:L(e.ui.inner)},[e.label||e.$slots.label?(f(),m("div",{key:0,class:L([e.ui.label.wrapper,e.size])},[a("label",{for:e.inputId,class:L([e.ui.label.base,e.required?e.ui.label.required:""])},[e.$slots.label?J(e.$slots,"label",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[w(A(e.label),1)],64))],10,Ht),e.hint||e.$slots.hint?(f(),m("span",{key:0,class:L([e.ui.hint])},[e.$slots.hint?J(e.$slots,"hint",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[w(A(e.hint),1)],64))],2)):R("",!0)],2)):R("",!0),e.description||e.$slots.description?(f(),m("p",{key:1,class:L([e.ui.description,e.size])},[e.$slots.description?J(e.$slots,"description",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[w(A(e.description),1)],64))],2)):R("",!0)],2),a("div",{class:L([e.label?e.ui.container:""])},[J(e.$slots,"default",ie(Be({error:e.error}))),typeof e.error=="string"&&e.error?(f(),m("p",{key:0,class:L([e.ui.error,e.size])},[e.$slots.error?J(e.$slots,"error",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[w(A(e.error),1)],64))],2)):e.help||e.$slots.help?(f(),m("p",{key:1,class:L([e.ui.help,e.size])},[e.$slots.help?J(e.$slots,"help",ie(ae({key:0},{error:e.error,label:e.label,name:e.name,hint:e.hint,description:e.description,help:e.help}))):(f(),m(G,{key:1},[w(A(e.help),1)],64))],2)):R("",!0)],2)],16)}const xt=we(Pt,[["render",Lt]]);class ke extends Error{constructor(u){super(u),this.message=u,Object.setPrototypeOf(this,ke.prototype)}}const Rt=de({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:u,emit:c}){const g=Ee(),s=yt(`form-${g}`),r=M(null);fe(()=>{s.on(async T=>{var p;T.type!=="submit"&&((p=e.validateOn)!=null&&p.includes(T.type))&&await V(T.path,{silent:!0})})}),dt(()=>{s.reset()});const y=M([]);ye("form-errors",y),ye("form-events",s);const C=M({});ye("form-inputs",C);async function S(){let T=await e.validate(e.state);if(e.schema){const{errors:p,result:o}=await Yt(e.state,e.schema);p?T=T.concat(p):r.value=o}return T}async function V(T,p={silent:!1}){let o=T;if(T&&!Array.isArray(T)&&(o=[T]),o){const j=y.value.filter(U=>!o.includes(U.path)),v=(await S()).filter(U=>o.includes(U.path));y.value=j.concat(v)}else y.value=await S();if(y.value.length>0){if(p.silent)return!1;throw new ke(`Form validation failed: ${JSON.stringify(y.value,null,2)}`)}return e.state}async function O(T){var o;const p=T;try{(o=e.validateOn)!=null&&o.includes("submit")&&await V(),p.data=e.schema?r.value:e.state,c("submit",p)}catch(j){if(!(j instanceof ke))throw j;const v={...p,errors:y.value.map(U=>({...U,id:C.value[U.path]}))};c("error",v)}}return u({validate:V,errors:y,setErrors(T,p){p?y.value=y.value.filter(o=>o.path!==p).concat(T):y.value=T},async submit(){await O(new Event("submit"))},getErrors(T){return T?y.value.filter(p=>p.path===T):y.value},clear(T){T?y.value=y.value.filter(p=>p.path!==T):y.value=[]}}),{onSubmit:O,errors:ut(y)}}});function Ot(e){return e.validate&&e.__isYupSchema__}function zt(e){return e.inner!==void 0}function Nt(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function Wt(e){return e.validateAsync!==void 0&&e.id!==void 0}function Bt(e){return e.isJoi===!0}function Ft(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}function Dt(e){return e.parse!==void 0}function Gt(e){return"~standard"in e}async function Mt(e,u){const c=await u["~standard"].validate(e);return!c.issues||c.issues.length===0?{errors:null,result:"value"in c?c.value:null}:{errors:c.issues.map(s=>{var r;return{path:((r=s.path)==null?void 0:r.map(y=>typeof y=="object"?y.key:y).join("."))||"",message:s.message}}),result:null}}async function qt(e,u){const c=await("_parse"in u?u._parse(e):"_run"in u?u._run({typed:!1,value:e},{}):u(e));return!c.issues||c.issues.length===0?{errors:null,result:"output"in c?c.output:"value"in c?c.value:null}:{errors:c.issues.map(s=>{var r;return{path:((r=s.path)==null?void 0:r.map(y=>y.key).join("."))||"",message:s.message}}),result:null}}async function Kt(e,u){try{return{errors:null,result:await u.validateAsync(e,{abortEarly:!1})}}catch(c){if(Bt(c))return{errors:c.details.map(s=>({path:s.path.join("."),message:s.message})),result:null};throw c}}async function Jt(e,u){const c=await u.safeParseAsync(e);return c.success===!1?{errors:c.error.issues.map(s=>({path:s.path.join("."),message:s.message})),result:null}:{result:c.data,errors:null}}async function _t(e,u){const[c,g]=u.validate(e);return c?{errors:c.failures().map(r=>({message:r.message,path:r.path.join(".")})),result:null}:{errors:null,result:g}}async function Qt(e,u){try{return{errors:null,result:await u.validate(e,{abortEarly:!1})}}catch(c){if(zt(c))return{errors:c.inner.map(s=>({path:s.path??"",message:s.message})),result:null};throw c}}function Yt(e,u){if(Gt(u))return Mt(e,u);if(Dt(u))return Jt(e,u);if(Wt(u))return Kt(e,u);if(Ft(u))return qt(e,u);if(Ot(u))return Qt(e,u);if(Nt(u))return _t(e,u);throw new Error("Form validation failed: Unsupported form schema")}function Xt(e,u,c,g,s,r){return f(),m("form",{onSubmit:u[0]||(u[0]=ct((...y)=>e.onSubmit&&e.onSubmit(...y),["prevent"]))},[J(e.$slots,"default",ie(Be({errors:e.errors})))],32)}const Zt=we(Rt,[["render",Xt]]),eo=()=>{const e=Fe(),u=$(),c=pt(),g=async()=>{const S=await e.getStatus();return S&&e.setUserStatus(S),S},s=async S=>{await e.register(S)&&u.add({title:"注册成功",description:"欢迎使用！请登录",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3})},r=async S=>{await e.login(S)&&(await g(),u.add({title:"登录成功",description:"欢迎回来！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),c.push("/"))},y=async()=>{await e.logout(),e.clearUserStatus(),u.add({title:"注销成功",description:"欢迎再次使用！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),c.push("/")},C=async()=>await g();return fe(async()=>{await g()}),{register:s,login:r,logout:y,getStatus:C}},Z=Te(ee.ui.strategy,ee.ui.select,ft),to=de({components:{UIcon:Ae},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>Z.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>Z.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(e){return Object.keys(Z.size).includes(e)}},color:{type:String,default:()=>Z.default.color,validator(e){return[...ee.ui.colors,...Object.keys(Z.color)].includes(e)}},variant:{type:String,default:()=>Z.default.variant,validator(e){return[...Object.keys(Z.variant),...Object.values(Z.color).flatMap(u=>Object.keys(u))].includes(e)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:u,slots:c}){const{ui:g,attrs:s}=je("select",ge(e,"ui"),Z,ge(e,"class")),{size:r,rounded:y}=mt({ui:g,props:e}),{emitFormChange:C,inputId:S,color:V,size:O,name:T}=Me(e,Z),p=H(()=>r.value??O.value),o=I=>{u("update:modelValue",I.target.value)},j=I=>{u("change",I.target.value),C()},v=I=>ze(I,e.valueAttribute,""),U=I=>ze(I,e.optionAttribute,""),W=I=>["string","number","boolean"].includes(typeof I)?{[e.valueAttribute]:I,[e.optionAttribute]:I}:{...I,[e.valueAttribute]:v(I),[e.optionAttribute]:U(I)},D=H(()=>e.options.map(I=>W(I))),d=H(()=>e.placeholder?[{[e.valueAttribute]:"",[e.optionAttribute]:e.placeholder,disabled:!0},...D.value]:D.value),_=H(()=>{const I=W(e.modelValue),re=d.value.find(Y=>Y[e.valueAttribute]===I[e.valueAttribute]);return re?re[e.valueAttribute]:""}),x=H(()=>{var re,Y;const I=((Y=(re=g.value.color)==null?void 0:re[V.value])==null?void 0:Y[e.variant])||g.value.variant[e.variant];return We(pe(g.value.base,g.value.form,y.value,g.value.size[p.value],e.padded?g.value.padding[p.value]:"p-0",I==null?void 0:I.replaceAll("{color}",V.value),(z.value||c.leading)&&g.value.leading.padding[p.value],(ne.value||c.trailing)&&g.value.trailing.padding[p.value]),e.placeholder&&!e.modelValue&&g.value.placeholder,e.selectClass)}),z=H(()=>e.icon&&e.leading||e.icon&&!e.trailing||e.loading&&!e.trailing||e.leadingIcon),ne=H(()=>e.icon&&e.trailing||e.loading&&e.trailing||e.trailingIcon),Ce=H(()=>e.loading?e.loadingIcon:e.leadingIcon||e.icon),be=H(()=>e.loading&&!z.value?e.loadingIcon:e.trailingIcon||e.icon),h=H(()=>pe(g.value.icon.leading.wrapper,g.value.icon.leading.pointer,g.value.icon.leading.padding[p.value])),Q=H(()=>pe(g.value.icon.base,V.value&&ee.ui.colors.includes(V.value)&&g.value.icon.color.replaceAll("{color}",V.value),g.value.icon.size[p.value],e.loading&&g.value.icon.loading)),te=H(()=>pe(g.value.icon.trailing.wrapper,g.value.icon.trailing.pointer,g.value.icon.trailing.padding[p.value])),oe=H(()=>pe(g.value.icon.base,V.value&&ee.ui.colors.includes(V.value)&&g.value.icon.color.replaceAll("{color}",V.value),g.value.icon.size[p.value],e.loading&&!z.value&&g.value.icon.loading));return{ui:g,attrs:s,name:T,inputId:S,normalizedOptionsWithPlaceholder:d,normalizedValue:_,isLeading:z,isTrailing:ne,selectClass:x,leadingIconName:Ce,leadingIconClass:Q,leadingWrapperIconClass:h,trailingIconName:be,trailingIconClass:oe,trailingWrapperIconClass:te,onInput:o,onChange:j}}}),oo=["id","name","value","required","disabled"],so=["value","label"],ao=["value","selected","disabled","textContent"],no=["value","selected","disabled","textContent"];function ro(e,u,c,g,s,r){const y=Ae;return f(),m("div",{class:L(e.ui.wrapper)},[a("select",ae({id:e.inputId,name:e.name,value:e.modelValue,required:e.required,disabled:e.disabled,class:e.selectClass},e.attrs,{onInput:u[0]||(u[0]=(...C)=>e.onInput&&e.onInput(...C)),onChange:u[1]||(u[1]=(...C)=>e.onChange&&e.onChange(...C))}),[(f(!0),m(G,null,me(e.normalizedOptionsWithPlaceholder,(C,S)=>(f(),m(G,null,[C.children?(f(),m("optgroup",{key:`${C[e.valueAttribute]}-optgroup-${S}`,value:C[e.valueAttribute],label:C[e.optionAttribute]},[(f(!0),m(G,null,me(C.children,(V,O)=>(f(),m("option",{key:`${V[e.valueAttribute]}-${S}-${O}`,value:V[e.valueAttribute],selected:V[e.valueAttribute]===e.normalizedValue,disabled:V.disabled,textContent:A(V[e.optionAttribute])},null,8,ao))),128))],8,so)):(f(),m("option",{key:`${C[e.valueAttribute]}-${S}`,value:C[e.valueAttribute],selected:C[e.valueAttribute]===e.normalizedValue,disabled:C.disabled,textContent:A(C[e.optionAttribute])},null,8,no))],64))),256))],16,oo),e.isLeading&&e.leadingIconName||e.$slots.leading?(f(),m("span",{key:0,class:L(e.leadingWrapperIconClass)},[J(e.$slots,"leading",{disabled:e.disabled,loading:e.loading},()=>[n(y,{name:e.leadingIconName,class:L(e.leadingIconClass)},null,8,["name","class"])],!0)],2)):R("",!0),e.isTrailing&&e.trailingIconName||e.$slots.trailing?(f(),m("span",{key:1,class:L(e.trailingWrapperIconClass)},[J(e.$slots,"trailing",{disabled:e.disabled,loading:e.loading},()=>[n(y,{name:e.trailingIconName,class:L(e.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):R("",!0)],2)}const lo=we(to,[["render",ro],["__scopeId","data-v-db8f1118"]]),io={class:"bg-gray-700 rounded-lg p-4 mb-6"},uo={class:"space-y-4"},co={class:"bg-gray-800 rounded p-3"},po={class:"flex justify-between items-center mb-2"},fo={class:"flex items-center gap-2"},mo={key:0,class:"space-y-2"},go={class:"flex justify-end gap-2"},wo={class:"bg-gray-800 rounded p-3"},bo={class:"flex justify-between items-center mb-2"},vo={class:"flex items-center gap-2"},yo={key:0,class:"space-y-2"},ho={class:"flex justify-end gap-2"},ko={class:"bg-gray-800 rounded p-3"},Co={class:"flex justify-between items-center mb-2"},Vo={class:"flex items-center gap-2"},$o={key:0,class:"space-y-2"},So={class:"flex justify-end gap-2"},Uo={class:"bg-gray-800 rounded p-3"},To={class:"flex justify-between items-center mb-2"},jo={class:"flex items-center gap-2"},Eo={key:0,class:"space-y-2"},Ao={class:"flex justify-end gap-2"},Io={class:"bg-gray-800 rounded p-3"},Po={class:"flex justify-between items-center mb-2"},Ho={class:"flex items-center gap-2"},Lo={key:0,class:"space-y-2"},xo={class:"flex justify-end gap-2"},Ro={class:"bg-gray-800 rounded p-3"},Oo={class:"flex justify-between items-center mb-2"},zo={class:"flex items-center gap-2"},No={key:0,class:"space-y-2"},Wo={class:"flex justify-end gap-2"},Bo={class:"mt-4 flex flex-wrap gap-2"},Fo=de({__name:"NotifyPanel",props:{config:{},immediate:{type:Boolean}},emits:["save"],setup(e,{emit:u}){const c=u,g=e,s=se({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:"",twitterEnabled:!1,twitterApiKey:"",twitterApiSecret:"",twitterAccessToken:"",twitterAccessTokenSecret:"",customHttpEnabled:!1,customHttpUrl:"",customHttpMethod:"POST",customHttpHeaders:"",customHttpBody:'{"content":"{{content}}"}'}),r=se({webhook:!1,telegram:!1,wework:!1,feishu:!1,twitter:!1,customHttp:!1}),y=["webhook","telegram","wework","feishu","twitter","customHttp"],C=p=>({webhook:"Webhook",telegram:"Telegram",wework:"企业微信",feishu:"飞书",twitter:"Twitter",customHttp:"自定义HTTP"})[p]||p,S=p=>{const o=p.toLowerCase();Object.keys(s).forEach(j=>{j.toLowerCase().startsWith(o)&&(s[j]=g.config[j])}),r[p]=!1},V=p=>{var j,v,U,W,D,d,_,x,z,ne;const o=s;switch(p){case"webhook":return o.webhookEnabled&&!!((j=o.webhookURL)!=null&&j.trim());case"telegram":return o.telegramEnabled&&!!((v=o.telegramToken)!=null&&v.trim())&&!!((U=o.telegramChatID)!=null&&U.trim());case"wework":return o.weworkEnabled&&!!((W=o.weworkKey)!=null&&W.trim());case"feishu":return o.feishuEnabled&&!!((D=o.feishuWebhook)!=null&&D.trim());case"twitter":return o.twitterEnabled&&!!((d=o.twitterApiKey)!=null&&d.trim())&&!!((_=o.twitterApiSecret)!=null&&_.trim())&&!!((x=o.twitterAccessToken)!=null&&x.trim())&&!!((z=o.twitterAccessTokenSecret)!=null&&z.trim());case"customHttp":return o.customHttpEnabled&&!!((ne=o.customHttpUrl)!=null&&ne.trim());default:return!1}},O=async p=>{try{switch(p){case"webhook":if(s.webhookEnabled&&!s.webhookURL)throw new Error("Webhook URL不能为空");break;case"telegram":if(s.telegramEnabled&&(!s.telegramToken||!s.telegramChatID))throw new Error("Telegram配置不完整");break;case"wework":if(s.weworkEnabled&&!s.weworkKey)throw new Error("企业微信Key不能为空");break;case"feishu":if(s.feishuEnabled&&!s.feishuWebhook)throw new Error("飞书Webhook不能为空");break;case"twitter":if(s.twitterEnabled&&(!s.twitterApiKey||!s.twitterApiSecret||!s.twitterAccessToken||!s.twitterAccessTokenSecret))throw new Error("Twitter配置不完整");break;case"customHttp":if(s.customHttpEnabled&&!s.customHttpUrl)throw new Error("自定义HTTP URL不能为空");break}const o={webhookEnabled:s.webhookEnabled,webhookURL:s.webhookURL,telegramEnabled:s.telegramEnabled,telegramToken:s.telegramToken,telegramChatID:s.telegramChatID,weworkEnabled:s.weworkEnabled,weworkKey:s.weworkKey,feishuEnabled:s.feishuEnabled,feishuWebhook:s.feishuWebhook,feishuSecret:s.feishuSecret,twitterEnabled:s.twitterEnabled,twitterApiKey:s.twitterApiKey,twitterApiSecret:s.twitterApiSecret,twitterAccessToken:s.twitterAccessToken,twitterAccessTokenSecret:s.twitterAccessTokenSecret,customHttpEnabled:s.customHttpEnabled,customHttpUrl:s.customHttpUrl,customHttpMethod:s.customHttpMethod,customHttpHeaders:s.customHttpHeaders,customHttpBody:s.customHttpBody},v=await(await fetch("/api/notify/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)})).json();if(v.code===1)r[p]=!1,v.data&&Object.keys(v.data).forEach(U=>{U.endsWith("Enabled")?s[U]=!!v.data[U]&&v.data[U]!=="false":s[U]=v.data[U]||""}),c("save",{...s}),$().add({title:"成功",description:`${C(p)}配置已保存`,color:"green"});else throw new Error(v.msg||"保存失败")}catch(o){console.error("保存配置失败:",o),$().add({title:"错误",description:o.message||"保存失败",color:"red"})}},T=async p=>{try{if(!V(p))throw new Error(`请先完成并启用${C(p)}配置`);const j=await(await fetch("/api/notify/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:p})})).json();if(j.code===1)$().add({title:"成功",description:`${C(p)}测试消息已发送`,color:"green"});else throw new Error(j.msg||"测试失败")}catch(o){console.error("测试失败:",o),$().add({title:"错误",description:o.message||"测试失败",color:"red"})}};return De(()=>g.config,p=>{p&&Object.keys(s).forEach(o=>{p[o]!==void 0&&(o.endsWith("Enabled")?s[o]=!!p[o]&&p[o]!=="false":s[o]=p[o])})},{deep:!0,immediate:!0}),fe(async()=>{try{const o=await(await fetch("/api/notify/config",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();if(o.code===1&&o.data){const j=o.data;Object.keys(j).forEach(v=>{v.endsWith("Enabled")?s[v]=!!j[v]&&j[v]!=="false":s[v]=j[v]||""}),console.log("加载的配置:",s)}}catch(p){console.error("获取配置失败:",p),$().add({title:"错误",description:"获取推送配置失败",color:"red"})}}),(p,o)=>{const j=gt("USwitch"),v=Ge,U=qe,W=lo,D=Ke;return f(),m("div",io,[o[56]||(o[56]=a("div",{class:"flex justify-between items-center mb-4"},[a("h2",{class:"text-xl font-semibold text-white"},"推送渠道配置")],-1)),a("div",uo,[a("div",co,[a("div",po,[o[38]||(o[38]=a("span",{class:"text-gray-300"},"Webhook推送",-1)),a("div",fo,[n(j,{modelValue:s.webhookEnabled,"onUpdate:modelValue":o[0]||(o[0]=d=>s.webhookEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[1]||(o[1]=d=>r.webhook=!r.webhook),color:r.webhook?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.webhook?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.webhook?(f(),m("div",mo,[n(U,{modelValue:s.webhookURL,"onUpdate:modelValue":o[2]||(o[2]=d=>s.webhookURL=d),placeholder:"Webhook URL"},null,8,["modelValue"]),a("div",go,[n(v,{onClick:o[3]||(o[3]=d=>S("webhook")),variant:"ghost",color:"gray"},{default:b(()=>o[39]||(o[39]=[w(" 重置 ")])),_:1}),n(v,{onClick:o[4]||(o[4]=d=>O("webhook")),color:"primary"},{default:b(()=>o[40]||(o[40]=[w(" 保存 ")])),_:1})])])):R("",!0)]),a("div",wo,[a("div",bo,[o[41]||(o[41]=a("span",{class:"text-gray-300"},"Telegram推送",-1)),a("div",vo,[n(j,{modelValue:s.telegramEnabled,"onUpdate:modelValue":o[5]||(o[5]=d=>s.telegramEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[6]||(o[6]=d=>r.telegram=!r.telegram),color:r.telegram?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.telegram?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.telegram?(f(),m("div",yo,[n(U,{modelValue:s.telegramToken,"onUpdate:modelValue":o[7]||(o[7]=d=>s.telegramToken=d),placeholder:"Bot Token"},null,8,["modelValue"]),n(U,{modelValue:s.telegramChatID,"onUpdate:modelValue":o[8]||(o[8]=d=>s.telegramChatID=d),placeholder:"Chat ID"},null,8,["modelValue"]),a("div",ho,[n(v,{onClick:o[9]||(o[9]=d=>S("telegram")),variant:"ghost",color:"gray"},{default:b(()=>o[42]||(o[42]=[w(" 重置 ")])),_:1}),n(v,{onClick:o[10]||(o[10]=d=>O("telegram")),color:"primary"},{default:b(()=>o[43]||(o[43]=[w(" 保存 ")])),_:1})])])):R("",!0)]),a("div",ko,[a("div",Co,[o[44]||(o[44]=a("span",{class:"text-gray-300"},"企业微信推送",-1)),a("div",Vo,[n(j,{modelValue:s.weworkEnabled,"onUpdate:modelValue":o[11]||(o[11]=d=>s.weworkEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[12]||(o[12]=d=>r.wework=!r.wework),color:r.wework?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.wework?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.wework?(f(),m("div",$o,[n(U,{modelValue:s.weworkKey,"onUpdate:modelValue":o[13]||(o[13]=d=>s.weworkKey=d),placeholder:"WebHook Key"},null,8,["modelValue"]),a("div",So,[n(v,{onClick:o[14]||(o[14]=d=>S("wework")),variant:"ghost",color:"gray"},{default:b(()=>o[45]||(o[45]=[w(" 重置 ")])),_:1}),n(v,{onClick:o[15]||(o[15]=d=>O("wework")),color:"primary"},{default:b(()=>o[46]||(o[46]=[w(" 保存 ")])),_:1})])])):R("",!0)]),a("div",Uo,[a("div",To,[o[47]||(o[47]=a("span",{class:"text-gray-300"},"飞书推送",-1)),a("div",jo,[n(j,{modelValue:s.feishuEnabled,"onUpdate:modelValue":o[16]||(o[16]=d=>s.feishuEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[17]||(o[17]=d=>r.feishu=!r.feishu),color:r.feishu?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.feishu?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.feishu?(f(),m("div",Eo,[n(U,{modelValue:s.feishuWebhook,"onUpdate:modelValue":o[18]||(o[18]=d=>s.feishuWebhook=d),placeholder:"WebHook URL"},null,8,["modelValue"]),n(U,{modelValue:s.feishuSecret,"onUpdate:modelValue":o[19]||(o[19]=d=>s.feishuSecret=d),placeholder:"签名密钥",type:"password"},null,8,["modelValue"]),a("div",Ao,[n(v,{onClick:o[20]||(o[20]=d=>S("feishu")),variant:"ghost",color:"gray"},{default:b(()=>o[48]||(o[48]=[w(" 重置 ")])),_:1}),n(v,{onClick:o[21]||(o[21]=d=>O("feishu")),color:"primary"},{default:b(()=>o[49]||(o[49]=[w(" 保存 ")])),_:1})])])):R("",!0)]),a("div",Io,[a("div",Po,[o[50]||(o[50]=a("span",{class:"text-gray-300"},"Twitter推送",-1)),a("div",Ho,[n(j,{modelValue:s.twitterEnabled,"onUpdate:modelValue":o[22]||(o[22]=d=>s.twitterEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[23]||(o[23]=d=>r.twitter=!r.twitter),color:r.twitter?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.twitter?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.twitter?(f(),m("div",Lo,[n(U,{modelValue:s.twitterApiKey,"onUpdate:modelValue":o[24]||(o[24]=d=>s.twitterApiKey=d),placeholder:"API Key"},null,8,["modelValue"]),n(U,{modelValue:s.twitterApiSecret,"onUpdate:modelValue":o[25]||(o[25]=d=>s.twitterApiSecret=d),placeholder:"API Secret"},null,8,["modelValue"]),n(U,{modelValue:s.twitterAccessToken,"onUpdate:modelValue":o[26]||(o[26]=d=>s.twitterAccessToken=d),placeholder:"Access Token"},null,8,["modelValue"]),n(U,{modelValue:s.twitterAccessTokenSecret,"onUpdate:modelValue":o[27]||(o[27]=d=>s.twitterAccessTokenSecret=d),placeholder:"Access Token Secret"},null,8,["modelValue"]),a("div",xo,[n(v,{onClick:o[28]||(o[28]=d=>S("twitter")),variant:"ghost",color:"gray"},{default:b(()=>o[51]||(o[51]=[w("重置")])),_:1}),n(v,{onClick:o[29]||(o[29]=d=>O("twitter")),color:"primary"},{default:b(()=>o[52]||(o[52]=[w("保存")])),_:1})])])):R("",!0)]),a("div",Ro,[a("div",Oo,[o[53]||(o[53]=a("span",{class:"text-gray-300"},"自定义HTTP推送",-1)),a("div",zo,[n(j,{modelValue:s.customHttpEnabled,"onUpdate:modelValue":o[30]||(o[30]=d=>s.customHttpEnabled=d)},null,8,["modelValue"]),n(v,{size:"sm",onClick:o[31]||(o[31]=d=>r.customHttp=!r.customHttp),color:r.customHttp?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(r.customHttp?"取消":"编辑"),1)]),_:1},8,["color"])])]),r.customHttp?(f(),m("div",No,[n(U,{modelValue:s.customHttpUrl,"onUpdate:modelValue":o[32]||(o[32]=d=>s.customHttpUrl=d),placeholder:"请求URL"},null,8,["modelValue"]),n(W,{modelValue:s.customHttpMethod,"onUpdate:modelValue":o[33]||(o[33]=d=>s.customHttpMethod=d),options:["POST","PUT","PATCH"]},null,8,["modelValue"]),n(D,{modelValue:s.customHttpHeaders,"onUpdate:modelValue":o[34]||(o[34]=d=>s.customHttpHeaders=d),placeholder:"请求Headers（JSON格式）"},null,8,["modelValue"]),n(D,{modelValue:s.customHttpBody,"onUpdate:modelValue":o[35]||(o[35]=d=>s.customHttpBody=d),placeholder:'请求Body模板（如：{"content":"{{content}}"})'},null,8,["modelValue"]),a("div",Wo,[n(v,{onClick:o[36]||(o[36]=d=>S("customHttp")),variant:"ghost",color:"gray"},{default:b(()=>o[54]||(o[54]=[w("重置")])),_:1}),n(v,{onClick:o[37]||(o[37]=d=>O("customHttp")),color:"primary"},{default:b(()=>o[55]||(o[55]=[w("保存")])),_:1})])])):R("",!0)])]),a("div",Bo,[(f(),m(G,null,me(y,d=>n(v,{key:d,onClick:_=>T(d),class:"flex-grow sm:flex-grow-0",variant:"solid"},{default:b(()=>[w(" 测试"+A(C(d)),1)]),_:2},1032,["onClick"])),64))])])}}}),Do={class:"fixed inset-0 bg-black overflow-auto"},Go={class:"min-h-screen p-4 flex items-center justify-center"},Mo={class:"w-[800px] max-w-[95%] bg-[#1a1b2e]/80 backdrop-blur-md rounded-lg shadow-xl p-6"},qo={class:"text-center mb-6 flex items-center justify-center gap-2"},Ko={key:0,class:"text-center mb-6"},Jo={class:"flex items-center justify-center gap-2 text-orange-400"},_o={class:"bg-gray-700 rounded-lg p-4 mb-6"},Qo={class:"grid gap-4"},Yo={class:"flex justify-between items-center"},Xo={class:"text-white font-medium"},Zo={class:"flex justify-between items-center"},es={class:"text-white font-medium"},ts={class:"flex justify-between items-center"},os={class:"text-white font-medium"},ss={key:1,class:"bg-gray-700 rounded-lg p-4 mb-6"},as={class:"space-y-4"},ns={class:"bg-gray-800 rounded p-3"},rs={class:"flex justify-between items-center mb-2"},ls={key:0},is={class:"flex justify-end gap-2"},ds={key:1},us={class:"text-white"},cs={class:"bg-gray-800 rounded p-3"},ps={class:"flex justify-between items-center mb-2"},fs={key:0,class:"mb-2"},ms={class:"flex items-center gap-2"},gs={key:1},ws={class:"bg-gray-800 rounded p-3"},bs={class:"flex justify-between items-center mb-2"},vs={key:0},ys={class:"flex justify-end gap-2"},hs={key:2,class:"bg-gray-700 rounded-lg p-4 mb-6"},ks={class:"flex items-center bg-gray-800 rounded p-3 mb-4 justify-between"},Cs={class:"flex items-center gap-4"},Vs={class:"flex items-center"},$s={class:"flex items-center"},Ss={class:"bg-gray-800 rounded p-4 mb-4"},Us={class:"flex justify-between items-center mb-3"},Ts={class:"flex items-center gap-4"},js={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Es={class:"md:col-span-2"},As={class:"flex items-center bg-gray-800 rounded p-3 mb-4 justify-between"},Is={class:"flex items-center gap-4"},Ps={class:"flex items-center"},Hs={class:"flex items-center"},Ls={class:"space-y-4"},xs={class:"flex justify-between items-center mb-2"},Rs={class:"text-gray-300"},Os={key:0},zs={key:0,class:"space-y-2"},Ns={class:"flex gap-2"},Ws={class:"flex justify-end gap-2"},Bs={key:1},Fs={key:0,class:"grid grid-cols-3 gap-2"},Ds=["src","onClick"],Gs={key:1,class:"text-white break-words"},Ms={key:3,class:"flex justify-end gap-2 mb-6"},qs={key:5,class:"bg-gray-700 rounded-lg p-4 mb-6"},Ks={class:"space-y-4"},Js={class:"flex gap-4"},_s={class:"flex justify-between items-center"},Qs={key:0},Ys={key:1,class:"flex gap-2"},Xs={class:"bg-gray-800 p-6 rounded-lg"},Zs={class:"text-xl font-semibold text-white mb-4"},ea={class:"flex justify-between items-center"},ta=de({__name:"StatusPanel",emits:["restore-success"],setup(e,{emit:u}){const c=M(!0),g=async()=>{try{const t=await(await fetch("/api/frontend/config",{credentials:"include"})).json();t.code===1&&typeof t.data.allowRegistration=="boolean"&&(c.value=t.data.allowRegistration)}catch{$().add({title:"获取注册配置失败",color:"red"})}};fe(g);const s=async()=>{try{const t=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let i={};t.code===1?i={...t.data,allowRegistration:c.value}:i={allowRegistration:c.value};const E=await(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).json();if(E.code===1)$().add({title:"保存成功",color:"green"});else throw new Error(E.msg||"保存失败")}catch{$().add({title:"保存失败",color:"red"})}},r=Fe(),{login:y,register:C}=eo(),S=M(""),V=se({checking:!1,hasUpdate:!1,latestVersion:""});let O=se({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:""});const T=async()=>{V.checking=!0;try{const t=await(await fetch("/api/version/check",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if(t.code===1){const{hasUpdate:i,lastUpdateTime:P}=t.data;V.hasUpdate=i,V.latestVersion=new Date(P).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),i?$().add({title:"发现版本",description:`最新版本发布于 ${V.latestVersion}`,color:"orange"}):$().add({title:"已是最新版本",description:"当前使用的是最新版本",color:"green"})}else throw new Error(t.msg||"检查更新失败")}catch(l){console.error("检查版本更新失败:",l),$().add({title:"检查更新失败",description:"请科学上网后重试",color:"red"})}finally{V.checking=!1}},p=async()=>{var l;if(!r.isLogin){$().add({title:"错误",description:"请先登录",color:"red"});return}try{const t=await fetch("/api/user/token/regenerate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),i=await t.json();if(!t.ok)throw new Error(i.msg||"Token生成请求失败");if(i.code===1&&((l=i.data)!=null&&l.token))S.value=i.data.token,$().add({title:"成功",description:"Token 已更新",color:"green"});else throw new Error(i.msg||"Token 生成失败")}catch(t){console.error("Token生成错误:",t),$().add({title:"错误",description:t.message||"Token 生成失败",color:"red"})}},o=async()=>{try{await navigator.clipboard.writeText(S.value),$().add({title:"成功",description:"Token 已复制到剪贴板",color:"green"})}catch{$().add({title:"错误",description:"复制失败",color:"red"})}},j=async()=>{try{if(!(await fetch("/api/user/logout",{method:"POST",credentials:"include"})).ok)throw new Error("退出请求失败");r.$reset(),window.location.reload(),$().add({title:"成功",description:"已退出登录",color:"green"})}catch{$().add({title:"错误",description:"退出登录失败",color:"red"})}},v=H(()=>(r==null?void 0:r.isLogin)??!1),U=H(()=>{var l;return((l=r.user)==null?void 0:l.is_admin)??!1}),W=M(!0),D=M(!1),d=M(!1),_=M(null),x=se({username:"",oldPassword:"",newPassword:""}),z=se({username:!1,password:!1}),ne=async()=>{try{if(!x.username.trim())throw new Error("用户名不能为空");const t=await(await fetch("/api/user/update",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:x.username,type:"username"})})).json();if(t.code===1)await r.getUser(),z.username=!1,x.username="",$().add({title:"成功",description:"用户名已更新",color:"green"});else throw new Error(t.msg)}catch(l){$().add({title:"错误",description:l.message||"更新失败",color:"red"})}},Ce=async()=>{try{if(!x.newPassword||!x.oldPassword)throw new Error("密码不能为空");if(x.newPassword===x.oldPassword)throw new Error("新密码不能与当前密码相同");const t=await(await fetch("/api/user/change_password",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:x.newPassword,oldPassword:x.oldPassword})})).json();if(t.code===1)z.password=!1,x.oldPassword="",x.newPassword="",$().add({title:"成功",description:"密码已更新",color:"green"});else throw new Error(t.msg)}catch(l){$().add({title:"错误",description:l.message||"更新失败",color:"red"})}},be={siteTitle:"站点标题",subtitleText:"欢迎语",avatarURL:"头像链接",username:"用户名",description:"个人描述",backgrounds:"背景图片",cardFooterTitle:"卡片页脚标题",cardFooterLink:"卡片页脚链接",pageFooterHTML:"页面底部HTML",rssTitle:"RSS 标题",rssDescription:"RSS 描述",rssAuthorName:"RSS 作者",rssFaviconURL:"RSS 图标链接",walineServerURL:"Waline 评论服务器地址"},h=se({siteTitle:"",subtitleText:"",avatarURL:"",username:"",description:"",backgrounds:[],cardFooterTitle:"",cardFooterLink:"",pageFooterHTML:"",rssTitle:"",rssDescription:"",rssAuthorName:"",rssFaviconURL:"",walineServerURL:"",enableGithubCard:!1,pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:""}),Q=H({get:()=>h.enableGithubCard===!0,set:l=>{const t=l===!0||l==="true"||l===1||l==="1";h.enableGithubCard=t}}),te=se({username:"",password:""}),oe=se({siteTitle:!1,subtitleText:!1,avatarURL:!1,username:!1,description:!1,backgrounds:!1,cardFooterTitle:!1,cardFooterLink:!1,pageFooterHTML:!1,rssTitle:!1,rssDescription:!1,rssAuthorName:!1,rssFaviconURL:!1,walineServerURL:!1}),I={siteTitle:"Noise的说说笔记",subtitleText:"欢迎访问，点击头像可更换封面背景！",avatarURL:"https://s2.loli.net/2025/03/24/HnSXKvibAQlosIW.png",username:"Noise",description:"执迷不悟",backgrounds:["https://s2.loli.net/2025/03/27/KJ1trnU2ksbFEYM.jpg","https://s2.loli.net/2025/03/27/MZqaLczCvwjSmW7.jpg","https://s2.loli.net/2025/03/27/UMijKXwJ9yTqSeE.jpg","https://s2.loli.net/2025/03/27/WJQIlkXvBg2afcR.jpg","https://s2.loli.net/2025/03/27/oHNQtf4spkq2iln.jpg","https://s2.loli.net/2025/03/27/PMRuX5loc6Uaimw.jpg","https://s2.loli.net/2025/03/27/U2WIslbNyTLt4rD.jpg","https://s2.loli.net/2025/03/27/xu1jZL5Og4pqT9d.jpg","https://s2.loli.net/2025/03/27/OXqwzZ6v3PVIns9.jpg","https://s2.loli.net/2025/03/27/HGuqlE6apgNywbh.jpg","https://s2.loli.net/2025/03/26/d7iyuPYA8cRqD1K.jpg","https://s2.loli.net/2025/03/27/wYy12qDMH6bGJOI.jpg","https://s2.loli.net/2025/03/27/y67m2k5xcSdTsHN.jpg"],cardFooterTitle:"Noise·说说·笔记~",cardFooterLink:"note.noisework.cn",pageFooterHTML:'<div class="text-center text-xs text-gray-400 py-4">来自<a href="https://www.noisework.cn" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Noise</a> 使用<a href="https://github.com/rcy1314/echo-noise" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Ech0-Noise</a>发布</div>',rssTitle:"Noise的说说笔记",rssDescription:"一个说说笔记~",rssAuthorName:"Noise",rssFaviconURL:"/favicon.ico",walineServerURL:"请前往waline官网https://waline.js.org查看部署配置",pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:""},re=l=>{h[l]=I[l],oe[l]=!1},Y=async()=>{var l;try{const i=await(await fetch("/api/frontend/config",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if((l=i==null?void 0:i.data)!=null&&l.frontendSettings){const P=i.data.frontendSettings,E=["enableGithubCard","pwaEnabled"];if(Object.keys(h).forEach(N=>{if(N==="backgrounds"){const K=P[N];Array.isArray(K)&&(h[N]=[...K])}else if(E.includes(N)){const K=P[N]??I[N];h[N]=K===!0||K==="true"}else{const K=P[N]??I[N];h[N]=typeof K=="string"?K.trim():K}}),P.enableGithubCard!==void 0){const N=P.enableGithubCard;h.enableGithubCard=N===!0||N==="true"}const B=(h.pwaTitle||h.siteTitle||"说说笔记").trim(),q=(h.pwaIconURL||h.rssFaviconURL||"/favicon.ico").trim(),ue=(h.pwaDescription||h.description||"").trim();bt({title:B,meta:[{name:"description",content:ue},{name:"theme-color",content:"#000000"}],link:[{rel:"manifest",href:"/manifest.webmanifest"},{rel:"icon",href:q}]})}}catch(t){console.error("获取配置失败:",t)}},Ve=async l=>{try{if(l==="backgrounds"){const E=h.backgrounds.filter(B=>B&&B.trim()!=="");h.backgrounds=E}const i=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:h})});if(!i.ok){const E=await i.json();throw new Error(E.msg||"请求失败")}const P=await i.json();if(P.code===1){oe[l]=!1,await Y();const E=be[l]||(l==="pwa"?"PWA 设置":l);$().add({title:"成功",description:`${E}已更新`,color:"green"})}else throw new Error(P.msg||"保存失败")}catch(t){console.error("保存配置失败:",t),$().add({title:"错误",description:t.message||"配置更新失败",color:"red"})}},Je=async()=>{try{const t=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:h})}),i=await t.json();if(t.ok&&i.code===1){if(await Y(),$().add({title:"成功",description:"PWA 设置已更新",color:"green"}),"serviceWorker"in navigator){const P=await navigator.serviceWorker.getRegistrations();if(h.pwaEnabled)await navigator.serviceWorker.register("/sw.js");else{for(const B of P)await B.unregister();const E=await caches.keys();await Promise.all(E.map(B=>caches.delete(B)))}}window.dispatchEvent(new Event("frontend-config-updated"))}else throw new Error(i.msg||"保存失败")}catch(l){$().add({title:"错误",description:l.message||"保存失败",color:"red"})}},_e=async()=>{try{const l={frontendSettings:{enableGithubCard:!!Q.value}},t=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),i=await t.json();if(t.ok&&i.code===1)h.enableGithubCard=!!Q.value,await Y(),window.dispatchEvent(new Event("frontend-config-updated")),$().add({title:"成功",description:"GitHub 解析设置已保存",color:"green"});else throw new Error(i.msg||"保存失败")}catch(l){$().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Qe=async l=>{const t=l.target.files;if(!t)return;const i=["image/jpeg","image/png","image/webp"];for(const P of Array.from(t))try{if(!i.includes(P.type))throw new Error("仅支持 JPG/PNG/WEBP 格式");const E=new FormData;E.append("image",P);const B=await fetch("/api/images/upload",{method:"POST",credentials:"include",body:E}),q=await B.json();if(!B.ok||q.code!==1)throw new Error(q.msg||"上传失败");if(q.code===1&&q.data){const ue=q.data.startsWith("http")?q.data:`/api${q.data}`,N=[...h.backgrounds,ue];h.backgrounds=N,await Ve("backgrounds"),$().add({title:"上传成功",description:`${P.name} 已添加到背景图片列表`,color:"green"})}}catch(E){$().add({title:"上传失败",description:E.message||"文件上传失败",color:"red"})}_.value&&(_.value.value="")};fe(()=>{window.addEventListener("frontend-config-updated",l=>{const{key:t,value:i}=l.detail;t&&i!==void 0&&(h[t]=i)})});const Ye=()=>{Y(),d.value=!1},Xe=async()=>{h.backgrounds.push("")},Ze=async l=>{h.backgrounds.splice(l,1),await Ve("backgrounds")},et=()=>{var l;(l=_.value)==null||l.click()},tt=l=>{window.open(l,"_blank")};De(()=>r.isLogin,l=>{l||(r.getStatus(),r.getUser(),r.$reset())});const Ie=M(!1);fe(async()=>{var l;try{if(Ie.value=!0,await Promise.all([r.getStatus(),r.getUser(),Y(),g()]),r.isLogin){const i=await(await fetch("/api/user/token",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();i.code===1&&((l=i.data)!=null&&l.token)&&(S.value=i.data.token)}}catch(t){console.error("初始化失败:",t),$().add({title:"系统提示",description:"当前未登录",color:"red",timeout:3e3})}finally{Ie.value=!1}});const ve=M(null),ot=async()=>{try{const l=await fetch("/api/backup/download",{credentials:"include"});if(!l.ok)throw new Error("下载失败");const t=await l.blob(),i=window.URL.createObjectURL(t),P=document.createElement("a");P.href=i,P.download=`noise_backup_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(P),P.click(),window.URL.revokeObjectURL(i),document.body.removeChild(P)}catch(l){$().add({title:"错误",description:l.message||"备份下载失败",color:"red"})}},st=()=>{var l;(l=ve.value)==null||l.click()},at=u,nt=async l=>{const t=l.target.files;if(!(!t||!t[0])){try{const i=new FormData;i.append("database",t[0]);const E=await(await fetch("/api/backup/restore",{method:"POST",credentials:"include",body:i})).json();if(E.code===1)$().add({title:"成功",description:"数据库恢复成功",color:"green"}),at("restore-success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(E.msg)}catch(i){$().add({title:"错误",description:i.message||"数据库恢复失败",color:"red"})}ve.value&&(ve.value.value="")}};return(l,t)=>{var Pe,He,Le,xe,Re,Oe;const i=Ge,P=Ae,E=qe,B=It,q=ht,ue=Ke,N=xt,K=Zt,rt=kt;return f(),m(G,null,[a("div",Do,[a("div",Go,[a("div",Mo,[t[61]||(t[61]=a("h1",{class:"text-3xl font-bold text-center text-white mb-8"},"系统管理面板",-1)),a("div",qo,[t[22]||(t[22]=a("span",{class:"text-gray-300"},"当前版本: latest",-1)),n(i,{size:"xs",color:"gray",variant:"ghost",loading:V.checking,onClick:T},{default:b(()=>[w(A(V.checking?"检测中...":"检查版本发布时间"),1)]),_:1},8,["loading"])]),V.hasUpdate?(f(),m("div",Ko,[a("div",Jo,[n(P,{name:"i-heroicons-arrow-up-circle",class:"w-5 h-5"}),a("span",null,"发现版本最近更新（于 "+A(V.latestVersion)+"）",1),t[23]||(t[23]=a("a",{href:"https://hub.docker.com/r/noise233/echo-noise/tags",target:"_blank",class:"text-blue-400 hover:text-blue-300 ml-2"}," 查看详情 ",-1))])])):R("",!0),a("div",_o,[t[27]||(t[27]=a("h2",{class:"text-xl font-semibold text-white mb-4"},"系统状态",-1)),a("div",Qo,[a("div",Yo,[t[24]||(t[24]=a("span",{class:"text-gray-300"},"系统管理员",-1)),a("span",Xo,A((He=(Pe=le(r))==null?void 0:Pe.status)==null?void 0:He.username),1)]),a("div",Zo,[t[25]||(t[25]=a("span",{class:"text-gray-300"},"当前用户",-1)),a("span",es,A(v.value?(Le=le(r).user)==null?void 0:Le.username:"未登录"),1)]),a("div",ts,[t[26]||(t[26]=a("span",{class:"text-gray-300"},"笔记总数",-1)),a("span",os,A((Re=(xe=le(r))==null?void 0:xe.status)==null?void 0:Re.total_messages)+" 条",1)])])]),v.value?(f(),m("div",ss,[t[36]||(t[36]=a("h2",{class:"text-xl font-semibold text-white mb-4"},"用户信息配置",-1)),a("div",as,[a("div",ns,[a("div",rs,[t[28]||(t[28]=a("span",{class:"text-gray-300"},"用户名",-1)),n(i,{size:"sm",onClick:t[0]||(t[0]=k=>z.username=!z.username),color:z.username?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(z.username?"取消":"编辑"),1)]),_:1},8,["color"])]),z.username?(f(),m("div",ls,[n(E,{modelValue:x.username,"onUpdate:modelValue":t[1]||(t[1]=k=>x.username=k),placeholder:"新用户名",class:"w-full mb-2"},null,8,["modelValue"]),a("div",is,[n(i,{onClick:ne,color:"primary"},{default:b(()=>t[29]||(t[29]=[w(" 保存 ")])),_:1})])])):(f(),m("div",ds,[a("p",us,A((Oe=le(r).user)==null?void 0:Oe.username),1)]))]),a("div",cs,[a("div",ps,[t[31]||(t[31]=a("span",{class:"text-gray-300"},"API Token",-1)),n(i,{size:"sm",onClick:p,color:"primary",variant:"soft"},{default:b(()=>t[30]||(t[30]=[w(" 重新生成 ")])),_:1})]),S.value?(f(),m("div",fs,[a("div",ms,[n(E,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=k=>S.value=k),readonly:"",class:"font-mono text-sm"},null,8,["modelValue"]),n(i,{icon:"i-heroicons-clipboard",color:"gray",variant:"ghost",onClick:o})]),t[32]||(t[32]=a("p",{class:"text-xs text-gray-400 mt-1"},"请妥善保管此 Token，它用于 API 访问认证",-1))])):(f(),m("div",gs,t[33]||(t[33]=[a("p",{class:"text-gray-400"},"暂无 Token",-1)])))]),a("div",ws,[a("div",bs,[t[34]||(t[34]=a("span",{class:"text-gray-300"},"修改密码",-1)),n(i,{size:"sm",onClick:t[3]||(t[3]=k=>z.password=!z.password),color:z.password?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(z.password?"取消":"编辑"),1)]),_:1},8,["color"])]),z.password?(f(),m("div",vs,[n(E,{modelValue:x.oldPassword,"onUpdate:modelValue":t[4]||(t[4]=k=>x.oldPassword=k),type:"password",placeholder:"当前密码",class:"w-full mb-2"},null,8,["modelValue"]),n(E,{modelValue:x.newPassword,"onUpdate:modelValue":t[5]||(t[5]=k=>x.newPassword=k),type:"password",placeholder:"新密码",class:"w-full mb-2"},null,8,["modelValue"]),a("div",ys,[n(i,{onClick:Ce,color:"primary"},{default:b(()=>t[35]||(t[35]=[w(" 保存 ")])),_:1})])])):R("",!0)])])])):R("",!0),U.value?(f(),m("div",hs,[t[50]||(t[50]=a("div",{class:"flex justify-between items-center mb-4"},[a("h2",{class:"text-xl font-semibold text-white"},"网站配置")],-1)),a("div",ks,[t[38]||(t[38]=a("span",{class:"text-white"},"新用户注册",-1)),a("div",Cs,[a("div",Vs,[n(B,{modelValue:c.value,"onUpdate:modelValue":t[6]||(t[6]=k=>c.value=k),value:!0,class:"mr-2"},null,8,["modelValue"]),a("span",{class:L(c.value?"text-white":"text-gray-400")},"允许",2)]),a("div",$s,[n(B,{modelValue:c.value,"onUpdate:modelValue":t[7]||(t[7]=k=>c.value=k),value:!1,class:"mr-2"},null,8,["modelValue"]),a("span",{class:L(c.value?"text-gray-400":"text-white")},"不允许",2)]),n(i,{color:"green",onClick:s},{default:b(()=>t[37]||(t[37]=[w("保存")])),_:1})])]),a("div",Ss,[a("div",Us,[t[40]||(t[40]=a("span",{class:"text-white"},"PWA 模式",-1)),a("div",Ts,[n(q,{modelValue:h.pwaEnabled,"onUpdate:modelValue":t[8]||(t[8]=k=>h.pwaEnabled=k)},null,8,["modelValue"]),n(i,{color:"green",onClick:Je},{default:b(()=>t[39]||(t[39]=[w("保存")])),_:1})])]),a("div",js,[a("div",null,[t[41]||(t[41]=a("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 标题",-1)),n(E,{modelValue:h.pwaTitle,"onUpdate:modelValue":t[9]||(t[9]=k=>h.pwaTitle=k),placeholder:h.siteTitle||"说说笔记"},null,8,["modelValue","placeholder"])]),a("div",null,[t[42]||(t[42]=a("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 图标",-1)),n(E,{"model-value":"/favicon.ico",disabled:""})]),a("div",Es,[t[43]||(t[43]=a("label",{class:"text-gray-300 text-sm mb-1 block"},"PWA 描述",-1)),n(ue,{modelValue:h.pwaDescription,"onUpdate:modelValue":t[10]||(t[10]=k=>h.pwaDescription=k),placeholder:h.description||""},null,8,["modelValue","placeholder"])])])]),a("div",As,[t[45]||(t[45]=a("span",{class:"text-white"},"GitHub 链接卡片解析",-1)),a("div",Is,[a("div",Ps,[n(B,{modelValue:Q.value,"onUpdate:modelValue":t[11]||(t[11]=k=>Q.value=k),value:!0,class:"mr-2"},null,8,["modelValue"]),a("span",{class:L(Q.value?"text-white":"text-gray-400")},"开启",2)]),a("div",Hs,[n(B,{modelValue:Q.value,"onUpdate:modelValue":t[12]||(t[12]=k=>Q.value=k),value:!1,class:"mr-2"},null,8,["modelValue"]),a("span",{class:L(Q.value?"text-gray-400":"text-white")},"关闭",2)]),n(i,{color:"green",onClick:_e},{default:b(()=>t[44]||(t[44]=[w("保存")])),_:1})])]),a("div",Ls,[(f(),m(G,null,me(be,(k,F)=>a("div",{key:F,class:"bg-gray-800 rounded p-3"},[a("div",xs,[a("span",Rs,A(k),1),n(i,{size:"sm",onClick:X=>oe[F]=!oe[F],color:oe[F]?"gray":"primary",variant:"soft"},{default:b(()=>[w(A(oe[F]?"取消":"编辑"),1)]),_:2},1032,["onClick","color"])]),oe[F]?(f(),m("div",Os,[F==="backgrounds"?(f(),m("div",zs,[(f(!0),m(G,null,me(h.backgrounds,(X,ce)=>(f(),m("div",{key:ce,class:"flex gap-2"},[n(E,{modelValue:h.backgrounds[ce],"onUpdate:modelValue":$e=>h.backgrounds[ce]=$e,placeholder:"输入图片URL",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(i,{onClick:$e=>Ze(ce),icon:"i-heroicons-trash",color:"red",variant:"ghost"},null,8,["onClick"])]))),128)),a("div",Ns,[n(i,{onClick:Xe,icon:"i-heroicons-plus",variant:"ghost",class:"mr-2"},{default:b(()=>t[46]||(t[46]=[w(" 添加链接 ")])),_:1}),n(i,{onClick:et,icon:"i-heroicons-cloud-arrow-up",variant:"ghost"},{default:b(()=>t[47]||(t[47]=[w(" 上传图片 ")])),_:1})])])):F==="subtitleText"?(f(),he(ue,{key:1,modelValue:h[F],"onUpdate:modelValue":X=>h[F]=X,placeholder:`输入${k}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(f(),he(E,{key:2,modelValue:h[F],"onUpdate:modelValue":X=>h[F]=X,placeholder:`输入${k}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),a("div",Ws,[n(i,{onClick:X=>re(F),variant:"ghost",color:"gray"},{default:b(()=>t[48]||(t[48]=[w(" 重置 ")])),_:2},1032,["onClick"]),n(i,{onClick:X=>Ve(F),color:"primary"},{default:b(()=>t[49]||(t[49]=[w(" 保存 ")])),_:2},1032,["onClick"])])])):(f(),m("div",Bs,[F==="backgrounds"?(f(),m("div",Fs,[(f(!0),m(G,null,me(h.backgrounds,(X,ce)=>(f(),m("img",{key:ce,src:X,class:"w-full h-20 object-cover rounded cursor-pointer",onClick:$e=>tt(X)},null,8,Ds))),128))])):(f(),m("p",Gs,A(h[F]),1))]))])),64))])])):R("",!0),d.value?(f(),m("div",Ms,[n(i,{onClick:Ye,variant:"ghost",color:"gray"},{default:b(()=>t[51]||(t[51]=[w(" 重置 ")])),_:1}),n(i,{onClick:l.saveConfig,color:"primary"},{default:b(()=>t[52]||(t[52]=[w(" 保存所有更改 ")])),_:1},8,["onClick"])])):R("",!0),U.value?(f(),he(Fo,{key:4,config:le(O),"onUpdate:config":t[13]||(t[13]=k=>wt(O)?O.value=k:O=k),immediate:!0},null,8,["config"])):R("",!0),U.value?(f(),m("div",qs,[t[56]||(t[56]=a("h2",{class:"text-xl font-semibold text-white mb-4"},"数据库管理",-1)),a("div",Ks,[a("div",Js,[n(i,{color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:ot},{default:b(()=>t[53]||(t[53]=[w(" 下载备份 ")])),_:1}),n(i,{color:"warning",icon:"i-heroicons-arrow-up-tray",onClick:st},{default:b(()=>t[54]||(t[54]=[w(" 恢复数据库 ")])),_:1})]),t[55]||(t[55]=a("div",{class:"text-yellow-400 text-sm max-h-16 overflow-y-auto bg-gray-800/50 rounded p-2"}," 🔔：SQLite一键备份恢复，因兼容问题，不支持云端的PostgreSQL/MySQL数据库，如有使用云端数据库，请前往云服务端来备份和恢复 ",-1)),a("input",{type:"file",ref_key:"databaseFileInput",ref:ve,accept:".zip",class:"hidden",onChange:nt},null,544)])])):R("",!0),a("div",_s,[n(i,{icon:"i-heroicons-arrow-left",variant:"ghost",color:"white",onClick:t[14]||(t[14]=k=>l.$router.push("/")),class:"text-white hover:text-black"},{default:b(()=>t[57]||(t[57]=[w(" 返回首页 ")])),_:1}),v.value?(f(),m("div",Qs,[n(i,{icon:"i-heroicons-power",color:"red",variant:"ghost",onClick:j},{default:b(()=>t[58]||(t[58]=[w(" 退出登录 ")])),_:1})])):(f(),m("div",Ys,[n(i,{color:"primary",onClick:t[15]||(t[15]=k=>{D.value=!0,W.value=!0})},{default:b(()=>t[59]||(t[59]=[w(" 登录 ")])),_:1}),n(i,{color:"secondary",onClick:t[16]||(t[16]=k=>{D.value=!0,W.value=!1})},{default:b(()=>t[60]||(t[60]=[w(" 注册 ")])),_:1})]))])])])]),n(rt,{modelValue:D.value,"onUpdate:modelValue":t[21]||(t[21]=k=>D.value=k)},{default:b(()=>[a("div",Xs,[a("h3",Zs,A(W.value?"用户登录":"用户注册"),1),n(K,{state:te,class:"space-y-4"},{default:b(()=>[n(N,null,{default:b(()=>[n(E,{modelValue:te.username,"onUpdate:modelValue":t[17]||(t[17]=k=>te.username=k),placeholder:"用户名",class:"w-full"},null,8,["modelValue"])]),_:1}),n(N,null,{default:b(()=>[n(E,{modelValue:te.password,"onUpdate:modelValue":t[18]||(t[18]=k=>te.password=k),type:"password",placeholder:"密码",class:"w-full"},null,8,["modelValue"])]),_:1}),a("div",ea,[n(i,{variant:"ghost",onClick:t[19]||(t[19]=k=>W.value=!W.value)},{default:b(()=>[w(A(W.value?"去注册":"去登录"),1)]),_:1}),n(i,{color:"primary",onClick:t[20]||(t[20]=k=>W.value?le(y)(te):le(C)(te))},{default:b(()=>[w(A(W.value?"登录":"注册"),1)]),_:1})])]),_:1},8,["state"])])]),_:1},8,["modelValue"]),a("input",{type:"file",ref_key:"fileInput",ref:_,accept:"image/*",multiple:"",class:"hidden",onChange:Qe},null,544)],64)}}}),oa=we(ta,[["__scopeId","data-v-75353993"]]),na=de({__name:"status",setup(e){const u=()=>{$().add({title:"恢复成功",description:"数据已恢复，页面即将刷新",color:"green",timeout:2e3}),setTimeout(()=>{window.location.reload()},2e3)};return(c,g)=>{const s=vt,r=Ct;return f(),he(r,null,{default:b(()=>[n(s,{class:"flex justify-center items-center h-screen"},{default:b(()=>[n(oa,{onRestoreSuccess:u})]),_:1}),n(Vt)]),_:1})}}});export{na as default};
